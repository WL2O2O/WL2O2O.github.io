---
title: 基于Spring Boot的在线编程判题系统
index_img: https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311151627634.png
banner_img: https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311151640352.png
hide: true
categories:
  - Project
tags:
  - Spring Boot
  - MySQL
abbrlink: 6280
date: 2023-08-21 08:12:32
---

# Smart OJ

> ## 复习一下项目开发流程
>
> 1. 项目简介、项目调研、项目需求分析
>
> 2. 核心业务流程
>
> 3. 项目功能模块
>
> 4. 技术选型
>
> 5. 项目初始化
>
> 6. 项目开发
>
> 7. 测试
>
> 8. 优化
>
>    （代码提交、代码审核、产品验收）
>
> 9. 上线
>
> 在此过程中，也是要不断写文档、持续调研、沉淀知识的



## 项目简介

OJ ： Online Judge（在线判题评测系统）

用户可以选择题目练习，在线编写代码，测试代码，提交代码，系统会根据设置好的答案对用户提交的代码进行评测，给出评测结果！

#### 项目亮点

1. 项目新颖，重复度低，写简历有区分度
2. 区别于常见的`CRUD`项目，偏向于架构设计、编程思想之类的知识
3. 项目复杂度高，可扩展性强

#### OJ系统的常用概念

ac 表示你的题目通过，结果正确
题目限制：时间限制、内存限制
题目介绍
题目输入
题目输出
题目输入用例
题目输出用例

#### **难点**:判题系统

普通测评：管理员设置题目的输入和输出用例，比如我输入 A，你要输出 B 才是正确的；交给判题机去执行用户的代码，给用户的代码喂输入用例，比如 A，看用户程序的执行结果是否和标准答案的输出一致。
（比对用例文件）

特殊测评（SPJ）：管理员设置题目的输入和输出，比如我输入 1，用户的答案只要是 > 0 或 < 2 都是正确的；特判程序，不是通过对比用例文件是否一致这种死板的程序来检验，而是要专门根据这道题目写一个特殊的判断程序，程序接收题目的输入（1）、标准输出用例（2）、用户的结果（1.5） ，特判程序根据这些值来比较是否正确。

交互测评：让用户输入一个例子，就给一个输出结果，交互比较灵活，没办法通过简单的、死板的输入输出文件来搞定

***不能让用户随便引入包、随便遍历、暴力破解，需要使用正确的算法。 => 安全性***

***判题过程是异步的 => 异步化***

***提交之后，会生成一个提交记录，有运行的结果以及运行信息（时间限制、内存限制）***



## 项目调研

https://github.com/HimitZH/HOJ(适合学习)
https://github.com/QingdaoU/OnlineJudge(python,不好学，很成熟)
https://github.com/hzxie/Noj(星星没那么多，没那么成熟，但相对好学)
https://github.com/vfleaking,/uoj(php实现的)



## 项目需求分析



#### 实现核心

1. 权限校验

2. 代码沙箱（安全沙箱 -- 防止代码藏毒）

   代码安全：设置安全的、隔离的沙箱，以确保用户的代码不会影响到系统的安全

   

3. 判题规则

   题目用例的比对，结果的验证

4. 任务调度

   资源分配：防止用户疯狂占用资源，措施：异步化处理，服务资源有限，按照用户提交顺序进行判题

#### 核心业务流程

![image-20231122184857284](https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311221849444.png)

时序图：

![image-20231115164047376](https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311151640352.png)

#### 功能

1. 题目模块

   a. 管理员：创建、删除、修改

   b. 用户：搜索题目

   c. 在线做题、提交题目代码

2. 用户模块

   a. 注册与登录

3. 判题模块

   a. 提交判题（结果是否正确与错误）

   b. 错误处理（内存溢出、安全性、超时）

   c. 自主实现代码沙箱（安全、隔离的一个环境）

   d. 开放接口



#### 扩展思路

1. 支持多种语言
2. 远程评测
3. 完善的评测功能：普通评测、特殊评测、交互评测、在线自测、文件IO
4. 统计分析判题记录
5. 权限校验



## 技术选型

#### 前端：

`Vue3、手撸Umi项目模板、AcroDesign组件库、在线代码编辑器、在线文档浏览`

#### 后端：

`Java进程控制、Java安全管理、部分JVM知识点、虚拟机、Docker、Spring Cloud微服务、消息队列`

## 架构设计

采用分层架构：用户层、接入层、业务层、服务层、存储层、资源层

![image-20231122192355366](E:/Master/TyporaImages/oj/image-20231122192355366.png)

## 项目排期

1. 项目简介、项目调研、需求分析、技术选型、架构设计、现有`OJ`主流实现方案
2. 前后端项目初始化、前端通用项目模板的搭建
3. 主业务流程的前后端开发（争取把代码沙箱之外的全部搞定）
4. 专攻代码沙箱（自主实现，不止一种实现方案，层层递进，通过实战用例来进行安全优化）
5. 系统优化（微服务改造、系统扩展思路）



## 主流OJ实现方案

1. 用现成的`OJ`系统 

网上有很多开源的`OJ`项目，比如`青岛OJ`、`HustOJ`等，可以直接下载开源代码自己部署。

比较推荐的是`judge0`，这是一个非常成熟的`商业OJ`项目，支持 60 多种编程语言！

> 代码：https://github.com/judge0/judge0

2. 用现成的服务 

如果你不希望完整部署一套大而全的代码，只是想复用他人已经实现的、最复杂的判题逻辑，那么可以直接使用现成的 判题`API`、或者现成的 代码沙箱 等服务。

比如`judge0`提供的`判题API`，非常方便易用。只需要通过 HTTP 调用`submissions`判题接口，把用户的代码、输入值、预期的执行结果作为请求参数发送给`judge0`的服务器，它就能自动帮你编译执行程序，并且返回程序的运行结果。

`API`的作用：接受代码、返回执行结果

> `Judge0 API`地址：https://rapidapi.com/judge0-official/api/judge0-ce
>
> 官方文档：https://ce.judge0.com/#submissions-submission-post

>  流程 
>
> 1先注册
>
> 2再开通订阅
>
> 3然后测试 language 接口
>
> 4测试执行代码接口 submissions

3. **自主开发**✨✨✨--我的方案

自主实现判题服务和代码沙箱，适合学习，但不适用于商业项目。



4. 把 AI 来当做代码沙箱 

现在 AI 的能力已经十分强大了，我们可以把各种本来很复杂的功能直接交给 AI 来实现。

只要脑洞够大，AI + 编程 = 无限的可能~



5. 移花接木 

这种方式最有意思、也最 “缺德”。很多同学估计想不到。

那就是可以通过让程序来操作模拟浏览器的方式，用别人已经开发好的 OJ 系统来帮咱们判题。

比如使用 Puppeteer + 无头浏览器，把咱们系统用户提交的代码，像人一样输入到别人的 OJ 网页中，让程序点击提交按钮，并且等别人的 OJ 系统返回判题结果后，再把这个结果返回给我们自己的用户。

这种方式的缺点就是把核心流程交给了别人，如果别人服务挂了，你的服务也就挂了；而且别人 OJ 系统不支持的题目，可能你也支持不了。



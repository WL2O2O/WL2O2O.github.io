<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><script async src="https://www.googletagmanager.com/gtag/js?id=G-MP1THLPZFC"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MP1THLPZFC")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?956b14594152e1b71ce14695a71235d5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="CS_GUIDER"><meta name="subtitle" content="If not now, when? If not me, who?"><meta name="description" content="欢迎来到我的CS_GUIDER博客！这里提供了全面、实用和最新的Java编程信息。你可以找到Java算法、项目、博客、数据库、Linux系统的教程和笔记。我致力于为您提供Java编程的实用指南和资源，包括Java框架、JVM和Git等。无论您是初学者还是经验丰富的开发人员，都可以从中获益。谢谢您的光临！"><title>基于Spring Boot的在线编程判题系统 | CS_GUIDER&#39;S Blog</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/nprogress/nprogress.css"><script src="/lib/jquery.min.js"></script><script src="/lib/iconify-icon.min.js"></script><script src="https://cdn.tailwindcss.com?plugins=typography"></script><script>tailwind.config={darkMode:"class"}</script><script src="/lib/nprogress/nprogress.js"></script><script>$(document).ready(()=>{NProgress.configure({showSpinner:!1}),NProgress.start(),$("#nprogress .bar").css({background:"#de7441"}),$("#nprogress .peg").css({"box-shadow":"0 0 2px #de7441, 0 0 4px #de7441"}),$("#nprogress .spinner-icon").css({"border-top-color":"#de7441","border-left-color":"#de7441"}),setTimeout((function(){NProgress.done(),$(".fade").removeClass("out")}),800)})</script><script>!function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("hexo-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0);document.documentElement.classList.contains("dark")}(),$(document).ready((function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=document.documentElement.classList.contains("dark");function o(){const e=document.documentElement.classList.contains("dark"),t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e?"dark":"light"}}},"https://giscus.app")}function n(){let t=document.documentElement.classList.contains("dark");localStorage.getItem("hexo-color-scheme");t=!t,document.documentElement.classList.toggle("dark",t),$("#theme-icon").attr("icon",t?"ri:moon-line":"ri:sun-line"),e===t?localStorage.setItem("hexo-color-scheme","auto"):localStorage.setItem("hexo-color-scheme",t?"dark":"light"),o()}$("#theme-icon").attr("icon",t?"ri:moon-line":"ri:sun-line"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{"auto"===(localStorage.getItem("hexo-color-scheme")||"auto")&&(document.documentElement.classList.toggle("dark",e.matches),$("#theme-icon").attr("icon",e.matches?"ri:moon-line":"ri:sun-line"),o())}),$("#toggle-dark").click(e=>{if(!(document.startViewTransition&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches))return void n();const t=e.clientX,o=e.clientY,c=Math.hypot(Math.max(t,innerWidth-t),Math.max(o,innerHeight-o));document.startViewTransition(async()=>{n()}).ready.then(()=>{const e=document.documentElement.classList.contains("dark"),n=[`circle(0px at ${t}px ${o}px)`,`circle(${c}px at ${t}px ${o}px)`];document.documentElement.animate({clipPath:e?[...n].reverse():n},{duration:400,easing:"ease-out",pseudoElement:e?"::view-transition-old(root)":"::view-transition-new(root)"})})})}))</script><meta name="generator" content="Hexo 5.4.2"></head><body class="font-sans bg-white dark:bg-zinc-900 text-gray-700 dark:text-gray-200 relative"><header class="fixed w-full px-5 py-1 z-10 backdrop-blur-xl backdrop-saturate-150 border-b border-black/5"><div class="max-auto"><nav class="flex items-center text-base"><a href="/" class="group"><h2 class="font-medium tracking-tighterp text-l p-2"><img class="w-5 mr-2 inline-block transition-transform group-hover:rotate-[30deg]" id="logo" src="/img/logo.svg" alt="CS_GUIDER'S Blog"> CS_GUIDER&#39;S Blog</h2></a><div id="header-title" class="opacity-0 md:ml-2 md:mt-[0.1rem] text-xs font-medium whitespace-nowrap overflow-hidden overflow-ellipsis">基于Spring Boot的在线编程判题系统</div><div class="flex-1"></div><div class="flex items-center gap-3"><a class="hidden sm:flex" href="/">Home</a> <a class="hidden sm:flex" href="/archives">Archives</a> <a class="hidden sm:flex" href="/category">Categories</a> <a class="hidden sm:flex" href="/tag">Tags</a> <a class="w-5 h-5 hidden sm:flex" title="Github" target="_blank" rel="noopener" href="https://github.com/wl2o2o"><iconify-icon width="20" icon="ri:github-line"></iconify-icon></a><a class="w-5 h-5 hidden sm:flex" title="Github" href="rss2.xml"><iconify-icon width="20" icon="ri:rss-line"></iconify-icon></a><a class="w-5 h-5" title="toggle theme" id="toggle-dark"><iconify-icon width="20" icon="" id="theme-icon"></iconify-icon></a></div><div class="flex items-center justify-center gap-3 ml-3 sm:hidden"><span class="w-5 h-5" aria-hidden="true" role="img" id="open-menu"><iconify-icon width="20" icon="carbon:menu"></iconify-icon></span><span class="w-5 h-5 hidden" aria-hidden="true" role="img" id="close-menu"><iconify-icon width="20" icon="carbon:close"></iconify-icon></span></div></nav></div></header><div id="menu-panel" class="h-0 overflow-hidden sm:hidden fixed left-0 right-0 top-12 bottom-0 z-10"><div id="menu-content" class="relative z-20 bg-white/80 px-6 sm:px-8 py-2 backdrop-blur-xl -translate-y-full transition-transform duration-300"><ul class="nav flex flex-col sm:flex-row text-sm font-medium"><li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main"><a href="/" class="flex h-12 sm:h-auto items-center">Home</a></li><li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main"><a href="/archives" class="flex h-12 sm:h-auto items-center">Archives</a></li><li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main"><a href="/category" class="flex h-12 sm:h-auto items-center">Categories</a></li><li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main"><a href="/tag" class="flex h-12 sm:h-auto items-center">Tags</a></li></ul></div><div class="mask bg-black/20 absolute inset-0"></div></div><main class="pt-14"><link rel="stylesheet" href="/lib/fancybox/fancybox.min.css"><link rel="stylesheet" href="/lib/tocbot/tocbot.min.css"><nav class="post-toc toc text-sm w-48 relative top-32 right-0 opacity-70 hidden lg:block" style="position:fixed!important"></nav><section class="px-6 max-w-prose mx-auto md:px-0"><header class="overflow-hidden pt-6 pb-6 md:pt-12"><div class="pt-4 md:pt-6"><h1 id="article-title" class="text-[2rem] font-bold leading-snug mb-4 md:mb-6 md:text-[2.6rem]">基于Spring Boot的在线编程判题系统</h1><div><section class="flex items-center gap-3 text-sm"><span class="flex items-center gap-1"><iconify-icon width="18" icon="carbon-calendar"></iconify-icon><time>2025-09-17</time> </span><span class="text-gray-400">·</span> <span class="flex items-center gap-1"><iconify-icon width="18" icon="ic:round-access-alarm"></iconify-icon><span>59 min</span> </span><span class="text-gray-400">·</span> <span class="flex items-center gap-1"><iconify-icon width="18" icon="icon-park-outline:font-search"></iconify-icon><span>14k words</span> </span><span class="text-gray-400">·</span> <span class="flex items-center gap-1"><iconify-icon width="16" icon="icon-park-outline:box" class="mr-2"></iconify-icon><a class="article-category-link" href="/categories/Project/">Project</a></span></section></div></div></header><article class="post-content prose m-auto slide-enter-content dark:prose-invert"><h1 id="Smart-OJ判题系统"><a href="#Smart-OJ判题系统" class="headerlink" title="Smart OJ判题系统"></a><code>Smart OJ</code>判题系统</h1><blockquote><h2 id="复习一下项目开发流程"><a href="#复习一下项目开发流程" class="headerlink" title="复习一下项目开发流程"></a>复习一下项目开发流程</h2><ol><li>项目简介、项目调研、项目需求分析</li><li>核心业务流程</li><li>项目功能模块</li><li>技术选型</li><li>项目初始化</li><li>项目开发</li><li>测试</li><li>优化<br>（代码提交、代码审核、产品验收）</li><li>上线</li></ol><p>在此过程中，也是要不断写文档、持续调研、沉淀知识的</p></blockquote><h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>OJ ： Online Judge（在线判题评测系统）<br>用户可以选择题目练习，在线编写代码，测试代码，提交代码，系统会根据设置好的答案对用户提交的代码进行评测，给出评测结果！</p><h4 id="项目亮点"><a href="#项目亮点" class="headerlink" title="项目亮点"></a>项目亮点</h4><ol><li>项目新颖，重复度低，写简历有区分度</li><li>区别于常见的<code>CRUD</code>项目，偏向于架构设计、编程思想之类的知识</li><li>项目复杂度高，可扩展性强</li></ol><h4 id="OJ系统的常用概念"><a href="#OJ系统的常用概念" class="headerlink" title="OJ系统的常用概念"></a>OJ系统的常用概念</h4><p>ac 表示你的题目通过，结果正确<br>题目限制：时间限制、内存限制<br>题目介绍<br>题目输入<br>题目输出<br>题目输入用例<br>题目输出用例</p><h4 id="难点-判题系统"><a href="#难点-判题系统" class="headerlink" title="难点:判题系统"></a><strong>难点</strong>:判题系统</h4><p>普通测评：</p><p>管理员设置题目的输入和输出用例，比如我输入 A，你要输出 B 才是正确的；交给判题机去执行用户的代码，给用户的代码喂输入用例，比如 A，看用户程序的执行结果是否和标准答案的输出一致。<br>（比对用例文件）</p><p>特殊测评（SPJ）：</p><p>管理员设置题目的输入和输出，比如我输入 1，用户的答案只要是 &gt; 0 或 &lt; 2 都是正确的；特判程序，不是通过对比用例文件是否一致这种死板的程序来检验，而是要专门根据这道题目写一个特殊的判断程序，程序接收题目的输入（1）、标准输出用例（2）、用户的结果（1.5） ，特判程序根据这些值来比较是否正确。</p><p>交互测评：</p><p>让用户输入一个例子，就给一个输出结果，交互比较灵活，没办法通过简单的、死板的输入输出文件来搞定<br><strong><em>不能让用户随便引入包、随便遍历、暴力破解，需要使用正确的算法。 =&gt; 安全性</em></strong><br><strong><em>判题过程是异步的 =&gt; 异步化</em></strong><br><strong><em>提交之后，会生成一个提交记录，有运行的结果以及运行信息（时间限制、内存限制）</em></strong></p><h2 id="项目调研"><a href="#项目调研" class="headerlink" title="项目调研"></a>项目调研</h2><p><a target="_blank" rel="noopener" href="https://github.com/HimitZH/HOJ(%E9%80%82%E5%90%88%E5%AD%A6%E4%B9%A0)">https://github.com/HimitZH/HOJ(适合学习)</a><br><a target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudge(python,%E4%B8%8D%E5%A5%BD%E5%AD%A6%EF%BC%8C%E5%BE%88%E6%88%90%E7%86%9F)">https://github.com/QingdaoU/OnlineJudge(python,不好学，很成熟)</a><br><a target="_blank" rel="noopener" href="https://github.com/hzxie/Noj(%E6%98%9F%E6%98%9F%E6%B2%A1%E9%82%A3%E4%B9%88%E5%A4%9A%EF%BC%8C%E6%B2%A1%E9%82%A3%E4%B9%88%E6%88%90%E7%86%9F%EF%BC%8C%E4%BD%86%E7%9B%B8%E5%AF%B9%E5%A5%BD%E5%AD%A6)">https://github.com/hzxie/Noj(星星没那么多，没那么成熟，但相对好学)</a><br><a target="_blank" rel="noopener" href="https://github.com/vfleaking/uoj(php%E5%AE%9E%E7%8E%B0%E7%9A%84)">https://github.com/vfleaking/uoj(php实现的)</a></p><h2 id="项目需求分析"><a href="#项目需求分析" class="headerlink" title="项目需求分析"></a>项目需求分析</h2><h4 id="实现核心"><a href="#实现核心" class="headerlink" title="实现核心"></a>实现核心</h4><ol><li>权限校验</li><li>代码沙箱（安全沙箱 – 防止代码藏毒）<br>代码安全：设置安全的、隔离的沙箱，以确保用户的代码不会影响到系统的安全</li><li>判题规则<br>题目用例的比对，结果的验证</li><li>任务调度<br>资源分配：防止用户疯狂占用资源，措施：异步化处理，服务资源有限，按照用户提交顺序进行判题</li></ol><h4 id="核心业务流程"><a href="#核心业务流程" class="headerlink" title="核心业务流程"></a>核心业务流程</h4><p><img src="https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311221849444.png#id=bhLKl&originHeight=441&originWidth=909&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="></p><h4 id="时序图："><a href="#时序图：" class="headerlink" title="时序图："></a>时序图：</h4><p><img src="https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311151640352.png#id=OaeO0&originHeight=863&originWidth=1173&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="></p><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><ol><li>题目模块<br>a. 管理员：创建、删除、修改<br>b. 用户：搜索题目<br>c. 在线做题、提交题目代码</li><li>用户模块<br>a. 注册与登录</li><li>判题模块<br>a. 提交判题（结果是否正确与错误）<br>b. 错误处理（内存溢出、安全性、超时）<br>c. 自主实现代码沙箱（安全、隔离的一个环境）<br>d. 开放接口</li></ol><h4 id="扩展思路"><a href="#扩展思路" class="headerlink" title="扩展思路"></a>扩展思路</h4><ol><li>支持多种语言</li><li>远程评测</li><li>完善的评测功能：普通评测、特殊评测、交互评测、在线自测、文件IO</li><li>统计分析判题记录</li><li>权限校验</li></ol><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><h4 id="前端："><a href="#前端：" class="headerlink" title="前端："></a>前端：</h4><p><code>Vue3、手撸Umi项目模板、AcroDesign组件库、在线代码编辑器、在线文档浏览</code></p><h4 id="后端："><a href="#后端：" class="headerlink" title="后端："></a>后端：</h4><p><code>Java进程控制、Java安全管理、部分JVM知识点、虚拟机、Docker、Spring Cloud微服务、消息队列</code></p><h2 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h2><p>采用分层架构：用户层、接入层、业务层、服务层、存储层、资源层</p><p><img src="E:/Master/TyporaImages/oj/image-20231122192355366.png" alt="OJ架构设计"></p><h2 id="项目排期"><a href="#项目排期" class="headerlink" title="项目排期"></a>项目排期</h2><ol><li>项目简介、项目调研、需求分析、技术选型、架构设计、现有<code>OJ</code>主流实现方案</li><li>前后端项目初始化、前端通用项目模板的搭建</li><li>主业务流程的前后端开发（争取把代码沙箱之外的全部搞定）</li><li>专攻代码沙箱（自主实现，不止一种实现方案，层层递进，通过实战用例来进行安全优化）</li><li>系统优化（微服务改造、系统扩展思路）</li></ol><h2 id="主流OJ实现方案"><a href="#主流OJ实现方案" class="headerlink" title="主流OJ实现方案"></a>主流OJ实现方案</h2><ol><li>用现成的<code>OJ</code>系统</li></ol><p>网上有很多开源的<code>OJ</code>项目，比如<code>青岛OJ</code>、<code>HustOJ</code>等，可以直接下载开源代码自己部署。<br>比较推荐的是<code>judge0</code>，这是一个非常成熟的<code>商业OJ</code>项目，支持 60 多种编程语言！</p><blockquote><p>代码：<a target="_blank" rel="noopener" href="https://github.com/judge0/judge0">https://github.com/judge0/judge0</a></p></blockquote><ol start="2"><li>用现成的服务</li></ol><p>如果你不希望完整部署一套大而全的代码，只是想复用他人已经实现的、最复杂的判题逻辑，那么可以直接使用现成的 判题<code>API</code>、或者现成的 代码沙箱 等服务。<br>比如<code>judge0</code>提供的<code>判题API</code>，非常方便易用。只需要通过 HTTP 调用<code>submissions</code>判题接口，把用户的代码、输入值、预期的执行结果作为请求参数发送给<code>judge0</code>的服务器，它就能自动帮你编译执行程序，并且返回程序的运行结果。<br><code>API</code>的作用：接受代码、返回执行结果</p><blockquote><p><code>Judge0 API</code>地址：<a target="_blank" rel="noopener" href="https://rapidapi.com/judge0-official/api/judge0-ce">https://rapidapi.com/judge0-official/api/judge0-ce</a><br>官方文档：<a target="_blank" rel="noopener" href="https://ce.judge0.com/#submissions-submission-post">https://ce.judge0.com/#submissions-submission-post</a></p></blockquote><blockquote><p>流程<br>1先注册<br>2再开通订阅<br>3然后测试 language 接口<br>4测试执行代码接口 submissions</p></blockquote><ol start="3"><li><strong>自主开发</strong>✨✨✨–我的方案</li></ol><p>自主实现判题服务和代码沙箱，适合学习，但不适用于商业项目。</p><ol start="4"><li>把 AI 来当做代码沙箱</li></ol><p>现在 AI 的能力已经十分强大了，我们可以把各种本来很复杂的功能直接交给 AI 来实现。<br>只要脑洞够大，AI + 编程 = 无限的可能~</p><ol start="5"><li>移花接木</li></ol><p>这种方式最有意思、也最 “缺德”。很多同学估计想不到。<br>那就是可以通过让程序来操作模拟浏览器的方式，用别人已经开发好的 OJ 系统来帮咱们判题。<br>比如使用 Puppeteer + 无头浏览器，把咱们系统用户提交的代码，像人一样输入到别人的 OJ 网页中，让程序点击提交按钮，并且等别人的 OJ 系统返回判题结果后，再把这个结果返回给我们自己的用户。<br>这种方式的缺点就是把核心流程交给了别人，如果别人服务挂了，你的服务也就挂了；而且别人 OJ 系统不支持的题目，可能你也支持不了。</p><h1 id="后端项目初始化"><a href="#后端项目初始化" class="headerlink" title="后端项目初始化"></a>后端项目初始化</h1><h3 id="五步走："><a href="#五步走：" class="headerlink" title="五步走："></a>五步走：</h3><ol><li>选中项目全局搜索替换springboot-init为新项目名</li><li>选中包，全局更改替换包名springbootinit</li><li>更改包名</li><li>本地新建数据库，直接执行sql/create table.sql脚本，修改库名为yuoj,执行即可</li><li>改application.yml配置，修改MySQL数据库的连接库名、账号密码，端口号</li></ol><h3 id="初始化模板待完善的地方："><a href="#初始化模板待完善的地方：" class="headerlink" title="初始化模板待完善的地方："></a>初始化模板待完善的地方：</h3><ol><li>日志：根据错误类型分类，分级归档</li><li>扩展：引入分布式锁、多线程、线程池</li></ol><h2 id="项目模板复习"><a href="#项目模板复习" class="headerlink" title="项目模板复习"></a>项目模板复习</h2><blockquote><p><strong>1)先阅读README.md</strong><br><strong>2)sql/create table.sql定义了数据库的初始化建库建表语句</strong><br><strong>3)sql/post_es mapping,json帖子表在ES中的建表语句</strong><br><strong>4)aop:用于全局权限校验、全局日志记录</strong><br><strong>5)common:万用的类，比如通用响应类</strong><br><strong>6)config:用于接收application.yml中的参数，初始化一些客户端的配置类（比如对象存储客户端）</strong><br><strong>7)constant:定义常量</strong><br><strong>8)controller:接受请求</strong><br><strong>9)esdao:类似mybatis的mapper,用于操作ES</strong><br><strong>10)exception:异常处理相关</strong><br><strong>11)job:任务相关（定时任务、单次任务）</strong><br><strong>12)manager:服务层（一般是定义一些公用的服务、对接第三方APl等）</strong><br><strong>13)mapper:mybatis的数据访问层，用于操作数据库</strong><br><strong>14)model:数据模型、实体类、包装类、枚举值</strong><br><strong>15)service:服务层，用于编写业务逻辑</strong><br><strong>16)utils:工具类，各种各样公用的方法</strong><br><strong>17)wxmp:公众号相关的包</strong><br><strong>18)test:单元测试</strong><br><strong>19)MainApplication:项目启动入口</strong><br><strong>20)Dockerfile:用于构建Docker镜像</strong></p></blockquote><h2 id="基本开发流程"><a href="#基本开发流程" class="headerlink" title="基本开发流程"></a>基本开发流程</h2><h3 id="库表设计"><a href="#库表设计" class="headerlink" title="库表设计"></a>库表设计</h3><ol><li>根据功能设计库表<ol><li>用户表</li></ol></li></ol><p>字段：id、账号、密码、昵称、头像、简介、用户角色、微信开放平台id、公众号openId、创建时间、修改时间、是否删除（项目全局配置文件中已经配置了 MybatisPlus isDelete 字段为逻辑删除）</p><pre><code>  2. 题目表
</code></pre><p>字段：<br>题目相关：id、标题、内容、标签、答案、提交数量、通过数量、通关率（扩展）；<br>判题相关：判题用例（judgeCase / json）、判题限制（judgeConfig / json）、判题类型（扩展）；</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1 2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3 4&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1 3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2 4&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;timeLimit&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;memoryLimit&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;stackLimit&quot;</span><span class="punctuation">:</span> <span class="number">1000</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><pre><code>  3. 用户-题目提交表
</code></pre><p>字段：用户id、题目id、语言、代码、判题状态、判题信息（judgeInfo / json）;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;$ 判题信息枚举值 $&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span> <span class="comment">// 单位：ms</span></span><br><span class="line">  <span class="attr">&quot;memory&quot;</span><span class="punctuation">:</span> <span class="number">1000</span>  <span class="comment">// 单位：kb</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>枚举值信息：</p><pre><code>     - ACCEPT                      通过
     - WRONG_ANSWER            答案错误
     - COMPILE_ERROR            编译错误
     - MEMORY_LIMIT_EXCEEDED    内存溢出
     - TIME_LIMIT_EXCEETED        超时
     - PRESENTATION_ERROR        展示错误
     - OUTPUT_LIMIT_EXCEEDED        输出溢出
     - WAITING                    等待中
     - DANGEROUS_OPERATION        危险操作
     - RUNTIME_ERROR            运行错误
     - SYSTEM_ERROR             系统错误
</code></pre><blockquote><p>数据库表字段存 json 的<strong>前提：</strong><br>首先，字段含义相关，属于同一类；<br>其次，不需要根据 json 中的某一字段进行查询；<br>最后，字段存储不用占用太多空间。<br>存 json 的<strong>好处：</strong><br>便于扩展，即：不用修改库表结构，就可以直接操作对象内部的字段<br>小知识（数据库索引）：<br>什么时候适合加索引？如何给某个字段加上索引？<br>首先，索引需要建立在有区分度的字段上；<br>其次，需要从我们的实际业务出发，无论是单个索引，还是联合索引，都需要从实际的查询语句、字段枚举值的区分度、字段的类型考虑，特别是 where 条件指定的字段。<br>例如：where userId = 1 and questionId = 2，这个时候就可以分别建立索引，或者是联合索引，<strong>如果是数据量不大的话，尽量不用索引，因为索引也需要占用空间。（待考证！！！）</strong></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># 数据库初始化</span><br><span class="line"># <span class="variable">@author</span> <span class="operator">&lt;</span>a href<span class="operator">=</span>&quot;https://github.com/wl2o2o&quot;<span class="operator">&gt;</span>程序员CS_GUIDER<span class="operator">&lt;</span><span class="operator">/</span>a<span class="operator">&gt;</span></span><br><span class="line"># <span class="variable">@from</span> <span class="operator">&lt;</span>a href<span class="operator">=</span>&quot;https://wl2o2o.github.io&quot;<span class="operator">&gt;</span>CS_GUIDER博客<span class="operator">&lt;</span><span class="operator">/</span>a<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建库</span></span><br><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> smartoj;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换库</span></span><br><span class="line">use smartoj;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span> (</span><br><span class="line">  id        	     <span class="type">bigint</span>           auto_increment                        		comment <span class="string">&#x27;id&#x27;</span>   	             <span class="keyword">primary</span> key,</span><br><span class="line">  userAccount      <span class="type">varchar</span>(<span class="number">256</span>)  															  <span class="keyword">not</span> <span class="keyword">null</span>  		comment <span class="string">&#x27;用户账号&#x27;</span>,</span><br><span class="line">  userPassword     <span class="type">varchar</span>(<span class="number">512</span>)						          						<span class="keyword">not</span> <span class="keyword">null</span>    	comment <span class="string">&#x27;用户密码&#x27;</span>,</span><br><span class="line">  userName 		     <span class="type">varchar</span>(<span class="number">256</span>)  								 							 			<span class="keyword">null</span> 	    comment <span class="string">&#x27;用户昵称&#x27;</span>,</span><br><span class="line">  userAvatar 	     <span class="type">varchar</span>(<span class="number">1024</span>) 								  									<span class="keyword">null</span> 	   	comment <span class="string">&#x27;用户头像&#x27;</span>,</span><br><span class="line">  userProfile      <span class="type">varchar</span>(<span class="number">512</span>)							 	  										<span class="keyword">null</span>      comment <span class="string">&#x27;用户简介&#x27;</span>,</span><br><span class="line">  userRole 	 	     <span class="type">varchar</span>(<span class="number">256</span>)     <span class="keyword">default</span> <span class="string">&#x27;user&#x27;</span>			  			<span class="keyword">not</span> <span class="keyword">null</span>    	comment <span class="string">&#x27;用户角色&#x27;</span>,</span><br><span class="line">  unionId			 		 <span class="type">varchar</span>(<span class="number">256</span>)								  										<span class="keyword">null</span>		  comment <span class="string">&#x27;微信开放平台id&#x27;</span>,</span><br><span class="line">  mpOpenId 		     <span class="type">varchar</span>(<span class="number">256</span>)					   										   		<span class="keyword">null</span> 	    comment <span class="string">&#x27;微信公众号id&#x27;</span>,</span><br><span class="line">  createTime	     datetime         <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span>   <span class="keyword">not</span> <span class="keyword">null</span>	  	comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  updateTime       datetime         <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span>   <span class="keyword">not</span> <span class="keyword">null</span>    	<span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  isDelete         tinyint          <span class="keyword">default</span> <span class="number">0</span>					  				<span class="keyword">not</span> <span class="keyword">null</span>  	  comment <span class="string">&#x27;逻辑删除&#x27;</span>,</span><br><span class="line">  index 			 		 idx_unionId      (unionId)</span><br><span class="line">) comment <span class="string">&#x27;用户表&#x27;</span>  <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 字段：</span><br><span class="line"># 题目相关：id、标题、内容、标签、答案、提交数量、通过数量、通关率（扩展）；</span><br><span class="line"># 判题相关：判题用例（judgeCase <span class="operator">/</span> json）、判题限制（judgeConfig <span class="operator">/</span> json）、判题类型（扩展）；</span><br><span class="line"><span class="comment">-- 题目表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> if <span class="keyword">not</span> <span class="keyword">exists</span> question (</span><br><span class="line">  id        	     <span class="type">bigint</span>      	  auto_increment                         			comment <span class="string">&#x27;题目id&#x27;</span>              <span class="keyword">primary</span> key,</span><br><span class="line">  userId        	 <span class="type">bigint</span>        															 	<span class="keyword">not</span> <span class="keyword">null</span>    	comment <span class="string">&#x27;创建用户id&#x27;</span>,</span><br><span class="line">  title			    	 <span class="type">varchar</span>(<span class="number">256</span>)  								 								<span class="keyword">not</span> <span class="keyword">null</span>    	comment <span class="string">&#x27;题目标题&#x27;</span>,</span><br><span class="line">  tags 			     	 <span class="type">varchar</span>(<span class="number">256</span>)				    		 	 								<span class="keyword">not</span> <span class="keyword">null</span>    	comment <span class="string">&#x27;题目标签&#x27;</span>,</span><br><span class="line">  content          text							        									  <span class="keyword">not</span> <span class="keyword">null</span>    	comment <span class="string">&#x27;题目内容&#x27;</span>,</span><br><span class="line">  answer	 	  	   text				  						 												<span class="keyword">null</span> 	    comment <span class="string">&#x27;题目答案&#x27;</span>,</span><br><span class="line">  judgeCase	 	     text 								     	 									<span class="keyword">not</span> <span class="keyword">null</span>    	comment <span class="string">&#x27;判题用例&#x27;</span>,</span><br><span class="line">  judgeConfig	     text									     												<span class="keyword">null</span>			comment <span class="string">&#x27;判题限制&#x27;</span>,</span><br><span class="line">  submitNum 	     <span class="type">int</span> 					  <span class="keyword">default</span> <span class="number">0</span>					 								<span class="keyword">null</span> 	    comment <span class="string">&#x27;提交数量&#x27;</span>,</span><br><span class="line">  acceptNum        <span class="type">int</span>         	  <span class="keyword">default</span> <span class="number">0</span>	 			  	 							<span class="keyword">null</span>      comment <span class="string">&#x27;通过数量&#x27;</span>,</span><br><span class="line">  thumbNum 		     <span class="type">int</span>			  		<span class="keyword">default</span> <span class="number">0</span>												 	<span class="keyword">null</span> 	    comment <span class="string">&#x27;点赞数量&#x27;</span>,</span><br><span class="line">  favourNum		     <span class="type">int</span> 	   		  	<span class="keyword">default</span> <span class="number">0</span>					 								<span class="keyword">null</span> 	    comment <span class="string">&#x27;收藏数量&#x27;</span>,</span><br><span class="line">  createTime	     datetime       <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span>  		<span class="keyword">not</span> <span class="keyword">null</span>	 		comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  updateTime       datetime       <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> 		<span class="keyword">not</span> <span class="keyword">null</span>   		<span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span>  comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  isDelete         tinyint        <span class="keyword">default</span> <span class="number">0</span>                 		<span class="keyword">not</span> <span class="keyword">null</span>    	comment <span class="string">&#x27;逻辑删除&#x27;</span>,</span><br><span class="line">  index 			 		 idx_userId     (userId)</span><br><span class="line">) comment <span class="string">&#x27;题目表&#x27;</span>  <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 字段：用户id、题目id、语言、代码、判题状态、判题信息（judgeInfo <span class="operator">/</span> json）;</span><br><span class="line"><span class="comment">-- 题目提交表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> if <span class="keyword">not</span> <span class="keyword">exists</span> question_submit (</span><br><span class="line">  id                <span class="type">bigint</span>          auto_increment                           comment <span class="string">&#x27;id&#x27;</span>		<span class="keyword">primary</span> key,</span><br><span class="line">  userId            <span class="type">bigint</span>                                      <span class="keyword">not</span> <span class="keyword">null</span>     comment <span class="string">&#x27;创建用户 id&#x27;</span>,</span><br><span class="line">  questionId        <span class="type">bigint</span>                                      <span class="keyword">not</span> <span class="keyword">null</span>     comment <span class="string">&#x27;题目 id&#x27;</span>,</span><br><span class="line">  <span class="keyword">language</span>          <span class="type">varchar</span>(<span class="number">128</span>)                                <span class="keyword">not</span> <span class="keyword">null</span>     comment <span class="string">&#x27;编程语言&#x27;</span>,</span><br><span class="line">  code              text                                        <span class="keyword">not</span> <span class="keyword">null</span>     comment <span class="string">&#x27;用户代码&#x27;</span>,</span><br><span class="line">  status            <span class="type">int</span>             <span class="keyword">default</span> <span class="number">0</span>                   <span class="keyword">not</span> <span class="keyword">null</span>     comment <span class="string">&#x27;判题状态（0 - 待判题、1 - 判题中、2 - 成功、3 - 失败）&#x27;</span>,</span><br><span class="line">  judgeInfo         text                                        		<span class="keyword">null</span>     comment <span class="string">&#x27;判题信息（json 对象）&#x27;</span>,</span><br><span class="line">  createTime        datetime        <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span>   <span class="keyword">not</span> <span class="keyword">null</span>     comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  updateTime        datetime        <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span>   <span class="keyword">not</span> <span class="keyword">null</span>     <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  isDelete          tinyint         <span class="keyword">default</span> <span class="number">0</span>                   <span class="keyword">not</span> <span class="keyword">null</span>     comment <span class="string">&#x27;是否删除&#x27;</span>,</span><br><span class="line">  index             idx_questionId  (questionId),</span><br><span class="line">  index             idx_userId      (userId)</span><br><span class="line"></span><br><span class="line">) comment <span class="string">&#x27;题目提交表&#x27;</span>  <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure><h3 id="代码生成方法"><a href="#代码生成方法" class="headerlink" title="代码生成方法"></a>代码生成方法</h3><ol><li>使用 MyBatisX 插件，会自动根据库表字段，一键生成业务的基础 CRUD 代码</li><li>编写 Controller 层代码（根据模板进行复用，复制逻辑相同代码，替换字段）</li><li>编写 DTO、VO、枚举值字段，用于接受前端请求或者业务间传递信息。（复用项目模板）</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.yuoj.model.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ObjectUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 题目提交编程语言枚举</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href=&quot;https://github.com/liyupi&quot;&gt;程序员鱼皮&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@from</span> &lt;a href=&quot;https://yupi.icu&quot;&gt;编程导航知识星球&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">QuestionSubmitLanguageEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    JAVA(<span class="string">&quot;java&quot;</span>, <span class="string">&quot;java&quot;</span>),</span><br><span class="line">    CPLUSPLUS(<span class="string">&quot;c++&quot;</span>, <span class="string">&quot;c++&quot;</span>),</span><br><span class="line">    GOLANG(<span class="string">&quot;golang&quot;</span>, <span class="string">&quot;golang&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String value;</span><br><span class="line"></span><br><span class="line">    QuestionSubmitLanguageEnum(String text, String value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.text = text;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取值列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">getValues</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(values()).map(item -&gt; item.value).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 value 获取枚举</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> QuestionSubmitLanguageEnum <span class="title function_">getEnumByValue</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (QuestionSubmitLanguageEnum anEnum : QuestionSubmitLanguageEnum.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (anEnum.value.equals(value)) &#123;</span><br><span class="line">                <span class="keyword">return</span> anEnum;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getText</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>编写一些独立的类，因为以上库表中设计的含有 JSON 字段，为了方便处理 JSON 中的某个字段。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 题目用例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JudgeCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输入用例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String input;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出用例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>校验 Controller 类，解决报错</li><li>编写 Service 代码，完成业务逻辑</li></ol><blockquote><p><strong>小知识：</strong><br><strong>为什么要加上业务前缀（上述代码中的JudgeCase），什么时候不加？</strong><br>首先，增加业务前缀有利于增加区分度，防止多表中重复类名产生冲突；<br>其次，通常情况下，我们希望抽出一个公用类来共享，这时不需加业务前缀。<br><strong>什么是 VO 类？有什么用？</strong><br>VO：View Object（显示层对象）—— 专门给前端返回、显示的对象，一般会过滤脱敏掉一些不需要返回给前端的字段，保证安全性，不仅更加方便展示给用户，而且方便展示给前端开发者，还可以节约网络传输大小。<br>DTO：Data Transfer Object（数据传输对象）<br>BO：Bussiness Object（业务对象）<br><strong>怎么防止爬虫爬取题目？有什么简单的方法？</strong><br>建议把题目的 id 生成规则 改为 ASSIGN_ID ，这样就可以通过其底层的雪花算法：ASSIGN_UUID 随机生成一个 32 位的 id，有效避免爬虫对题目的爬取。<br>示例：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* id</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure><h3 id="查询提交信息接口（网站的提交信息实时监控面板）"><a href="#查询提交信息接口（网站的提交信息实时监控面板）" class="headerlink" title="查询提交信息接口（网站的提交信息实时监控面板）"></a>查询提交信息接口（网站的提交信息实时监控面板）</h3><ul><li>功能：<ul><li>根据用户 ID 查询</li><li>题目 ID 查询</li><li>编程语言查询</li><li>题目状态查询</li></ul></li><li>注意事项：<ul><li>非管理员和本人，不得观看其他用户的代码</li></ul></li><li>实现方案：<ul><li>查询 ==&gt; 根据权限脱敏</li><li></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> QuestionSubmitVO <span class="title function_">getQuestionSubmitVO</span><span class="params">(QuestionSubmit questionSubmit, User loginUser)</span> &#123;</span><br><span class="line">    <span class="type">QuestionSubmitVO</span> <span class="variable">questionSubmitVO</span> <span class="operator">=</span> QuestionSubmitVO.objToVo(questionSubmit);</span><br><span class="line">    <span class="comment">// 脱敏：仅本人和管理员能看见自己（提交 userId 和登录用户 id 不同）提交的代码</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getId();</span><br><span class="line">    <span class="comment">// 处理脱敏</span></span><br><span class="line">    <span class="keyword">if</span> (userId != questionSubmit.getUserId() &amp;&amp; !userService.isAdmin(loginUser)) &#123;</span><br><span class="line">        questionSubmitVO.setCode(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> questionSubmitVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>todo: 熟悉快速 CRUD 的步骤，过项目模板，充分理解；完善更加通用的 Controller、Service 代码。</em></strong></p><h2 id="判题机模块架构设计"><a href="#判题机模块架构设计" class="headerlink" title="判题机模块架构设计"></a>判题机模块架构设计</h2><blockquote><p>这就是架构师的工作：先跑通完整的业务流程，在进行代码沙箱复杂的实现</p></blockquote><h2 id="判题模块与代码沙箱的关系"><a href="#判题模块与代码沙箱的关系" class="headerlink" title="判题模块与代码沙箱的关系"></a>判题模块与代码沙箱的关系</h2><p><strong>判题模块：</strong><br>调用代码沙箱，把代码和输入用例交给代码沙箱去执行<br><strong>代码沙箱：</strong><br>接收代码和输入用例，返回编译运行的结果，不负责判题（可以作为独立的项目或者服务，提供给其他需要执行代码的项目去使用）<br><strong>架构图：</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/35457700/1702951349750-208e4b83-f387-4644-817a-bc68dd84dafd.jpeg"><br><strong>思考：</strong><br>为什么要直接执行一组输入用例和输出一组运行结果？<br>试想，如果是对于每一个用例都要执行调用一次 代码沙箱 API 接口的话，需要多次的网络传输、程序需要多次的编译、记录程序的执行状态。造成的资源浪费严重。<br>这样就是骆驼驮运货物是分多次还是一次性过河！</p><blockquote><p>这是一种很常见的性能优化的方法：批处理！</p></blockquote><h2 id="代码沙箱架构开发"><a href="#代码沙箱架构开发" class="headerlink" title="代码沙箱架构开发"></a>代码沙箱架构开发</h2><blockquote><p>为了提高代码沙箱的通用性（便于后期进行扩展 AI 判题或者远程判题），<br>我们定义代码沙箱为接口，这样就便于后期进行扩展了⭐⭐⭐⭐⭐</p></blockquote><ol><li>定义代码沙箱为接口，提高通用性</li></ol><p>这样，我们之后的项目判题模块代码只调用代码沙箱的接口进行判题，不用调用实现类，<br>这样就可以不用更改代码了（之更改调用的接口）</p><blockquote><p>TODO: 代码沙箱的请求接口中，判题的 timeLimit 可以不加，也或者自行扩展（扩展点）<br>扩展思路：增加一个代码沙箱状态的接口</p></blockquote><ol start="2"><li>定义所种不通风的代码沙箱的实现</li></ol><p>示例代码沙箱——打通流程<br>远程代码沙箱——调用实际的接口<br>第三方代码沙箱——调用网上现成的代码沙箱（例如：goJudge——<a target="_blank" rel="noopener" href="https://github.com/criyle/go-judge">https://github.com/criyle/go-judge</a>）</p><ol start="3"><li>编写单元测试，验证单个代码沙箱的执行</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CodeSandboxTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">executeCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CodeSandbox</span> <span class="variable">codeSandbox</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteCodeSandbox</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> <span class="string">&quot;int main() &#123; &#125;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">language</span> <span class="operator">=</span> QuestionSubmitLanguageEnum.JAVA.getValue();</span><br><span class="line">        List&lt;String&gt; inputList = Arrays.asList(<span class="string">&quot;1 2&quot;</span>, <span class="string">&quot;3 4&quot;</span>);</span><br><span class="line">        <span class="type">ExecuteCodeRequest</span> <span class="variable">executeCodeRequest</span> <span class="operator">=</span> ExecuteCodeRequest.builder()</span><br><span class="line">                .code(code)</span><br><span class="line">                .language(language)</span><br><span class="line">                .inputList(inputList)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">ExecuteCodeResponse</span> <span class="variable">executeCodeResponse</span> <span class="operator">=</span> codeSandbox.executeCode(executeCodeRequest);</span><br><span class="line">        Assertions.assertNotNull(executeCodeResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>目前还存在一个问题，就是我们的测试中把代码沙箱的选择已经写死了，如果项目后面需要改为其他沙箱，那么就需要改动很多代码。所以。。。。。。</p><p>我们可以使用<strong>工厂模式来解决这个难题。</strong></p><ol start="4"><li>使用工厂模式，直接根据用户在配置文件中传入的字符串参数（指定的沙箱类别），来生成对应的代码沙箱实现类</li></ol><blockquote><p>此处，我们使用的是静态工厂模式，实现比较简单，符合需求</p></blockquote><p><strong>示例代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 代码沙箱工厂（根据字符串参数创建指定的代码沙箱实例）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeSandboxFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建代码沙箱示例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 沙箱类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CodeSandbox <span class="title function_">newInstance</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;example&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ExampleCodeSandbox</span>();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;remote&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RemoteCodeSandbox</span>();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;thirdParty&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThirdPartyCodeSandbox</span>();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ExampleCodeSandbox</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>扩展思路：<br>如果确定代码沙箱中不会出现线程安全问题，你什么可以使用单例工厂模式。<br>详细见聚合搜索项目。</p></blockquote><p><strong>使用工厂模式：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">        <span class="type">CodeSandbox</span> <span class="variable">codeSandbox</span> <span class="operator">=</span> CodeSandboxFactory.newInstance(type);</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> <span class="string">&quot;int main() &#123; &#125;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">language</span> <span class="operator">=</span> QuestionSubmitLanguageEnum.JAVA.getValue();</span><br><span class="line">        List&lt;String&gt; inputList = Arrays.asList(<span class="string">&quot;1 2&quot;</span>, <span class="string">&quot;3 4&quot;</span>);</span><br><span class="line">        <span class="type">ExecuteCodeRequest</span> <span class="variable">executeCodeRequest</span> <span class="operator">=</span> ExecuteCodeRequest.builder()</span><br><span class="line">        .code(code)</span><br><span class="line">        .language(language)</span><br><span class="line">        .inputList(inputList)</span><br><span class="line">        .build();</span><br><span class="line">        <span class="type">ExecuteCodeResponse</span> <span class="variable">executeCodeResponse</span> <span class="operator">=</span> codeSandbox.executeCode(executeCodeRequest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>参数配置化：</strong></li></ol><p>在<code>application.yml</code>中进行配置指定代码沙箱的变量：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 代码沙箱配置</span></span><br><span class="line"><span class="attr">codesandbox:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">example</span></span><br></pre></td></tr></table></figure><p><strong>在 Spring 的 Bean 中通过</strong><code>**@Value**</code><strong>注解来使用配置文件中的代码沙箱：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;codesandbox.type:example&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String type;</span><br></pre></td></tr></table></figure><ol start="6"><li>代码能力增强</li></ol><blockquote><p>比如，我们需要调用代码沙箱前后输出参数日志，输出响应结果日志，便于管理员进行分析。<br>那么我们需要在每一个类中都写上<code>log.info</code>吗？</p></blockquote><p><strong>代理模式：</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/35457700/1702979899931-2ef8c2d9-4bdf-4f01-97fc-3c23a5dc3c7a.jpeg"></p><p><strong>代理模式的实现原理：</strong></p><ol><li>实现被代理的接口</li><li>通过构造函数接受一个被代理的接口实现类</li><li>通过被代理的接口实现类，增加代理需要实现的操作</li></ol><p><strong>示例代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeSandboxProxy</span> <span class="keyword">implements</span> <span class="title class_">CodeSandbox</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CodeSandbox codeSandbox;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CodeSandboxProxy</span><span class="params">(CodeSandbox codeSandbox)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.codeSandbox = codeSandbox;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ExecuteCodeResponse <span class="title function_">executeCode</span><span class="params">(ExecuteCodeRequest executeCodeRequest)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;代码沙箱请求信息：&quot;</span> + executeCodeRequest.toString());</span><br><span class="line">        <span class="type">ExecuteCodeResponse</span> <span class="variable">executeCodeResponse</span> <span class="operator">=</span> codeSandbox.executeCode(executeCodeRequest);</span><br><span class="line">        log.info(<span class="string">&quot;代码沙箱响应信息：&quot;</span> + executeCodeResponse.toString());</span><br><span class="line">        <span class="keyword">return</span> executeCodeResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>使用方式：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CodeSandbox</span> <span class="variable">codeSandbox</span> <span class="operator">=</span> CodeSandboxFactory.newInstance(type);</span><br><span class="line">codeSandbox = <span class="keyword">new</span> <span class="title class_">CodeSandboxProxy</span>(codeSandbox);</span><br></pre></td></tr></table></figure><ol start="7"><li>实现示例代码沙箱</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 示例代码沙箱（仅为了跑通业务流程）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleCodeSandbox</span> <span class="keyword">implements</span> <span class="title class_">CodeSandbox</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ExecuteCodeResponse <span class="title function_">executeCode</span><span class="params">(ExecuteCodeRequest executeCodeRequest)</span> &#123;</span><br><span class="line">        List&lt;String&gt; inputList = executeCodeRequest.getInputList();</span><br><span class="line">        <span class="type">ExecuteCodeResponse</span> <span class="variable">executeCodeResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExecuteCodeResponse</span>();</span><br><span class="line">        executeCodeResponse.setOutputList(inputList);</span><br><span class="line">        executeCodeResponse.setMessage(<span class="string">&quot;测试执行成功&quot;</span>);</span><br><span class="line">        executeCodeResponse.setStatus(QuestionSubmitStatusEnum.SUCCEED.getValue());</span><br><span class="line">        <span class="type">JudgeInfo</span> <span class="variable">judgeInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JudgeInfo</span>();</span><br><span class="line">        judgeInfo.setMessage(JudgeInfoMessageEnum.ACCEPTED.getText());</span><br><span class="line">        judgeInfo.setMemory(<span class="number">100L</span>);</span><br><span class="line">        judgeInfo.setTime(<span class="number">100L</span>);</span><br><span class="line">        executeCodeResponse.setJudgeInfo(judgeInfo);</span><br><span class="line">        <span class="keyword">return</span> executeCodeResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>知识点 - LomBok Buider 注解：</strong><br>我们通常创建一个对象之后都是通过 set、get 进行存取值的，其实还有一种更为便捷的 set 值的方式：builder</p><p><strong>使用方法：</strong></p><ol><li>实体类加上<code>@Builder</code>注解</li><li>链式地给对象进行赋值</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Animals</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">Animals</span> <span class="variable">dog</span> <span class="operator">=</span> Animals.builder()</span><br><span class="line">	.id(<span class="number">1</span>)</span><br><span class="line">	.name(<span class="string">&quot;翠花&quot;</span>)</span><br><span class="line">	.age(<span class="number">18</span>)</span><br><span class="line">	.builder();</span><br></pre></td></tr></table></figure><blockquote><p>TODO 完成示例代码沙箱 —&gt; 改为远程代码沙箱</p></blockquote><h2 id="判题服务完整业务流程开发"><a href="#判题服务完整业务流程开发" class="headerlink" title="判题服务完整业务流程开发"></a>判题服务完整业务流程开发</h2><p><strong>判题服务业务流程：</strong></p><ol><li>传入题目的 id ，获取到对应的题目、提交信息（包含代码、编程语言等）</li><li>调用沙箱，获取执行结果</li><li>根据执行结果，判断 –&gt; 设置题目判题状态与信息</li></ol><blockquote><p>以上是最基本的判题业务流程，但是还不够完整，存在点击多次、多次判题的 Bug，那么就要给判题设置一个状态了！</p></blockquote><p><strong>完善后的判题服务业务流程：</strong></p><ol><li>传入题目的 id ，获取到对应的题目、提交信息（包含代码、编程语言等）</li><li><strong>if （判题状态不为等待中） 抛出异常;</strong></li><li><strong>更改判题状态为判题中</strong></li><li>调用沙箱，获取执行结果</li><li>根据代码沙箱执行结果，判断运行结果是否则正确 –&gt; 设置题目最终的判题状态与信息</li></ol><p><strong>判断逻辑：</strong></p><ol><li>先判断，代码沙箱执行的结果输出数量是否和预期输出数量是否一致</li><li>依次判断每一项的预期输出是否相等</li><li>判题题目的限制是否符合要求</li><li>其他异常</li></ol><p><strong>注意：</strong><br>如果我们的代码沙箱执行程序需要十秒钟，这个时间可能根据编程语言的不同而该变动，那么怎么解决？</p><p>A：我们可以<strong>采取策略模式</strong>，针对不同的情况，定义不同的策略，以便于进行修改与维护。这样就可以<strong>改善业务代码中</strong><code>**if else**</code><strong>成堆，业务逻辑不清晰</strong>的情况。</p><p><strong>如何实现策略模式？</strong></p><ol><li>定义判题上下文对象，用于定义在策略中传递的参数（可以理解为DTO）</li><li>定义策略接口，让代码更加通用化</li><li>实现默认的业务策略（剪切<code>judgeService</code>中判题逻辑的相关代码）</li><li>针对不同语言实际情况，定义不同的策略</li></ol><blockquote><p>切换策略时，难免会使用<code>if else</code>，考虑到降低耦合度，我们可以将切换策略的逻辑抽离出来，单独编写一个判断切换策略的类</p></blockquote><ol start="5"><li>编写一个判断切换策略的类<code>StrategyManage</code></li></ol><p><strong>示例代码：</strong></p><ol><li>定义判题上下文对象</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JudgeContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JudgeInfo judgeInfo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; inputList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; outputList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;JudgeCase&gt; judgeCaseList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Question question;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> QuestionSubmit questionSubmit;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>定义判题策略接口</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">JudgeStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行判题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> judgeContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    JudgeInfo <span class="title function_">doJudge</span><span class="params">(JudgeContext judgeContext)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>实现默认判题策略</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wl2o2o.smartoj.judge.strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONUtil;</span><br><span class="line"><span class="keyword">import</span> com.wl2o2o.smartoj.model.dto.question.JudgeCase;</span><br><span class="line"><span class="keyword">import</span> com.wl2o2o.smartoj.model.dto.question.JudgeConfig;</span><br><span class="line"><span class="keyword">import</span> com.wl2o2o.smartoj.model.dto.questionsubmit.JudgeInfo;</span><br><span class="line"><span class="keyword">import</span> com.wl2o2o.smartoj.model.entity.Question;</span><br><span class="line"><span class="keyword">import</span> com.wl2o2o.smartoj.model.enums.JudgeInfoMessageEnum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 默认判题策略</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> WL2O2O</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023/12/19 1:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultJudgeStrategy</span> <span class="keyword">implements</span> <span class="title class_">JudgeStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行判题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> judgeContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> JudgeInfo <span class="title function_">doJudge</span><span class="params">(JudgeContext judgeContext)</span> &#123;</span><br><span class="line">        <span class="type">JudgeInfo</span> <span class="variable">judgeInfo</span> <span class="operator">=</span> judgeContext.getJudgeInfo();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">memory</span> <span class="operator">=</span> judgeInfo.getMemory();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">time</span> <span class="operator">=</span> judgeInfo.getTime();</span><br><span class="line">        List&lt;String&gt; inputList = judgeContext.getInputList();</span><br><span class="line">        List&lt;String&gt; outputList = judgeContext.getOutputList();</span><br><span class="line">        <span class="type">Question</span> <span class="variable">question</span> <span class="operator">=</span> judgeContext.getQuestion();</span><br><span class="line">        List&lt;JudgeCase&gt; judgeCaseList = judgeContext.getJudgeCaseList();</span><br><span class="line">        <span class="type">JudgeInfoMessageEnum</span> <span class="variable">judgeInfoMessageEnum</span> <span class="operator">=</span> JudgeInfoMessageEnum.ACCEPTED;</span><br><span class="line">        <span class="type">JudgeInfo</span> <span class="variable">judgeInfoResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JudgeInfo</span>();</span><br><span class="line">        judgeInfoResponse.setMemory(memory);</span><br><span class="line">        judgeInfoResponse.setTime(time);</span><br><span class="line">        <span class="comment">// 先判断沙箱执行的结果输出数量是否和预期输出数量相等</span></span><br><span class="line">        <span class="keyword">if</span> (outputList.size() != inputList.size()) &#123;</span><br><span class="line">            judgeInfoMessageEnum = JudgeInfoMessageEnum.WRONG_ANSWER;</span><br><span class="line">            judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());</span><br><span class="line">            <span class="keyword">return</span> judgeInfoResponse;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 依次判断每一项输出和预期输出是否相等</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; judgeCaseList.size(); i++) &#123;</span><br><span class="line">            <span class="type">JudgeCase</span> <span class="variable">judgeCase</span> <span class="operator">=</span> judgeCaseList.get(i);</span><br><span class="line">            <span class="keyword">if</span> (!judgeCase.getOutput().equals(outputList.get(i))) &#123;</span><br><span class="line">                judgeInfoMessageEnum = JudgeInfoMessageEnum.WRONG_ANSWER;</span><br><span class="line">                judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());</span><br><span class="line">                <span class="keyword">return</span> judgeInfoResponse;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断题目限制</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">judgeConfigStr</span> <span class="operator">=</span> question.getJudgeConfig();</span><br><span class="line">        <span class="type">JudgeConfig</span> <span class="variable">judgeConfig</span> <span class="operator">=</span> JSONUtil.toBean(judgeConfigStr, JudgeConfig.class);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">needMemoryLimit</span> <span class="operator">=</span> judgeConfig.getMemoryLimit();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">needTimeLimit</span> <span class="operator">=</span> judgeConfig.getTimeLimit();</span><br><span class="line">        <span class="keyword">if</span> (memory &gt; needMemoryLimit) &#123;</span><br><span class="line">            judgeInfoMessageEnum = JudgeInfoMessageEnum.MEMORY_LIMIT_EXCEEDED;</span><br><span class="line">            judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());</span><br><span class="line">            <span class="keyword">return</span> judgeInfoResponse;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (time &gt; needTimeLimit) &#123;</span><br><span class="line">            judgeInfoMessageEnum = JudgeInfoMessageEnum.TIME_LIMIT_EXCEEDED;</span><br><span class="line">            judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());</span><br><span class="line">            <span class="keyword">return</span> judgeInfoResponse;</span><br><span class="line">        &#125;</span><br><span class="line">        judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());</span><br><span class="line">        <span class="keyword">return</span> judgeInfoResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>新增一种判题策略，在<code>JudgeServiceImpl</code>中通过<code>if else</code>的方式来选择使用哪种策略</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">JudgeStrategy</span> <span class="variable">judgeStrategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultJudgeStrategy</span>();</span><br><span class="line"><span class="keyword">if</span> (language.equals(<span class="string">&quot;java&quot;</span>)) &#123;</span><br><span class="line">    judgeStrategy = <span class="keyword">new</span> <span class="title class_">JavaLanguageJudgeStrategy</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">JudgeInfo</span> <span class="variable">judgeInfo</span> <span class="operator">=</span> judgeStrategy.doJudge(judgeContext);</span><br></pre></td></tr></table></figure><blockquote><p>注意：如果判题策略的过程比较复杂，service 实现类代码会比较臃肿。<br>那么为了让调用方写更少的代码、调用最简单化。<br>我们可以将判断使用哪个策略的部分代码抽离出来，编写<code>StrategyManage</code>类，用来单独判断策略。</p></blockquote><ol start="5"><li>编写<code>StrategyManage</code>类，用来单独判断策略</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判题管理（简化调用）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JudgeManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行判题</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> judgeContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    JudgeInfo <span class="title function_">doJudge</span><span class="params">(JudgeContext judgeContext)</span> &#123;</span><br><span class="line">        <span class="type">QuestionSubmit</span> <span class="variable">questionSubmit</span> <span class="operator">=</span> judgeContext.getQuestionSubmit();</span><br><span class="line">        <span class="type">String</span> <span class="variable">language</span> <span class="operator">=</span> questionSubmit.getLanguage();</span><br><span class="line">        <span class="type">JudgeStrategy</span> <span class="variable">judgeStrategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultJudgeStrategy</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;java&quot;</span>.equals(language)) &#123;</span><br><span class="line">            judgeStrategy = <span class="keyword">new</span> <span class="title class_">JavaLanguageJudgeStrategy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> judgeStrategy.doJudge(judgeContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>🆗，完成！</p><p><strong>知识点 - 设计模式：</strong></p><ol><li><strong>工厂模式</strong></li></ol><p>可配置化</p><ol start="2"><li><strong>代理模式</strong></li></ol><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1702991107151-ed3b292b-f7a2-49ba-a4c3-22451043246d.png#averageHue=%23fbf6f6&clientId=ued951e26-adc7-4&from=paste&height=497&id=u2708d228&originHeight=745&originWidth=862&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=39095&status=done&style=none&taskId=u323c0a72-2df7-4fa9-9b91-309de60444f&title=&width=575" alt="image.png"></p><ol start="3"><li><strong>策略模式</strong></li></ol><blockquote><p>我的理解：抽离方法，解耦思想</p></blockquote><hr><h2 id="代码沙箱的实现"><a href="#代码沙箱的实现" class="headerlink" title="代码沙箱的实现"></a>代码沙箱的实现</h2><h3 id="什么是代码沙箱："><a href="#什么是代码沙箱：" class="headerlink" title="什么是代码沙箱："></a><strong>什么是代码沙箱：</strong></h3><p>为了解耦<strong>并将代码沙箱单独作为一个服务/接口</strong>来调用，将判题逻辑分为<strong>判题模块</strong>与<strong>代码沙箱</strong>两个模块。<br>代码沙箱只负责接收代码的输入与输入用例，只返回编译运行的结果，不负责判题，判题逻辑单独交给判题模块负责。</p><blockquote><p>下面以Java语言为例，实现代码沙箱<br>TODO: 扩展其他语言的实现</p></blockquote><p>根据我们的架构来看，我们的代码沙箱最终需要提供一个接口来进行调用</p><h3 id="新建Spring-Boot-Web项目-JDK8-Boot-2-7"><a href="#新建Spring-Boot-Web项目-JDK8-Boot-2-7" class="headerlink" title="新建Spring Boot Web项目(JDK8/Boot 2.7)"></a>新建Spring Boot Web项目(JDK8/Boot 2.7)</h3><p>编写测试接口，测试能否访问</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wl2o2o.smartojcodesandbox.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> &lt;a href=&quot;https://github.com/wl2o2o&quot;&gt;程序员CS_GUIDER&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@From</span> &lt;a href=&quot;https://wl2o2o.github.io&quot;&gt;CS_GUIDER博客&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span> 2023/12/23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/health&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">healthCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Java-原生实现代码沙箱"><a href="#Java-原生实现代码沙箱" class="headerlink" title="Java 原生实现代码沙箱"></a>Java 原生实现代码沙箱</h2><p>原生就是不借助于任何的第三方库，用最干净的方式实现代码沙箱<br>逻辑：<br>接收代码 =javac=&gt; 编译代码 =java=&gt; 执行代码<br>因为一般来说<code>OJ</code>系统中一般都对于用户的输入有相关要求，所以为了更方便处理，我们把类名统一写成<code>Main</code>，减少类名不一致的风险。（关键是还不用从用户输入的代码中去提取类名）<br>示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> &lt;a href=&quot;https://github.com/wl2o2o&quot;&gt;程序员CS_GUIDER&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@From</span> &lt;a href=&quot;https://wl2o2o.github.io&quot;&gt;CS_GUIDER博客&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span> 2023/12/25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.parseInt(args[<span class="number">0</span>]);</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Integer.parseInt(args[<span class="number">1</span>]);</span><br><span class="line">        System.out.println(<span class="string">&quot;结果：&quot;</span> + (a + b));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编译执行代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac -encoding utf8 .\Main.java</span><br><span class="line">java -cp . Main <span class="number">1</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="核心流程实现"><a href="#核心流程实现" class="headerlink" title="核心流程实现"></a>核心流程实现</h3><p>核心实现思路：用程序来代替人工，用程序操作命令行，去编译代码<br>关键类：<code>Java</code>进程执行管理类</p><ol><li>把用户文件保存为文件</li><li>编译代码，得到 class 文件</li><li>执行代码，得到输出结果</li><li>从控制台，收集整理输出结果</li><li>文件清理</li><li>错误处理，提升程序健壮性</li></ol><h3 id="把用户文件保存为文件"><a href="#把用户文件保存为文件" class="headerlink" title="把用户文件保存为文件"></a>把用户文件保存为文件</h3><ol><li>引入<code>hutool</code>工具类：</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://hutool.cn/docs/index.html#/--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>新建UUID随机目录，每个用户的代码都存放于一个独立的文件夹中，便于维护</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">userDir</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">globalPathName</span> <span class="operator">=</span> userDir + File.separator + GLOBAL_CODE_DIR_NAME;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断目录是否存在</span></span><br><span class="line"><span class="keyword">if</span> (!FileUtil.exist(globalPathName)) &#123;</span><br><span class="line">    FileUtil.mkdir(globalPathName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把用户的代码隔离存放</span></span><br><span class="line"><span class="type">String</span> <span class="variable">userCodeParentPathName</span> <span class="operator">=</span> globalPathName + File.separator + UUID.randomUUID();</span><br><span class="line"><span class="type">String</span> <span class="variable">userCodePath</span> <span class="operator">=</span> userCodeParentPathName + File.separator + GLOBAL_JAVA_CLASS_NAME;</span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> FileUtil.writeString(code, userCodePath, StandardCharsets.UTF_8);</span><br></pre></td></tr></table></figure><blockquote><p><strong>口诀：一般情况下，程序会向输入流里写，会从输出流中读取 ————其实取决于进程</strong></p></blockquote><h3 id="执行程序"><a href="#执行程序" class="headerlink" title="执行程序"></a>执行程序</h3><ol><li>编译代码，得到 class 文件</li></ol><p>如何解决运行结果乱码：<br>java -Dfile.encoding=utf8 -cp %s Main %s</p><p>如果需要交互式（ACM），需要和用户交互的方式，让用户不断输入内容以获得输出<br>对于此类程序，我们需要使用OutPutStream向程序释放资源，流关闭终端发送参数，并及时获取结果，最后要</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行交互式进程并获取信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> runProcess</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> opName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecuteMessage <span class="title function_">runInterProcessAndGetMessage</span><span class="params">(Process runProcess, String opName, String args)</span> &#123;</span><br><span class="line">        <span class="type">ExecuteMessage</span> <span class="variable">executeMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExecuteMessage</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 向控制台输入程序</span></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> runProcess.getOutputStream();</span><br><span class="line">            <span class="type">OutputStreamWriter</span> <span class="variable">outputStreamWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(outputStream);</span><br><span class="line"></span><br><span class="line">            String[] split = args.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            outputStreamWriter.write(StrUtil.join(<span class="string">&quot;\n&quot;</span>, (Object) split) + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            <span class="comment">// 相当于回车</span></span><br><span class="line">            outputStreamWriter.flush();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">exitValue</span> <span class="operator">=</span> runProcess.waitFor();</span><br><span class="line">            executeMessage.setExitValue(exitValue);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 成块获取控制台输出</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> runProcess.getInputStream();</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream));</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">compileOutputStringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            String output;</span><br><span class="line">            <span class="comment">// 逐行读取输出</span></span><br><span class="line">            <span class="keyword">while</span> ((output = bufferedReader.readLine()) != <span class="literal">null</span> ) &#123;</span><br><span class="line">                compileOutputStringBuilder.append(output);</span><br><span class="line">            &#125;</span><br><span class="line">            executeMessage.setMessgae(compileOutputStringBuilder.toString());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 资源回收</span></span><br><span class="line">            outputStream.close();</span><br><span class="line">            outputStreamWriter.close();</span><br><span class="line">            inputStream.close();</span><br><span class="line">            runProcess.destroy();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> executeMessage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="异常情况演示"><a href="#异常情况演示" class="headerlink" title="异常情况演示"></a>异常情况演示</h3><ol><li><p>执行阻塞，占用资源</p></li><li><p>占用内存，不释放</p></li><li><p>读文件，文件信息泄露</p></li><li><p>写文件，越权植入木马</p></li><li><p>运行其他程序</p></li><li><p>执行高危命令</p></li></ol><h3 id="怎么解决？"><a href="#怎么解决？" class="headerlink" title="怎么解决？"></a>怎么解决？</h3><ol><li>超时控制</li><li>限制给用户分配的资源</li><li>限制代码，黑白名单</li><li>限制用户的操作权限，（文件、网络、执行）</li><li>运行环境隔离</li></ol><h4 id="a-超时控制"><a href="#a-超时控制" class="headerlink" title="a. 超时控制"></a>a. 超时控制</h4><p>怎么显示执行时间？创建一个新的线程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 超时控制</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(SLEEP_TIME);</span><br><span class="line">        System.out.println(<span class="string">&quot;超时了，中断！&quot;</span>);</span><br><span class="line">        runProcess.destroy();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure><h4 id="b-限制给用户分配的资源"><a href="#b-限制给用户分配的资源" class="headerlink" title="b. 限制给用户分配的资源"></a>b. 限制给用户分配的资源</h4><p>怎么限制呢？一个最简单的办法：通过<code>JVM</code>自带的一个堆内存限制参数：<code>-Xmx256m</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx256m -Dfile.encoding=utf8 -cp %s Main %s</span><br></pre></td></tr></table></figure><p><strong>但是我们要注意！！！-Xmx参数，Java的堆内存限制，并不完全等同于系统占用的资源，可能会超出</strong></p><p><strong>面试重点：</strong></p><p><strong>JVM层面的内存限制安全吗？</strong></p><p><strong>答：并不安全，若要进行严格的内存控制，我们需要在内存方面进行进一步的限制</strong></p><p><strong>如果是在Linux 系统的话，我们可以使用 cgrop 来实现对某一个进程的 CPU 或者内存资源的分配</strong></p><p><strong>使用方法：</strong></p><h4 id="c-限制代码，黑白名单"><a href="#c-限制代码，黑白名单" class="headerlink" title="c. 限制代码，黑白名单"></a>c. 限制代码，黑白名单</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; blacklist = Arrays.asList(<span class="string">&quot;File&quot;</span>, <span class="string">&quot;exec&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> WordTree WORD_TREE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        WORD_TREE = <span class="keyword">new</span> <span class="title class_">WordTree</span>();</span><br><span class="line">        WORD_TREE.addWords(blacklist);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ExecuteCodeResponse <span class="title function_">executeCode</span><span class="params">(ExecuteCodeRequest executeCodeRequest)</span> &#123;</span><br><span class="line">        List&lt;String&gt; inputList = executeCodeRequest.getInputList();</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> executeCodeRequest.getCode();</span><br><span class="line">        <span class="type">String</span> <span class="variable">language</span> <span class="operator">=</span> executeCodeRequest.getLanguage();</span><br><span class="line"></span><br><span class="line">        <span class="type">FoundWord</span> <span class="variable">foundWord</span> <span class="operator">=</span> WORD_TREE.matchWord(code);</span><br><span class="line">        <span class="keyword">if</span> (foundWord != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;包含禁止词汇：&quot;</span> + foundWord.getFoundWord());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ···</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="d-限制用户的操作权限"><a href="#d-限制用户的操作权限" class="headerlink" title="d. 限制用户的操作权限"></a>d. 限制用户的操作权限</h4><p>限制用户对文件、内存、CPU、网络等资源的访问。</p><p><strong>Java安全管理器（Security Manager），是Java提供的可以保护JVM、Java安全的机制，</strong>可以实现更加严格的控制。</p><p>编写默认的安全管理器，只需继承Java自带的<code>SecurityManager</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wl2o2o.smartojcodesandbox.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.Permission;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 默认禁用所有权限安全管理器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> &lt;a href=&quot;https://github.com/wl2o2o&quot;&gt;程序员CS_GUIDER&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@From</span> &lt;a href=&quot;https://wl2o2o.github.io&quot;&gt;CS_GUIDER博客&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span> 2023/12/28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSecurityManager</span> <span class="keyword">extends</span> <span class="title class_">SecurityManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查所有权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkPermission</span><span class="params">(Permission perm)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(perm.getActions() + <span class="string">&quot;权限被禁用！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="e-实现其他权限控制"><a href="#e-实现其他权限控制" class="headerlink" title="e. 实现其他权限控制"></a>e. 实现其他权限控制</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wl2o2o.smartojcodesandbox.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.Permission;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我的安全管理器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> &lt;a href=&quot;https://github.com/wl2o2o&quot;&gt;程序员CS_GUIDER&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@From</span> &lt;a href=&quot;https://wl2o2o.github.io&quot;&gt;CS_GUIDER博客&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span> 2023/12/28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySecurityManager</span> <span class="keyword">extends</span> <span class="title class_">SecurityManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查所有的权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkPermission</span><span class="params">(Permission perm)</span> &#123;</span><br><span class="line">        <span class="comment">// super.checkPermission(perm);</span></span><br><span class="line">        System.out.println(perm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查执行权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkExec</span><span class="params">(String cmd)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;exec 权限被禁用！&quot;</span> + cmd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkRead</span><span class="params">(String file)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(file);</span></span><br><span class="line">        <span class="comment">// if (file.contains(&quot;E:\\Exercise\\project\\smartoj-code-sandbox&quot;)) &#123;</span></span><br><span class="line">        <span class="comment">//     return;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// throw new SecurityException(&quot;read 权限被禁用！&quot; + file);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkWrite</span><span class="params">(String file)</span> &#123;</span><br><span class="line">        <span class="comment">// throw new SecurityException(&quot;write 权限被禁用！&quot; + file);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查删除操作权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkDelete</span><span class="params">(String file)</span> &#123;</span><br><span class="line">        <span class="comment">// throw new SecurityException(&quot;delete 权限被禁用！&quot; + file);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查程序可链接网络权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkConnect</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="comment">// throw new SecurityException(&quot;connect 权限被禁用！&quot; + host + &quot;:&quot; + port);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这样会直接全部限制开发者写的所有程序的</span></span><br><span class="line">System.setSecurityManager(<span class="keyword">new</span> <span class="title class_">MySecurityManager</span>());</span><br></pre></td></tr></table></figure><p><strong>实际上，我们只需要对涉及到相关执行命令的子程序进行安全管理，所以采用如下步骤进行配置（也就是配置一个安全管理类加载路径——</strong> <code>**;%s -Djava.security.manager=%s&quot;, SECURITY_MANAGER_PATH, SECURITY_MANAGER_CLASS_NAME**</code><strong>）</strong></p><p><strong>步骤：</strong></p><ol><li><strong>编写安全管理器</strong></li><li><strong>编译成class文件</strong></li><li><strong>去掉包名</strong></li><li><strong>放置在</strong><code>**resources**</code><strong>目录之下</strong></li><li><strong>指定</strong><code>**final**</code><strong>变量，存放管理器class名以及路径</strong></li><li><strong>完成类加载路径配置：</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">runCmd</span> <span class="operator">=</span> String.format(<span class="string">&quot;java -Xmx256m -Dfile.encoding=utf8 -cp %s;%s -Djava.security.manager=%s Main %s&quot;</span>, userCodeParentPath, SECURITY_MANAGER_PATH, SECURITY_MANAGER_CLASS_NAME, input);</span><br><span class="line"><span class="type">Process</span> <span class="variable">runProcess</span> <span class="operator">=</span> Runtime.getRuntime().exec(runCmd);</span><br></pre></td></tr></table></figure><p><strong>这样就可以实现直接在子程序中直接运用安全管理器。</strong></p><p>但是，安全管理器还是存在不足的地方，比如:</p><p><strong>优点：</strong></p><p>权限控制很灵活，实现简单</p><p><strong>缺点：</strong></p><ol><li><strong>如果要做比较严格的安全校验，需要判断哪些文件允许读写，粒度太细，难以精细化控制</strong></li><li><strong>安全管理器本身都是Java代码，难免存在漏洞（等于说还是程序上的控制，不属于系统层面上的）</strong></li><li><strong>而且不推荐 Java8 以上版本使用</strong></li></ol><h4 id="f-运行环境隔离"><a href="#f-运行环境隔离" class="headerlink" title="f. 运行环境隔离"></a>f. 运行环境隔离</h4><p>系统层面上，把用户程序封装到沙箱里，和宿主机（我们的电脑/服务器）隔离开</p><p>怎么实现：（两种方案）</p><ul><li>Docker 容器技术可以实现（底层是 cgroup 和 namespace 等方式实现）</li><li>cgroup</li></ul><blockquote><p>注意：其实完全使用 Docker 的话，也很难实现绝对安全控制，可以结合 Java 安全管理器进行使用</p></blockquote><hr><h1 id="前端项目初始化"><a href="#前端项目初始化" class="headerlink" title="前端项目初始化"></a>前端项目初始化</h1><blockquote><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><p>nodejs版本：v18.16.0 或者v16<br>npm版本：v9.5.1</p></blockquote><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>安装vue-cli脚手架初始化工具<br><code>npm install -g @vue/cli</code><br>先确认是否安装成功：<br><code>vue -V</code>（V是大写）<br>如果找不到命令，建议重装npm，重新配置环境变量</p><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>vue create + 项目名<br><code>vue create smartoj-frontend</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1700706064256-e0c207c4-844c-4024-ad1a-5b67712a5523.png#averageHue=%23121212&clientId=u37f1eba1-0f09-4&from=paste&height=636&id=ua9b37135&originHeight=954&originWidth=1599&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=111333&status=done&style=none&taskId=ud5a0510f-724c-4575-b647-01fb0e1c66c&title=&width=1066" alt="image.png"></p><h3 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h3><p>是否成功？引入组件进行测试 ：重装或者解决问题</p><h3 id="前端工程化配置"><a href="#前端工程化配置" class="headerlink" title="前端工程化配置"></a>前端工程化配置</h3><p>因为脚手架生成项目的时候，已经勾选代码格式校验，以及美化插件，所以需要在IDE手动开启，避免与IDE的格式化冲突。格式化命令：<code>Ctrl + Shift + L</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1700706080391-0b8b052f-6323-46f7-92d0-a8ca0b55baa7.png#averageHue=%23252a33&clientId=u37f1eba1-0f09-4&from=paste&height=278&id=u9a99b1b1&originHeight=417&originWidth=1472&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=51102&status=done&style=none&taskId=udef938c8-2b9c-4891-8eb3-fb8970b8d39&title=&width=981.3333333333334" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1700706150332-1983eafa-fadc-4ff7-bd45-fcfc4b7abc03.png#averageHue=%23242b36&clientId=u37f1eba1-0f09-4&from=paste&height=252&id=u06c62f0e&originHeight=378&originWidth=1472&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=53449&status=done&style=none&taskId=ud7151abb-5556-403e-a16b-4112bb23746&title=&width=981.3333333333334" alt="image.png"></p><h2 id="更改项目的布局"><a href="#更改项目的布局" class="headerlink" title="更改项目的布局"></a>更改项目的布局</h2><h3 id="引入组件"><a href="#引入组件" class="headerlink" title="引入组件"></a>引入组件</h3><p>安装arco.design组件库：<a target="_blank" rel="noopener" href="https://arco.design/vue/docs/start">https://arco.design/vue/docs/start</a><br>快速上手：<br>a. 安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># npm</span><br><span class="line">npm install --save-dev @arco-design/web-vue</span><br><span class="line"># yarn</span><br><span class="line">yarn add --dev @arco-design/web-vue</span><br></pre></td></tr></table></figure><p>b. 完整引入</p><h3 id="项目通用布局"><a href="#项目通用布局" class="headerlink" title="项目通用布局"></a>项目通用布局</h3><ol><li>新建一个BasicLayout布局，在app.vue中引入</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">  &lt;BasicLayout /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>并设置好布局样式</p><ol start="2"><li>通用菜单GloableHeader布局</li></ol><p>目标：可根据路由配置信息动态生成菜单内容。实现更通用更自动的菜单配置。<br>实现步骤：</p><ul><li>提取通用路由文件</li><li>菜单组件读取路由，动态渲染菜单项</li><li>绑定跳转事件（为什么？因为通过v-for可以实现router路由的同步，但是不能够实现路径的跳转）</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;a-menu</span><br><span class="line">      mode=<span class="string">&quot;horizontal&quot;</span></span><br><span class="line">      theme=<span class="string">&quot;dark&quot;</span></span><br><span class="line">      :<span class="keyword">default</span>-selected-keys=<span class="string">&quot;[&#x27;1&#x27;]&quot;</span></span><br><span class="line">      <span class="meta">@menu</span>-item-click=<span class="string">&quot;doMenuClick&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">        ...</span><br><span class="line">&lt;a-menu-item v-<span class="keyword">for</span>=<span class="string">&quot;item in routes&quot;</span> :key=<span class="string">&quot;item.path&quot;</span>&gt;</span><br><span class="line">        &#123;&#123; item.<span class="property">name</span> &#125;&#125;</span><br><span class="line">&lt;/a-menu-item&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&quot;@/router/routes&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 使用 vueRouter 实现路由跳转</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">doMenuClick</span> = (<span class="params">key: string</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  router.<span class="title function_">push</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">path</span>: key,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ul><li>此时刷新的话，不会记录路由的状态，所以这一步我们实现：同步路由的更新到菜单项高亮（点击–&gt;触发点击事件，跳转更新–&gt;同步菜单栏高亮）</li></ul><p>实现方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认主页</span></span><br><span class="line"><span class="keyword">const</span> selectedKeys = <span class="title function_">ref</span>([<span class="string">&quot;/&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由跳转后，更新选中的菜单项</span></span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, failure</span>) =&gt;</span> &#123;</span><br><span class="line">  selectedKeys.<span class="property">value</span> = [to.<span class="property">path</span>];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>逻辑：首先点击菜单栏 =&gt; 跳转更新路由 =&gt; 更新路由之后，同步高亮状态</p></blockquote><h2 id="全局状态管理"><a href="#全局状态管理" class="headerlink" title="全局状态管理"></a>全局状态管理</h2><blockquote><p>todo 看官方文档！！！！！！！！！！</p></blockquote><blockquote><p>用到了一个 vuex 库，另外还有 pinia 库可用于全局状态管理</p></blockquote><ul><li><a target="_blank" rel="noopener" href="https://vuex.vue.js.org/zh/guide">vuex</a>（vue-cli脚手架已经自动引入）todo 再了解一下<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15961676/6148140">https://blog.51cto.com/u_15961676/6148140</a></li></ul><blockquote><p>todo 再了解一下<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15961676/6148140">https://blog.51cto.com/u_15961676/6148140</a></p></blockquote><ul><li>什么是全局状态管理？</li></ul><p>所有页面共享全局的变量，而不是局限于某一个页面。</p><ul><li>那么什么数据适合作为全局状态：</li></ul><p>已登陆的用户信息（每一个页面几乎都要用）</p><ul><li>vuex的本质：</li></ul><p>提供了一套增删改查的全局变量 API，只不过多了一些功能，比如说时间旅行<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1700731201901-de437df5-8f62-4caa-aeee-edfab9758489.png#averageHue=%23fefdfb&clientId=u2fa75d88-42af-4&from=drop&id=u3703894d&originHeight=551&originWidth=701&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=27786&status=done&style=none&taskId=u61e26934-f7f6-4198-910d-6d0f28d8529&title=" alt="vuex.png"><br>可以直接参考购物车示例：<a target="_blank" rel="noopener" href="https://github.com/vuejs/vuex/blob/main/examples/classic/shopping-cart/store/modules/products.js">链接</a><br>state：存储的状态信息，比如用户信息<br>mutation（尽量同步）：定义了对变量进行增删改查的方法<br>actions（支持异步）：执行异步操作，并且触发 mutation 的更改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import shop from &#x27;../../api/shop&#x27;</span><br><span class="line"></span><br><span class="line">// initial state</span><br><span class="line">const state = () =&gt; (&#123;</span><br><span class="line">  loginUser: &#123;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// getters</span><br><span class="line">const getters = &#123;&#125;</span><br><span class="line"></span><br><span class="line">// actions</span><br><span class="line">const actions = &#123;</span><br><span class="line">  async getAllProducts (&#123; commit &#125;) &#123;</span><br><span class="line">    const products = await shop.getProducts()</span><br><span class="line">    commit(&#x27;setProducts&#x27;, products)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// mutations</span><br><span class="line">const mutations = &#123;</span><br><span class="line">  setProducts (state, products) &#123;</span><br><span class="line">    state.all = products</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  decrementProductInventory (state, &#123; id &#125;) &#123;</span><br><span class="line">    const product = state.all.find(product =&gt; product.id === id)</span><br><span class="line">    product.inventory--</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  namespaced: true,</span><br><span class="line">  state,</span><br><span class="line">  getters,</span><br><span class="line">  actions,</span><br><span class="line">  mutations</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取状态变量：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>();</span><br><span class="line">store.<span class="property">state</span>.<span class="property">user</span>?.<span class="property">loginUser</span></span><br></pre></td></tr></table></figure><p>修改状态变量：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="title function_">dispath</span>(<span class="string">&quot;user/getLoginUser&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">userNama</span>: <span class="string">&quot;CS_GUIDER&quot;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><p>就是用一套通用的机制，去定义哪个页面需要什么权限。<br>思路：</p><ul><li>在 router 路由文件中，对每个需要权限的路由进行配置；</li><li>在全局路由头文件中，绑定一个全局路由监听。每次访问页面时，获取用户需要访问的路由信息，进行判断访问权限。</li><li>有权限？ 跳转 ： 拦截或者跳转401鉴权或者登录页</li></ul><blockquote><p>小尾巴：</p><ol><li>单独定义一个文件，控制路由文件的显隐</li><li>完善模板。</li></ol></blockquote><h2 id="优化页面布局"><a href="#优化页面布局" class="headerlink" title="优化页面布局"></a>优化页面布局</h2><ol><li>底部footer布局优化</li><li>用户名换行问题</li><li>导航栏间距优化，content区域优化padding布局</li></ol><h3 id="根据权限隐藏菜单路由"><a href="#根据权限隐藏菜单路由" class="headerlink" title="根据权限隐藏菜单路由"></a>根据权限隐藏菜单路由</h3><p>思路：</p><ol><li>通过v-for循环来判断item中的meta中是否含有hideInMenu（效率低，而且不能与v-if连用）</li><li>定义一个visibleRouter函数来过滤路由</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改为 visibleRoutes</span></span><br><span class="line">&lt;a-menu-item v-<span class="keyword">for</span>=<span class="string">&quot;item in visibleRoutes&quot;</span> :key=<span class="string">&quot;item.path&quot;</span>&gt;</span><br><span class="line">  &#123;&#123; item.<span class="property">name</span> &#125;&#125;</span><br><span class="line">&lt;/a-menu-item&gt;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 路由过滤函数实现</span></span><br><span class="line"><span class="keyword">const</span> visibleRoutes = routes.<span class="title function_">filter</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (item.<span class="property">meta</span>?.<span class="property">hideInMenu</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// todo  加上用户权限的逻辑</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="加上判断用户权限的逻辑"><a href="#加上判断用户权限的逻辑" class="headerlink" title="加上判断用户权限的逻辑"></a>加上判断用户权限的逻辑</h3><p>记录一个小bug，没搞懂，可能与computed有关</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>();</span><br><span class="line"><span class="comment">// 这里定义了一个loginUser，以为是与store/user中的冲突了，换成了其他变量还是不行，猜测与computed和vuex有关</span></span><br><span class="line"><span class="comment">// const loginUser = store.state.user.loginUser;</span></span><br><span class="line"><span class="comment">// 路由过滤</span></span><br><span class="line"><span class="keyword">const</span> visibleRoutes = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> routes.<span class="title function_">filter</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">meta</span>?.<span class="property">hideInMenu</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 加上用户权限的逻辑</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">checkAcess</span>(store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">loginUser</span>, item?.<span class="property">meta</span>?.<span class="property">access</span> <span class="keyword">as</span> <span class="built_in">string</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="修改GlobleHeader-动态菜单组件，根据权限过滤菜单，"><a href="#修改GlobleHeader-动态菜单组件，根据权限过滤菜单，" class="headerlink" title="修改GlobleHeader 动态菜单组件，根据权限过滤菜单，"></a>修改GlobleHeader 动态菜单组件，根据权限过滤菜单，</h3><p>注意，这里使用计算属性，是为了当登录用户信息发生变更时，出发菜单栏的重新渲染，显示符合权限的菜单栏</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 vueRouter 实现路由跳转</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>();</span><br><span class="line"><span class="comment">// 路由过滤</span></span><br><span class="line"><span class="keyword">const</span> visibleRoutes = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> routes.<span class="title function_">filter</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">meta</span>?.<span class="property">hideInMenu</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 加上用户权限的逻辑</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">checkAcess</span>(store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">loginUser</span>, item?.<span class="property">meta</span>?.<span class="property">access</span> <span class="keyword">as</span> <span class="built_in">string</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="全局项目入口"><a href="#全局项目入口" class="headerlink" title="全局项目入口"></a>全局项目入口</h3><p>预留一个可以编辑全局初始化逻辑的代码，可以藏一个佛祖哈哈哈</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局初始化函数，有全局单次调用的代码，都可以写到这里</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">doInit</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello 欢迎来到我的项目&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">doInit</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="前后端联调"><a href="#前后端联调" class="headerlink" title="前后端联调"></a>前后端联调</h2><h3 id="1-安装请求工具类-Axios"><a href="#1-安装请求工具类-Axios" class="headerlink" title="1 安装请求工具类 Axios"></a>1 安装请求工具类 Axios</h3><p>官方文档：<br><a target="_blank" rel="noopener" href="https://axios-http.com/docs/intro">https://axios-http.com/docs/intro</a><br>代码：<br><code>npm install axios</code></p><h3 id="2-编写调用后端的代码"><a href="#2-编写调用后端的代码" class="headerlink" title="2 编写调用后端的代码"></a>2 编写调用后端的代码</h3><p>传统情况下，每个请求都要单独编写代码。至少得写一个请求路径<br>完全不用！！！我们可以完全借助 openai 的 oneApi 插件来一键生成我们的后端请求代码。<br>官方文档：<br><a target="_blank" rel="noopener" href="https://github.com/ferdikoomen/openapi-typescript-codegen">https://github.com/ferdikoomen/openapi-typescript-codegen</a><br>代码：<br><code>npm install openapi-typescript-codegen --save-dev</code><br>根据接口文档来生成前端请求代码：<br><code>openapi --input [http://localhost:8101/api/v2/api-docs](http://localhost:8121/api/v2/api-docs) --output ./generated --client axios</code></p><h3 id="用户登录功能"><a href="#用户登录功能" class="headerlink" title="用户登录功能"></a>用户登录功能</h3><h4 id="自动登录"><a href="#自动登录" class="headerlink" title="自动登录"></a>自动登录</h4><ol><li>编写获取远程用户登陆信息的代码</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getLoginUser</span>(<span class="params">&#123; commit, state &#125;, payload</span>) &#123;</span><br><span class="line">      <span class="comment">// 从远程获取登录用户</span></span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title class_">UserControllerService</span>.<span class="title function_">getLoginUserUsingGet</span>();</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&quot;updateUser&quot;</span>, res.<span class="property">data</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&quot;updateUser&quot;</span>, &#123;</span><br><span class="line">          ...state.<span class="property">loginUser</span>,</span><br><span class="line">          <span class="attr">userRole</span>: <span class="variable constant_">ACCESS_ENUM</span>.<span class="property">NOT_LOGIN</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&quot;updateUser&quot;</span>, payload);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><ol start="2"><li>去哪里触发 getLoginUser 函数的执行？肯定是在一个全局位置</li></ol><p>例如：<br>1） 路由选择<br>2） 全局页面入口<br>3） 全局通用布局</p><blockquote><p>这里我们选择第一种方案，可以直接在全局权限管理的路由拦截中判断用户是否已经登陆</p></blockquote><h3 id="全局权限管理优化"><a href="#全局权限管理优化" class="headerlink" title="全局权限管理优化"></a>全局权限管理优化</h3><ol><li>新建 access/index.ts 文件，把愿原来的路由拦截、权限校验的逻辑放在独立的文件中。</li></ol><p>优势：只要不引入到 main.ts 中，就不会开启，不会对项目有影响</p><ol start="2"><li>调用后端接口，编写权限管理和自动登录的逻辑</li></ol><p>如果没有登录过，那就自动登录：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loginUser = store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">loginUser</span>;</span><br><span class="line"><span class="comment">// 如果之前没登陆过，自动登录</span></span><br><span class="line"><span class="keyword">if</span> (!loginUser || !loginUser.<span class="property">userRole</span>) &#123;</span><br><span class="line">  <span class="comment">// 加 await 是为了等用户登录成功之后，再执行后续的代码</span></span><br><span class="line">  <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&quot;user/getLoginUser&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完整代码：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;@/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;@/store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">ACCESS_ENUM</span> <span class="keyword">from</span> <span class="string">&quot;@/access/accessEnum&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> checkAccess <span class="keyword">from</span> <span class="string">&quot;@/access/checkAccess&quot;</span>;</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;登陆用户信息&quot;</span>, store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">loginUser</span>);</span><br><span class="line">  <span class="keyword">const</span> loginUser = store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">loginUser</span>;</span><br><span class="line">  <span class="comment">// // 如果之前没登陆过，自动登录</span></span><br><span class="line">  <span class="keyword">if</span> (!loginUser || !loginUser.<span class="property">userRole</span>) &#123;</span><br><span class="line">    <span class="comment">// 加 await 是为了等用户登录成功之后，再执行后续的代码</span></span><br><span class="line">    <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&quot;user/getLoginUser&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> needAccess = (to.<span class="property">meta</span>?.<span class="property">access</span> <span class="keyword">as</span> <span class="built_in">string</span>) ?? <span class="variable constant_">ACCESS_ENUM</span>.<span class="property">NOT_LOGIN</span>;</span><br><span class="line">  <span class="comment">// 要跳转的页面必须要登陆</span></span><br><span class="line">  <span class="keyword">if</span> (needAccess !== <span class="variable constant_">ACCESS_ENUM</span>.<span class="property">NOT_LOGIN</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果没登陆，跳转到登录页面</span></span><br><span class="line">    <span class="keyword">if</span> (!loginUser || !loginUser.<span class="property">userRole</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">`/user/login?redirect=<span class="subst">$&#123;to.fullPath&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果已经登陆了，但是权限不足，那么跳转到无权限页面</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">checkAccess</span>(loginUser, needAccess)) &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&quot;/noAuth&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="支持多套布局与用户登录注册功能开发"><a href="#支持多套布局与用户登录注册功能开发" class="headerlink" title="支持多套布局与用户登录注册功能开发"></a>支持多套布局与用户登录注册功能开发</h3><ol><li>在 routes 路由文件中新建一套用户路由，使用 vue-router 自带的子路由机制，实现布局和嵌套路由，然后隐藏路由即可</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecordRaw</span>&gt; = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;用户&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">UserLayout</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;用户登录&quot;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">UserLoginView</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/user/register&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;用户注册&quot;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">UserRegisterView</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ol start="2"><li>新建 UserLayout、UserLoginView、UserRegisterView 页面，并且在 routes 中引入</li></ol><blockquote><p>编写登录界面、以及登录逻辑，为了方便，直接复用我们写好的获取登陆用户的代码，后期也可以通过优化来，直接获取登录用户，然后塞给我们的前端界面。</p></blockquote><p><strong>TODO：编写用户注册页面</strong></p><ol start="3"><li>因为我们在 app.vue 中全局引入了 GloableHeader，因此需要借助 v-if 来实现用户布局中不显示全局头，使用户界面更加美观</li></ol><p>代码：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template v-<span class="keyword">if</span>=<span class="string">&quot;route.path.startsWith(&#x27;/user&#x27;)&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">BasicLayout</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>TODO：这种方式可定不是最优雅的，最理想的情况下是直接读取 routes.ts，在这个文件中自定义多套布局，然后自动使用页面布局。</strong><br>Tips：嵌套路由子菜单</p><ol start="4"><li>登录页面开发</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;a-form</span><br><span class="line">  style=<span class="string">&quot;max-width: 480px; margin: 0 auto&quot;</span></span><br><span class="line">  label-align=<span class="string">&quot;left&quot;</span></span><br><span class="line">  auto-label-width</span><br><span class="line">  :model=<span class="string">&quot;form&quot;</span></span><br><span class="line">  <span class="meta">@submit</span>=<span class="string">&quot;handleSubmit&quot;</span></span><br><span class="line">&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a-form-item</span> <span class="attr">field</span>=<span class="string">&quot;userAccount&quot;</span> <span class="attr">label</span>=<span class="string">&quot;账号&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">a-input</span> <span class="attr">v-model</span>=<span class="string">&quot;form.userAccount&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入账号&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">a-form-item</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a-form-item</span> <span class="attr">field</span>=<span class="string">&quot;userPassword&quot;</span> <span class="attr">tooltip</span>=<span class="string">&quot;密码不少于 8 位&quot;</span> <span class="attr">label</span>=<span class="string">&quot;密码&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">a-input-password</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-model</span>=<span class="string">&quot;form.userPassword&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">a-form-item</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">a-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">html-type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 120px&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span>登录&lt;/a-button</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">a-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a-form</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol start="5"><li>尝试登录逻辑，发现还是获取不到用户登陆的信息</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1701102656580-99641311-3472-4c0d-8fda-0fed1cd09509.png#averageHue=%23292e36&clientId=u6fd5e765-3fbf-4&from=paste&height=307&id=ue2a4be81&originHeight=461&originWidth=880&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=95010&status=done&style=none&taskId=u4cb6dc86-96b7-4615-b55d-a6a8b2b299b&title=&width=586.6666666666666" alt="image.png"><br>TODO：为什么要打开携带 Cookie？不携带 cookie 就相当于前后端无关联。</p><hr><h3 id="本次页面开发计划"><a href="#本次页面开发计划" class="headerlink" title="本次页面开发计划"></a>本次页面开发计划</h3><p>完善：</p><blockquote><ol><li>用户注册页面</li><li>用户个人信息页</li></ol></blockquote><p>计划：</p><blockquote><ol><li>创建题目界面</li><li>题目管理界面（Admin）</li><li>题目列表页（主页展示、判题状态展示）</li><li>在线做题页</li><li>题目提交列表页</li><li>题目提交统计页</li></ol></blockquote><hr><h3 id="组件技术选型"><a href="#组件技术选型" class="headerlink" title="组件技术选型"></a>组件技术选型</h3><p><strong>首先技术选型，先接入组件查看是否有冲突</strong><br>组件：</p><blockquote><ol><li>md 编辑器（字节的 bytemd —— <a target="_blank" rel="noopener" href="https://github.com/bytedance/bytemd">https://github.com/bytedance/bytemd</a>)</li><li>代码编辑器（微软的 monaco Editor —— <a target="_blank" rel="noopener" href="https://github.com/microsoft/monaco-editor">https://github.com/microsoft/monaco-editor</a>）</li></ol><p>官方整合教程：<a target="_blank" rel="noopener" href="https://github.com/microsoft/monaco-editor/blob/main/docs/integrate-esm.md">https://github.com/microsoft/monaco-editor/blob/main/docs/integrate-esm.md</a></p></blockquote><h4 id="MD-编辑器："><a href="#MD-编辑器：" class="headerlink" title="MD 编辑器："></a>MD 编辑器：</h4><ol><li>引入 MD 编辑器：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i @bytemd/vue-next</span><br><span class="line">npm i @bytemd/plugin-highlight @bytemd/plugin-gfm</span><br></pre></td></tr></table></figure><ol start="2"><li>新建 MdEditor 组件，编写代码：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Editor :value=&quot;value&quot; :plugins=&quot;plugins&quot; @change=&quot;handleChange&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import gfm from &quot;@bytemd/plugin-gfm&quot;;</span><br><span class="line">import highlight from &quot;@bytemd/plugin-highlight&quot;;</span><br><span class="line">import &#123; Editor, Viewer &#125; from &quot;@bytemd/vue-next&quot;;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">const plugins = [</span><br><span class="line">  gfm(),</span><br><span class="line">  highlight(),</span><br><span class="line">  // Add more plugins here</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">const value = ref(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">const handleChange = (v: string) =&gt; &#123;</span><br><span class="line">  value.value = v;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>美化样式</li></ol><p>代码编辑器的右上角带有一个 byteMd GitHub图标广告，我们可以通过样式来去掉：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bytemd-toolbar-icon</span><span class="selector-class">.bytemd-tippy</span><span class="selector-class">.bytemd-tippy-right</span><span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">   <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编辑器引入成功，但是我们输入的值，目前还不能被监听到，也就是还不能取出来，所以，我们需要通过定义一个组件来实现把输入的值暴漏给父组件，便于父组件去使用，同时也是提高 md 编辑器的通用性、复用性</p><ol start="4"><li>怎么得到组件内的值？（组件自定义事件？）</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 定义组件属性类型</span><br><span class="line"> */</span><br><span class="line">interface Props &#123;</span><br><span class="line">  value: string;</span><br><span class="line">  handleChange: (v: string) =&gt; void;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 给组件指定初始值</span><br><span class="line"> */</span><br><span class="line">const props = withDefaults(defineProps&lt;Props&gt;(), &#123;</span><br><span class="line">  value: () =&gt; &quot;&quot;,</span><br><span class="line">  handleChange: (v: string) =&gt; &#123;</span><br><span class="line">    console.log(v);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="代码编辑器："><a href="#代码编辑器：" class="headerlink" title="代码编辑器："></a>代码编辑器：</h4><ol><li>安装编辑器</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install monaco-editor</span><br></pre></td></tr></table></figure><ol start="2"><li>vue-cli项目(webpack项目)整合monaco-editor</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install monaco-editor-webpack-plugin</span><br></pre></td></tr></table></figure><ol start="3"><li>在 vue.config.js 中配置webpack插件：</li></ol><p>全量加载或者按需加载:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&quot;@vue/cli-service&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MonacoWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;monaco-editor-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">chainWebpack</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    config.<span class="title function_">plugin</span>(<span class="string">&quot;monaco&quot;</span>).<span class="title function_">use</span>(<span class="keyword">new</span> <span class="title class_">MonacoWebpackPlugin</span>());</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MonacoWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;monaco-editor-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    config.<span class="title function_">plugin</span>(<span class="string">&#x27;monaco-editor&#x27;</span>).<span class="title function_">use</span>(<span class="title class_">MonacoWebpackPlugin</span>, [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Languages are loaded on demand at runtime</span></span><br><span class="line">        <span class="attr">languages</span>: [<span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;go&#x27;</span>, <span class="string">&#x27;css&#x27;</span>, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;java&#x27;</span>, <span class="string">&#x27;javascript&#x27;</span>, <span class="string">&#x27;less&#x27;</span>, <span class="string">&#x27;markdown&#x27;</span>, <span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;scss&#x27;</span>, <span class="string">&#x27;shell&#x27;</span>, <span class="string">&#x27;redis&#x27;</span>, <span class="string">&#x27;sql&#x27;</span>, <span class="string">&#x27;typescript&#x27;</span>, <span class="string">&#x27;xml&#x27;</span>], <span class="comment">// [&#x27;abap&#x27;, &#x27;apex&#x27;, &#x27;azcli&#x27;, &#x27;bat&#x27;, &#x27;cameligo&#x27;, &#x27;clojure&#x27;, &#x27;coffee&#x27;, &#x27;cpp&#x27;, &#x27;csharp&#x27;, &#x27;csp&#x27;, &#x27;css&#x27;, &#x27;dart&#x27;, &#x27;dockerfile&#x27;, &#x27;ecl&#x27;, &#x27;fsharp&#x27;, &#x27;go&#x27;, &#x27;graphql&#x27;, &#x27;handlebars&#x27;, &#x27;hcl&#x27;, &#x27;html&#x27;, &#x27;ini&#x27;, &#x27;java&#x27;, &#x27;javascript&#x27;, &#x27;json&#x27;, &#x27;julia&#x27;, &#x27;kotlin&#x27;, &#x27;less&#x27;, &#x27;lexon&#x27;, &#x27;lua&#x27;, &#x27;m3&#x27;, &#x27;markdown&#x27;, &#x27;mips&#x27;, &#x27;msdax&#x27;, &#x27;mysql&#x27;, &#x27;objective-c&#x27;, &#x27;pascal&#x27;, &#x27;pascaligo&#x27;, &#x27;perl&#x27;, &#x27;pgsql&#x27;, &#x27;php&#x27;, &#x27;postiats&#x27;, &#x27;powerquery&#x27;, &#x27;powershell&#x27;, &#x27;pug&#x27;, &#x27;python&#x27;, &#x27;r&#x27;, &#x27;razor&#x27;, &#x27;redis&#x27;, &#x27;redshift&#x27;, &#x27;restructuredtext&#x27;, &#x27;ruby&#x27;, &#x27;rust&#x27;, &#x27;sb&#x27;, &#x27;scala&#x27;, &#x27;scheme&#x27;, &#x27;scss&#x27;, &#x27;shell&#x27;, &#x27;solidity&#x27;, &#x27;sophia&#x27;, &#x27;sql&#x27;, &#x27;st&#x27;, &#x27;swift&#x27;, &#x27;systemverilog&#x27;, &#x27;tcl&#x27;, &#x27;twig&#x27;, &#x27;typescript&#x27;, &#x27;vb&#x27;, &#x27;xml&#x27;, &#x27;yaml&#x27;],</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">features</span>: [<span class="string">&#x27;format&#x27;</span>, <span class="string">&#x27;find&#x27;</span>, <span class="string">&#x27;contextmenu&#x27;</span>, <span class="string">&#x27;gotoError&#x27;</span>, <span class="string">&#x27;gotoLine&#x27;</span>, <span class="string">&#x27;gotoSymbol&#x27;</span>, <span class="string">&#x27;hover&#x27;</span> , <span class="string">&#x27;documentSymbols&#x27;</span>] <span class="comment">//[&#x27;accessibilityHelp&#x27;, &#x27;anchorSelect&#x27;, &#x27;bracketMatching&#x27;, &#x27;caretOperations&#x27;, &#x27;clipboard&#x27;, &#x27;codeAction&#x27;, &#x27;codelens&#x27;, &#x27;colorPicker&#x27;, &#x27;comment&#x27;, &#x27;contextmenu&#x27;, &#x27;coreCommands&#x27;, &#x27;cursorUndo&#x27;, &#x27;dnd&#x27;, &#x27;documentSymbols&#x27;, &#x27;find&#x27;, &#x27;folding&#x27;, &#x27;fontZoom&#x27;, &#x27;format&#x27;, &#x27;gotoError&#x27;, &#x27;gotoLine&#x27;, &#x27;gotoSymbol&#x27;, &#x27;hover&#x27;, &#x27;iPadShowKeyboard&#x27;, &#x27;inPlaceReplace&#x27;, &#x27;indentation&#x27;, &#x27;inlineHints&#x27;, &#x27;inspectTokens&#x27;, &#x27;linesOperations&#x27;, &#x27;linkedEditing&#x27;, &#x27;links&#x27;, &#x27;multicursor&#x27;, &#x27;parameterHints&#x27;, &#x27;quickCommand&#x27;, &#x27;quickHelp&#x27;, &#x27;quickOutline&#x27;, &#x27;referenceSearch&#x27;, &#x27;rename&#x27;, &#x27;smartSelect&#x27;, &#x27;snippets&#x27;, &#x27;suggest&#x27;, &#x27;toggleHighContrast&#x27;, &#x27;toggleTabFocusMode&#x27;, &#x27;transpose&#x27;, &#x27;unusualLineTerminators&#x27;, &#x27;viewportSemanticTokens&#x27;, &#x27;wordHighlighter&#x27;, &#x27;wordOperations&#x27;, &#x27;wordPartOperations&#x27;]</span></span><br><span class="line">      &#125;</span><br><span class="line">    ])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>整合教程</li></ol><p>如何使用 Monaco Editor ？查看示例教程：<br><a target="_blank" rel="noopener" href="https://microsoft.github.io/monaco-editor/playground.html?source=v0.40.0#example-creating-the-editor-hello-world">https://microsoft.github.io/monaco-editor/playground.html?source=v0.40.0#example-creating-the-editor-hello-world</a><br>整合教程参考：<br><a target="_blank" rel="noopener" href="http://chart.zhenglinglu.cn/pages/2244bd/#%E5%9C%A8-vue-%E4%B8%AD%E4%BD%BF%E7%94%A8">http://chart.zhenglinglu.cn/pages/2244bd/#%E5%9C%A8-vue-%E4%B8%AD%E4%BD%BF%E7%94%A8</a><br>注意，monaco editor在读写值的时候，要使用toRaw(编辑器实例)的语法来执行操<br>作，否则会卡死。</p><p>示例整合代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;code-editor&quot; ref=&quot;codeEditorRef&quot; style=&quot;min-height: 400px&quot; /&gt;</span><br><span class="line">  &#123;&#123; value &#125;&#125;</span><br><span class="line">  &lt;a-button @click=&quot;fillValue&quot;&gt;填充值&lt;/a-button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import * as monaco from &quot;monaco-editor&quot;;</span><br><span class="line">import &#123; onMounted, ref, toRaw &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">const codeEditorRef = ref();</span><br><span class="line">const codeEditor = ref();</span><br><span class="line">const value = ref(&quot;hello world&quot;);</span><br><span class="line"></span><br><span class="line">const fillValue = () =&gt; &#123;</span><br><span class="line">  if (!codeEditor.value) &#123;</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  // 改变值</span><br><span class="line">  toRaw(codeEditor.value).setValue(&quot;新的值&quot;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  if (!codeEditorRef.value) &#123;</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  // Hover on each property to see its docs!</span><br><span class="line">  codeEditor.value = monaco.editor.create(codeEditorRef.value, &#123;</span><br><span class="line">    value: value.value,</span><br><span class="line">    language: &quot;java&quot;,</span><br><span class="line">    automaticLayout: true,</span><br><span class="line">    colorDecorators: true,</span><br><span class="line">    minimap: &#123;</span><br><span class="line">      enabled: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    readOnly: false,</span><br><span class="line">    theme: &quot;vs-dark&quot;,</span><br><span class="line">    // lineNumbers: &quot;off&quot;,</span><br><span class="line">    // roundedSelection: false,</span><br><span class="line">    // scrollBeyondLastLine: false,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // 编辑 监听内容变化</span><br><span class="line">  codeEditor.value.onDidChangeModelContent(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;目前内容为：&quot;, toRaw(codeEditor.value).getValue());</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="5"><li>暴漏内容给父组件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 定义组件属性类型</span><br><span class="line"> */</span><br><span class="line">interface Props &#123;</span><br><span class="line">  value: string;</span><br><span class="line">  handleChange: (v: string) =&gt; void;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 给组件指定初始值</span><br><span class="line"> */</span><br><span class="line">const props = withDefaults(defineProps&lt;Props&gt;(), &#123;</span><br><span class="line">  value: () =&gt; &quot;&quot;,</span><br><span class="line">  handleChange: (v: string) =&gt; &#123;</span><br><span class="line">    console.log(v);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>todo: 扩展：用diff editor对比用户代码和标准答案的区别</p></blockquote><h2 id="页面开发"><a href="#页面开发" class="headerlink" title="页面开发"></a>页面开发</h2><h3 id="创建题目界面"><a href="#创建题目界面" class="headerlink" title="创建题目界面"></a>创建题目界面</h3><blockquote><p><strong>小技巧：</strong><br><strong>自定义代码模板：</strong><br><strong>在JetBrains系列编辑器中打开设置，搜索live Templates,先创建一个自定义模板组，在组下创建代码模板。</strong><br><strong>效果：输入缩写，即可生成模板代码。</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;$ID$&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">$END$</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">#$ID$ &#123;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1702611044474-d806caa1-7948-4d53-8ea4-e1743838dfab.png#averageHue=%233c424b&clientId=ub5e9204a-72e5-4&from=paste&height=705&id=uca0b7a28&originHeight=1058&originWidth=1636&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=264912&status=done&style=none&taskId=u26837985-ac3f-47c3-bc6a-d5d45c22b58&title=&width=1090.6666666666667" alt="image.png"></p><ol><li>利用 oneapi 根据后端接口文档，生成前端请求代码</li></ol><p>需要注意的是，每次生成请求代码，需要配置一下携带 cookie</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openapi --input http://localhost:8121/api/v2/api-docs --output ./generated --client axios</span><br></pre></td></tr></table></figure><ol start="2"><li>使用表单组件</li></ol><p>示例代码：<a target="_blank" rel="noopener" href="https://arco.design/vue/component/form">https://arco.design/vue/component/form</a><br>此处我们用到了</p><ul><li>嵌套套表单：<a target="_blank" rel="noopener" href="https://arco.design/vue/component/form#nest">https://arco.design/vue/component/form#nest</a></li><li>动态增减表单：<a target="_blank" rel="noopener" href="https://arco.design/vue/component/form#dynamic">https://arco.design/vue/component/form#dynamic</a></li></ul><p>注意，我们自定义的代码编辑器组件不会被组件库识别，需要手动指定vlue和handleChange函数。</p><h3 id="题目管理界面"><a href="#题目管理界面" class="headerlink" title="题目管理界面"></a>题目管理界面</h3><ol><li>使用表格组件，找到自定义操作的示例：<a target="_blank" rel="noopener" href="https://arco.design/vue/component/table#custom">https://arco.design/vue/component/table#custom</a></li><li>查询数据</li><li>定以表格列</li><li>加载数据</li><li>调整格式</li></ol><p>JSON 数据的处理方法：<br>1） 使用组件库的自带语法，自动格式化（方便）<br>2） 像定义 optional 操作按钮一样，自定义渲染（灵活）</p><ol start="6"><li>添加、删除、更新操作</li></ol><p>删除之后要执行 loadData 刷新数据</p><blockquote><p>如果想学 React Ant Design 框架的管理页面的开发，看用户中心的项目</p></blockquote><h3 id="更新页面的开发"><a href="#更新页面的开发" class="headerlink" title="更新页面的开发"></a>更新页面的开发</h3><blockquote><p>因为更新与创建题目都是相同的操作，所以直接复用即可。<br>复用的关键：怎么区分两个页面？<br>1） 定义不用的路由<br>2） 对于不用题目加上题目 id 的请求参数<br>3） 更新页需要多一步显示之前信息的操作，最后还需要更改后端的请求接口</p></blockquote><blockquote><p>计划完成</p></blockquote><hr><p>小计划：</p><blockquote><ol><li>解决分页题目信息不跳转 Bug ，以及管理页面刷新之后需要重新登录的 Bug</li><li>题目列表搜索页面开发</li><li>题目浏览页面（做题）开发（左侧题目信息，右侧代码编辑器，对标 Leetcode）</li></ol><p>后端：</p><ol><li>判题机和代码沙箱</li></ol></blockquote><h1 id="简历完善点"><a href="#简历完善点" class="headerlink" title="简历完善点"></a>简历完善点</h1><p>实际运行上述程序时，我们会发现，内存占用到达一定空间后，程序就自动报错：<code>java.lang.OutOfMemoryError:Java heap space</code>，而不是无限增加内存占用，直到系统死机。<strong>这是JVM的一个保护机制。</strong></p><ol><li>内存使用情况，可以使用<strong>JVisualVM或JConsole</strong>工具，连接到JVM虚拟机上来可视化查看运行状态。（使用过相关工具）</li><li>数据结构相关的知识点：HuTool的<code>WordTree</code>字典树工具，他可以使用更少的空间存储更多的词汇， 实现更加便捷的查找。</li><li>Java安全管理器和 Docker 相结合（需要再进行详细了解一下）</li></ol><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><p>详细了解一下糊涂工具类</p><p>Java安全管理器</p></article><div class="mt-12 pt-6 border-t border-gray-200"><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/Spring-Boot/">Spring Boot</a> </span><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/MySQL/">MySQL</a></span></div><div class="flex justify-between mt-12 pt-6 border-t border-gray-200"><div><a href="/posts/f3dfbe7f.html" class="text-sm text-gray-400 hover:text-gray-500 flex justify-center"><iconify-icon width="20" icon="ri:arrow-left-s-line" data-inline="false"></iconify-icon>netblog</a></div><div><a href="/posts/f234e628.html" class="text-sm text-gray-400 hover:text-gray-500 flex justify-center">达梦数据库<iconify-icon width="20" icon="ri:arrow-right-s-line" data-inline="false"></iconify-icon></a></div></div><div class="article-comments mt-12"><div class="giscus-container mt-8 pt-8 border-t border-gray-200 dark:border-gray-700"><script src="https://giscus.app/client.js" data-repo="WL2O2O/CS_GUIDER_Giscus" data-repo-id="R_kgDOJYdTQw" data-category="Announcements" data-category-id="DIC_kwDOJYdTQ84CWKC6" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async></script></div><script>function updateGiscusTheme(){const e=document.querySelector("iframe.giscus-frame");if(e){const s=document.documentElement.classList.contains("dark");e.contentWindow.postMessage({giscus:{setConfig:{theme:s?"dark":"light"}}},"https://giscus.app")}}window.addEventListener("message",e=>{"https://giscus.app"===e.origin&&e.data.giscus&&e.data.giscus.resizeHeight&&updateGiscusTheme()});const observer=new MutationObserver(()=>{updateGiscusTheme()});observer.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})</script></div></section><script src="/lib/clipboard.min.js"></script><script async src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
  });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });</script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>$(document).ready(()=>{mermaid.initialize({theme:"default",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})})</script><script src="/lib/fancybox/fancybox.umd.min.js"></script><script>$(document).ready(()=>{$(".post-content").each((function(a){$(this).find("img").each((function(){if(!$(this).parent().hasClass("fancybox")&&!$(this).parent().is("a")){var a=this.alt;a&&$(this).after('<span class="fancybox-alt">'+a+"</span>"),$(this).wrap('<a class="fancybox-img" href="'+this.src+'" data-fancybox="gallery" data-caption="'+a+'"></a>')}})),$(this).find(".fancybox").each((function(){$(this).attr("rel","article"+a)}))})),Fancybox.bind('[data-fancybox="gallery"]',{})})</script><script src="/lib/tocbot/tocbot.min.js"></script><script>$(document).ready(()=>{tocbot.init({tocSelector:".post-toc",contentSelector:".post-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0})})</script></main><footer class="flex flex-col h-40 items-center justify-center text-gray-400 text-sm"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="flex items-center gap-2"><span>Visitors</span> <span id="busuanzi_value_site_uv"></span> <span>Page Views</span> <span id="busuanzi_value_site_pv"></span></div><div class="flex items-center gap-2"><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color:inherit">CC BY-NC-SA 4.0</a> <span>© 2025</span><iconify-icon width="18" icon="emojione-monotone:desktop-computer"></iconify-icon><a href="https://github.com/wl2o2o" target="_blank" rel="noopener noreferrer">CS_GUIDER</a></div><div class="flex items-center gap-2"><span>Powered by</span> <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a> <span>&</span> <a href="https://github.com/wl2o2o" target="_blank" rel="noopener noreferrer">CS_GUIDER</a></div></footer><div class="back-to-top box-border fixed right-6 z-1024 -bottom-20 rounded py-1 px-1 bg-slate-900 opacity-60 text-white cursor-pointer text-center dark:bg-slate-600"><span class="flex justify-center items-center text-sm"><iconify-icon width="18" icon="ion:arrow-up-c" id="go-top"></iconify-icon><span id="scrollpercent"><span>0</span> %</span></span></div><script src="/js/main.js"></script><script src="/js/search.js"></script><script>$(document).ready((function(){const t=document.getElementById("maple");Array.from({length:"10"}).map(()=>{const e=document.createElement("div"),a=.5*Math.random()+.5,l=2*Math.random()-1,n=Math.random()*t.clientWidth,i=-Math.random()*t.clientHeight;return e.className="maple",e.style.width=24*a+"px",e.style.height=24*a+"px",e.style.left=n+"px",e.style.top=i+"px",e.style.setProperty("--maple-fall-offset",l),e.style.setProperty("--maple-fall-height",Math.abs(i)+t.clientHeight+"px"),e.style.animation=`fall ${10/"0.3"}s linear infinite`,e.style.animationDelay=-10/"0.3"+"s",t.appendChild(e),e})}))</script><div class="fixed top-0 bottom-0 left-0 right-0 pointer-events-none print:hidden" id="maple"></div></body></html>
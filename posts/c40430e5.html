<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><script async src="https://www.googletagmanager.com/gtag/js?id=G-MP1THLPZFC"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MP1THLPZFC")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?956b14594152e1b71ce14695a71235d5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="CS_GUIDER"><meta name="subtitle" content="If not now, when? If not me, who?"><meta name="description" content="欢迎来到我的CS_GUIDER博客！这里提供了全面、实用和最新的Java编程信息。你可以找到Java算法、项目、博客、数据库、Linux系统的教程和笔记。我致力于为您提供Java编程的实用指南和资源，包括Java框架、JVM和Git等。无论您是初学者还是经验丰富的开发人员，都可以从中获益。谢谢您的光临！"><title>API开放平台 | CS_GUIDER&#39;S Blog</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/nprogress/nprogress.css"><script src="/lib/jquery.min.js"></script><script src="/lib/iconify-icon.min.js"></script><script src="https://cdn.tailwindcss.com?plugins=typography"></script><script>tailwind.config={darkMode:"class"}</script><script src="/lib/nprogress/nprogress.js"></script><script>$(document).ready(()=>{NProgress.configure({showSpinner:!1}),NProgress.start(),$("#nprogress .bar").css({background:"#de7441"}),$("#nprogress .peg").css({"box-shadow":"0 0 2px #de7441, 0 0 4px #de7441"}),$("#nprogress .spinner-icon").css({"border-top-color":"#de7441","border-left-color":"#de7441"}),setTimeout((function(){NProgress.done(),$(".fade").removeClass("out")}),800)})</script><script>!function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("hexo-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0);document.documentElement.classList.contains("dark")}(),$(document).ready((function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=document.documentElement.classList.contains("dark");function o(){const e=document.documentElement.classList.contains("dark"),t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e?"dark":"light"}}},"https://giscus.app")}function n(){let t=document.documentElement.classList.contains("dark");localStorage.getItem("hexo-color-scheme");t=!t,document.documentElement.classList.toggle("dark",t),$("#theme-icon").attr("icon",t?"ri:moon-line":"ri:sun-line"),e===t?localStorage.setItem("hexo-color-scheme","auto"):localStorage.setItem("hexo-color-scheme",t?"dark":"light"),o()}$("#theme-icon").attr("icon",t?"ri:moon-line":"ri:sun-line"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{"auto"===(localStorage.getItem("hexo-color-scheme")||"auto")&&(document.documentElement.classList.toggle("dark",e.matches),$("#theme-icon").attr("icon",e.matches?"ri:moon-line":"ri:sun-line"),o())}),$("#toggle-dark").click(e=>{if(!(document.startViewTransition&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches))return void n();const t=e.clientX,o=e.clientY,c=Math.hypot(Math.max(t,innerWidth-t),Math.max(o,innerHeight-o));document.startViewTransition(async()=>{n()}).ready.then(()=>{const e=document.documentElement.classList.contains("dark"),n=[`circle(0px at ${t}px ${o}px)`,`circle(${c}px at ${t}px ${o}px)`];document.documentElement.animate({clipPath:e?[...n].reverse():n},{duration:400,easing:"ease-out",pseudoElement:e?"::view-transition-old(root)":"::view-transition-new(root)"})})})}))</script><meta name="generator" content="Hexo 5.4.2"></head><body class="font-sans bg-white dark:bg-zinc-900 text-gray-700 dark:text-gray-200 relative"><header class="fixed w-full px-5 py-1 z-10 backdrop-blur-xl backdrop-saturate-150 border-b border-black/5"><div class="max-auto"><nav class="flex items-center text-base"><a href="/" class="group"><h2 class="font-medium tracking-tighterp text-l p-2"><img class="w-5 mr-2 inline-block transition-transform group-hover:rotate-[30deg]" id="logo" src="/img/logo.svg" alt="CS_GUIDER'S Blog"> CS_GUIDER&#39;S Blog</h2></a><div id="header-title" class="opacity-0 md:ml-2 md:mt-[0.1rem] text-xs font-medium whitespace-nowrap overflow-hidden overflow-ellipsis">API开放平台</div><div class="flex-1"></div><div class="flex items-center gap-3"><a class="hidden sm:flex" href="/">Home</a> <a class="hidden sm:flex" href="/archives">Archives</a> <a class="hidden sm:flex" href="/category">Categories</a> <a class="hidden sm:flex" href="/tag">Tags</a> <a class="w-5 h-5 hidden sm:flex" title="Github" target="_blank" rel="noopener" href="https://github.com/wl2o2o"><iconify-icon width="20" icon="ri:github-line"></iconify-icon></a><a class="w-5 h-5 hidden sm:flex" title="Github" href="rss2.xml"><iconify-icon width="20" icon="ri:rss-line"></iconify-icon></a><a class="w-5 h-5" title="toggle theme" id="toggle-dark"><iconify-icon width="20" icon="" id="theme-icon"></iconify-icon></a></div><div class="flex items-center justify-center gap-3 ml-3 sm:hidden"><span class="w-5 h-5" aria-hidden="true" role="img" id="open-menu"><iconify-icon width="20" icon="carbon:menu"></iconify-icon></span><span class="w-5 h-5 hidden" aria-hidden="true" role="img" id="close-menu"><iconify-icon width="20" icon="carbon:close"></iconify-icon></span></div></nav></div></header><div id="menu-panel" class="h-0 overflow-hidden sm:hidden fixed left-0 right-0 top-12 bottom-0 z-10"><div id="menu-content" class="relative z-20 bg-white/80 px-6 sm:px-8 py-2 backdrop-blur-xl -translate-y-full transition-transform duration-300"><ul class="nav flex flex-col sm:flex-row text-sm font-medium"><li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main"><a href="/" class="flex h-12 sm:h-auto items-center">Home</a></li><li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main"><a href="/archives" class="flex h-12 sm:h-auto items-center">Archives</a></li><li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main"><a href="/category" class="flex h-12 sm:h-auto items-center">Categories</a></li><li class="nav-portfolio sm:mx-2 border-b sm:border-0 border-black/5 last:border-0 hover:text-main"><a href="/tag" class="flex h-12 sm:h-auto items-center">Tags</a></li></ul></div><div class="mask bg-black/20 absolute inset-0"></div></div><main class="pt-14"><link rel="stylesheet" href="/lib/fancybox/fancybox.min.css"><link rel="stylesheet" href="/lib/tocbot/tocbot.min.css"><nav class="post-toc toc text-sm w-48 relative top-32 right-0 opacity-70 hidden lg:block" style="position:fixed!important"></nav><section class="px-6 max-w-prose mx-auto md:px-0"><header class="overflow-hidden pt-6 pb-6 md:pt-12"><div class="pt-4 md:pt-6"><h1 id="article-title" class="text-[2rem] font-bold leading-snug mb-4 md:mb-6 md:text-[2.6rem]">API开放平台</h1><div><section class="flex items-center gap-3 text-sm"><span class="flex items-center gap-1"><iconify-icon width="18" icon="carbon-calendar"></iconify-icon><time>2025-09-17</time> </span><span class="text-gray-400">·</span> <span class="flex items-center gap-1"><iconify-icon width="18" icon="ic:round-access-alarm"></iconify-icon><span>68 min</span> </span><span class="text-gray-400">·</span> <span class="flex items-center gap-1"><iconify-icon width="18" icon="icon-park-outline:font-search"></iconify-icon><span>16.4k words</span> </span><span class="text-gray-400">·</span> <span class="flex items-center gap-1"><iconify-icon width="16" icon="icon-park-outline:box" class="mr-2"></iconify-icon><a class="article-category-link" href="/categories/Project/">Project</a></span></section></div></div></header><article class="post-content prose m-auto slide-enter-content dark:prose-invert"><h1 id="API开放平台"><a href="#API开放平台" class="headerlink" title="API开放平台"></a>API开放平台</h1><blockquote><p>写在最前面：</p><p>​ 学到的知识与收到的建议：</p><pre><code>1. 把自己所有的数据库建表语句总结到一起，后续有用；
1. 记录Bug文档
1. 多记录一些需求的解决方案、提高自己的架构能力
</code></pre></blockquote><h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><blockquote><p>前端开发的时候有有时会需要后端的接口，如果此时有一个API接口可以使用，那么就无需后端借口了</p></blockquote><p>一个提供API接口调用的平台，用户可以注册与登录，开通接口的调用权限，用户可以使用接口，每次调用会进行次数统计。管理院可以发布接口、下线接口、接入接口，以及可视化接口的调用情况。</p><p>一个API接口平台：</p><ol><li>防止攻击</li><li>使用限制</li><li>统计调用次数</li><li>计费</li><li>流量保护</li><li>API接入</li></ol><h2 id="预计完成时间"><a href="#预计完成时间" class="headerlink" title="预计完成时间"></a>预计完成时间</h2><p>5-6周</p><h2 id="业务流程"><a href="#业务流程" class="headerlink" title="业务流程"></a>业务流程</h2><p>前台、SDK、API网关、模拟接口、后台 共五个子模块</p><p><strong>难点</strong>：思想</p><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><ul><li>前端<ul><li>Ant Design Pro</li><li>React</li><li>Ant Design Pro Components</li><li>Umi</li><li>Umi Request（Axios的封装）–请求库（前后端联调）</li></ul></li><li>后端<ul><li>Spring Boot</li><li>Spring Boot Stater（SDK开发）–可以发布到maven仓库—-<strong>简历亮点</strong></li><li>？？？？？？（网关、限流、日志实现）</li></ul></li></ul><h2 id="项目计划"><a href="#项目计划" class="headerlink" title="项目计划"></a>项目计划</h2><h3 id="Day01–项目初始化"><a href="#Day01–项目初始化" class="headerlink" title="Day01–项目初始化"></a>Day01–项目初始化</h3><p>项目介绍、设计、技术选型</p><p>基础项目的搭建</p><p>接口管理</p><p>用户查看接口的权限</p><h3 id="Day02–接口调用"><a href="#Day02–接口调用" class="headerlink" title="Day02–接口调用"></a>Day02–接口调用</h3><ol><li>继续开发接口管理前端页面 15min</li><li>开发模拟API接口 5min</li><li>开发调用接口的代码 10-20min</li><li>保证调用的安全性（API签名认证） 15min</li><li>客户端SDK的开发 15min</li><li>管理员接口的发布与调用 15min</li><li>接口文档的展示、接口在线调用 15min</li></ol><h3 id="Day03–接口计费与保护"><a href="#Day03–接口计费与保护" class="headerlink" title="Day03–接口计费与保护"></a>Day03–接口计费与保护</h3><p>统计用户调用次数</p><p>限流</p><p>计费</p><p>日志</p><p>开通</p><h3 id="Day04–管理员统计分析"><a href="#Day04–管理员统计分析" class="headerlink" title="Day04–管理员统计分析"></a>Day04–管理员统计分析</h3><p>提供可视化平台，展示所有接口的调用情况，便于管理价格</p><p>接口预警</p><h2 id="Day01-需求分析"><a href="#Day01-需求分析" class="headerlink" title="Day01 需求分析"></a>Day01 需求分析</h2><ol><li><p>管理员可以对接口信息进行增删改查</p></li><li><p>用户可以访问前台，查看接口信息</p></li></ol><h3 id="今日计划"><a href="#今日计划" class="headerlink" title="今日计划"></a>今日计划</h3><ol><li>项目脚手架搭建（初始化项目）10分钟前端、5-10分钟后端</li><li>管理员可以对接口信息进行增删改查</li><li>用户可以访问前台，查看接口的信息</li></ol><h3 id="项目初始化（前后端）"><a href="#项目初始化（前后端）" class="headerlink" title="项目初始化（前后端）"></a>项目初始化（前后端）</h3><ul><li><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3></li></ul><ol><li><p>使用Ant Design Pro提供的<code>pro-cli</code>来快速的初始化脚手架。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看node和npm版本</span></span><br><span class="line">建议16和8</span><br><span class="line"><span class="comment"># 使用 npm</span></span><br><span class="line">npm i @ant-design/pro-cli -g</span><br><span class="line">pro create myapi-frontend</span><br><span class="line"><span class="comment"># 下载项目所需要的依赖</span></span><br><span class="line">yarn</span><br><span class="line">此时可能会遇到node版本要求的问题，因为版本更新迭代的原因，我当时要求的是使用16.14.0的node版本，</span><br><span class="line">如果感觉切换node版本麻烦的话，这里推荐使用nvm（node的版本管理工具），使用方法自行百度</span><br></pre></td></tr></table></figure></li><li><p>项目瘦身</p><p>遇到了一个大坑，星球的球友们也都遇到了，下面是球友的解决方法，亲测有效。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭ESLint中与Prettier重复的规则，确保代码格式化的一致性</span></span><br><span class="line">yarn add eslint-config-prettier --dev</span><br><span class="line"><span class="comment"># 用于检查和修复JavaScript代码中的常见问题</span></span><br><span class="line">yarn add eslint-plugin-unicorn --dev</span><br></pre></td></tr></table></figure><h3 id="项目去除国际化存在问题的解决方法"><a href="#项目去除国际化存在问题的解决方法" class="headerlink" title="项目去除国际化存在问题的解决方法"></a>项目去除国际化存在问题的解决方法</h3></li></ol><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307010940465.png" alt="image-20230630231124235"></p><p>​ jest脚本命令中有<code>jest</code>不知道是否需要删掉，鱼皮的文件中没有出现，可能是跟某些版本有关，奇奇妙妙，记录一下</p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307010940466.png" alt="image-20230630233743871"></p><ul><li><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3></li></ul><ol start="3"><li>后端项目初始化</li></ol><p>​ 直接使用鱼总提供的万能模板<code>springboot-init</code>,改成项目的名字，然后全局搜索关键字进行替换</p><p>​ 连接数据库</p><p>​ 测试运行</p><ol start="4"><li>数据库库表设计</li></ol><p>​ <strong>接口信息表</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"># 数据库初始化</span><br><span class="line"># <span class="variable">@author</span> <span class="operator">&lt;</span>a href<span class="operator">=</span>&quot;https://github.com/liyupi&quot;<span class="operator">&gt;</span>程序员鱼皮<span class="operator">&lt;</span><span class="operator">/</span>a<span class="operator">&gt;</span></span><br><span class="line"># <span class="variable">@from</span> <span class="operator">&lt;</span>a href<span class="operator">=</span>&quot;https://yupi.icu&quot;<span class="operator">&gt;</span>编程导航知识星球<span class="operator">&lt;</span><span class="operator">/</span>a<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- 创建库</span></span><br><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> myapi;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换库</span></span><br><span class="line">use myapi;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    id           <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;id&#x27;</span> <span class="keyword">primary</span> key,</span><br><span class="line">    userName     <span class="type">varchar</span>(<span class="number">256</span>)                           <span class="keyword">null</span> comment <span class="string">&#x27;用户昵称&#x27;</span>,</span><br><span class="line">    userAccount  <span class="type">varchar</span>(<span class="number">256</span>)                           <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;账号&#x27;</span>,</span><br><span class="line">    userAvatar   <span class="type">varchar</span>(<span class="number">1024</span>)                          <span class="keyword">null</span> comment <span class="string">&#x27;用户头像&#x27;</span>,</span><br><span class="line">    gender       tinyint                                <span class="keyword">null</span> comment <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    userRole     <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">default</span> <span class="string">&#x27;user&#x27;</span>            <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;用户角色：user / admin&#x27;</span>,</span><br><span class="line">    userPassword <span class="type">varchar</span>(<span class="number">512</span>)                           <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">    `accessKey` <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;accessKey&#x27;</span>,</span><br><span class="line">    `secretKey` <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;secretKey&#x27;</span>,</span><br><span class="line">    createTime   datetime     <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    updateTime   datetime     <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">    isDelete     tinyint      <span class="keyword">default</span> <span class="number">0</span>                 <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;是否删除&#x27;</span>,</span><br><span class="line">    <span class="keyword">constraint</span> uni_userAccount</span><br><span class="line">        <span class="keyword">unique</span> (userAccount)</span><br><span class="line">) comment <span class="string">&#x27;用户&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 接口信息</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> myapi.`interface_info`</span><br><span class="line">(</span><br><span class="line">    `id` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment comment <span class="string">&#x27;主键&#x27;</span> <span class="keyword">primary</span> key,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">    `description` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">null</span> comment <span class="string">&#x27;描述&#x27;</span>,</span><br><span class="line">    `url` <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;接口地址&#x27;</span>,</span><br><span class="line">    `requestHeader` text <span class="keyword">null</span> comment <span class="string">&#x27;请求头&#x27;</span>,</span><br><span class="line">    `responseHeader` text <span class="keyword">null</span> comment <span class="string">&#x27;响应头&#x27;</span>,</span><br><span class="line">    `status` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;接口状态（0-关闭，1-开启）&#x27;</span>,</span><br><span class="line">    `<span class="keyword">method</span>` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;请求类型&#x27;</span>,</span><br><span class="line">    `userId` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">    `createTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    `updateTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">    `isDelete` tinyint <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;是否删除(0-未删, 1-已删)&#x27;</span></span><br><span class="line">) comment  <span class="string">&#x27;接口信息&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户调用接口关系表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> myapi.`user_interface_info`</span><br><span class="line">(</span><br><span class="line">    `id` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment comment <span class="string">&#x27;主键&#x27;</span> <span class="keyword">primary</span> key,</span><br><span class="line">    `userId` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;调用用户 id&#x27;</span>,</span><br><span class="line">    `interfaceInfoId` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;接口 id&#x27;</span>,</span><br><span class="line">    `totalNum` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;总调用次数&#x27;</span>,</span><br><span class="line">    `leftNum` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;剩余调用次数&#x27;</span>,</span><br><span class="line">    `status` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;0-正常，1-禁用&#x27;</span>,</span><br><span class="line">    `createTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    `updateTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">    `isDelete` tinyint <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;是否删除(0-未删, 1-已删)&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;用户调用接口关系&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;许擎宇&#x27;</span>, <span class="string">&#x27;薛聪健&#x27;</span>, <span class="string">&#x27;www.cary-king.net&#x27;</span>, <span class="string">&#x27;潘博涛&#x27;</span>, <span class="string">&#x27;谭聪健&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;石炫明&#x27;</span>, <span class="number">9500534531</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;陆弘文&#x27;</span>, <span class="string">&#x27;白志强&#x27;</span>, <span class="string">&#x27;www.leslee-kuhn.net&#x27;</span>, <span class="string">&#x27;潘懿轩&#x27;</span>, <span class="string">&#x27;马鸿涛&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;陈峻熙&#x27;</span>, <span class="number">3982575846</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;毛建辉&#x27;</span>, <span class="string">&#x27;罗文&#x27;</span>, <span class="string">&#x27;www.rosaria-kilback.io&#x27;</span>, <span class="string">&#x27;冯子默&#x27;</span>, <span class="string">&#x27;彭哲瀚&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;赵远航&#x27;</span>, <span class="number">121776355</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;彭雨泽&#x27;</span>, <span class="string">&#x27;蔡煜祺&#x27;</span>, <span class="string">&#x27;www.norris-bergstrom.biz&#x27;</span>, <span class="string">&#x27;董思源&#x27;</span>, <span class="string">&#x27;田晓博&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;潘擎宇&#x27;</span>, <span class="number">740</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;傅志强&#x27;</span>, <span class="string">&#x27;陈梓晨&#x27;</span>, <span class="string">&#x27;www.jordan-reinger.com&#x27;</span>, <span class="string">&#x27;金志强&#x27;</span>, <span class="string">&#x27;熊锦程&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;邓睿渊&#x27;</span>, <span class="number">35542559</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;吕黎昕&#x27;</span>, <span class="string">&#x27;孔越彬&#x27;</span>, <span class="string">&#x27;www.fe-okon.info&#x27;</span>, <span class="string">&#x27;万伟宸&#x27;</span>, <span class="string">&#x27;林昊然&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;孟荣轩&#x27;</span>, <span class="number">1445</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;夏雪松&#x27;</span>, <span class="string">&#x27;许子骞&#x27;</span>, <span class="string">&#x27;www.lashawna-legros.co&#x27;</span>, <span class="string">&#x27;蔡昊然&#x27;</span>, <span class="string">&#x27;胡鹏涛&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;钟立辉&#x27;</span>, <span class="number">34075514</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;严钰轩&#x27;</span>, <span class="string">&#x27;阎志泽&#x27;</span>, <span class="string">&#x27;www.kay-funk.biz&#x27;</span>, <span class="string">&#x27;莫皓轩&#x27;</span>, <span class="string">&#x27;郭黎昕&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;龚天宇&#x27;</span>, <span class="number">70956</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;萧嘉懿&#x27;</span>, <span class="string">&#x27;曹熠彤&#x27;</span>, <span class="string">&#x27;www.margarette-lindgren.biz&#x27;</span>, <span class="string">&#x27;田泽洋&#x27;</span>, <span class="string">&#x27;邓睿渊&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;梁志强&#x27;</span>, <span class="number">98</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;杜驰&#x27;</span>, <span class="string">&#x27;冯思源&#x27;</span>, <span class="string">&#x27;www.vashti-auer.org&#x27;</span>, <span class="string">&#x27;黎健柏&#x27;</span>, <span class="string">&#x27;武博文&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;李伟宸&#x27;</span>, <span class="number">9</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;史金鑫&#x27;</span>, <span class="string">&#x27;蔡鹏涛&#x27;</span>, <span class="string">&#x27;www.diann-keebler.org&#x27;</span>, <span class="string">&#x27;徐烨霖&#x27;</span>, <span class="string">&#x27;阎建辉&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;李烨伟&#x27;</span>, <span class="number">125</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;林炫明&#x27;</span>, <span class="string">&#x27;贾旭尧&#x27;</span>, <span class="string">&#x27;www.dotty-kuvalis.io&#x27;</span>, <span class="string">&#x27;梁雨泽&#x27;</span>, <span class="string">&#x27;龙伟泽&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;许智渊&#x27;</span>, <span class="number">79998</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;何钰轩&#x27;</span>, <span class="string">&#x27;赖智宸&#x27;</span>, <span class="string">&#x27;www.andy-adams.net&#x27;</span>, <span class="string">&#x27;崔思淼&#x27;</span>, <span class="string">&#x27;白鸿煊&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;邵振家&#x27;</span>, <span class="number">7167482751</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;魏志强&#x27;</span>, <span class="string">&#x27;于立诚&#x27;</span>, <span class="string">&#x27;www.ione-aufderhar.biz&#x27;</span>, <span class="string">&#x27;朱懿轩&#x27;</span>, <span class="string">&#x27;万智渊&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;唐昊强&#x27;</span>, <span class="number">741098</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;严君浩&#x27;</span>, <span class="string">&#x27;金胤祥&#x27;</span>, <span class="string">&#x27;www.duane-boyle.org&#x27;</span>, <span class="string">&#x27;雷昊焱&#x27;</span>, <span class="string">&#x27;侯思聪&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;郝思&#x27;</span>, <span class="number">580514</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;姚皓轩&#x27;</span>, <span class="string">&#x27;金鹏&#x27;</span>, <span class="string">&#x27;www.lyda-klein.biz&#x27;</span>, <span class="string">&#x27;杜昊强&#x27;</span>, <span class="string">&#x27;邵志泽&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;冯鸿涛&#x27;</span>, <span class="number">6546</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;廖驰&#x27;</span>, <span class="string">&#x27;沈泽洋&#x27;</span>, <span class="string">&#x27;www.consuelo-sipes.info&#x27;</span>, <span class="string">&#x27;彭昊然&#x27;</span>, <span class="string">&#x27;邓耀杰&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;周彬&#x27;</span>, <span class="number">7761037</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;赖智渊&#x27;</span>, <span class="string">&#x27;邓志泽&#x27;</span>, <span class="string">&#x27;www.emerson-mann.co&#x27;</span>, <span class="string">&#x27;熊明哲&#x27;</span>, <span class="string">&#x27;贺哲瀚&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;田鹏&#x27;</span>, <span class="number">381422</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;许涛&#x27;</span>, <span class="string">&#x27;陆致远&#x27;</span>, <span class="string">&#x27;www.vella-ankunding.name&#x27;</span>, <span class="string">&#x27;贾哲瀚&#x27;</span>, <span class="string">&#x27;莫昊焱&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;袁越彬&#x27;</span>, <span class="number">4218096</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> myapi.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`) <span class="keyword">values</span> (<span class="string">&#x27;吕峻熙&#x27;</span>, <span class="string">&#x27;沈鹏飞&#x27;</span>, <span class="string">&#x27;www.shari-reichel.org&#x27;</span>, <span class="string">&#x27;郭鸿煊&#x27;</span>, <span class="string">&#x27;覃烨霖&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;熊黎昕&#x27;</span>, <span class="number">493</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>留一个小bug，数据库建表语句直接套用的最终建表语句，user表中涉及到两个关于key的字段，手动改成了可以为空，若有问题，后续再做出更改</p></blockquote><blockquote><p>利用<code>MyBatisX</code>插件生成接口管理的增删改查代码</p></blockquote><p>将生成的代码逻辑复制到项目的dao、service、mapper包里，</p><p>然后还剩一个controller层，直接复制一份模板中的controller层的代码，进行复用</p><p>注意此时模糊查询使用的字段不是content，而是description，进行相应的更改。</p><p>此时，增删改查操作已完成，就这么简单</p><p>跑通后端</p><ul><li><h3 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h3></li></ul><p>使用oneapi插件自动生成（openapi规范）</p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307012353984.png" alt="image-20230701235258820"></p><blockquote><p>先前，我们登陆时是采用的start假数据进行登录，此时使用dev，登陆页面是存在问题的，因为脚手架自动生成的页面会强制要求登录，此时的登录接口与我们oneapi自动生成的接口对应不上，需要手动进行更改User》》Login》》index.tsx</p></blockquote><p>因为没有开发注册页面，可以从注册中心项目中复制一个过来</p><p>为了便捷的进行开发，先从swagger注册一个账号，然后登录发现没有进行跳转，通过分析得出，是因为前端没有记录用户的登录状态，所以要进一步进行完善，在typings.d.ts中进行定义全局登录态</p><p>改造页面，将前端展示的表格，用来展示自己的数据</p><h2 id="Day02-接口调用开发（前端）"><a href="#Day02-接口调用开发（前端）" class="headerlink" title="Day02 接口调用开发（前端）"></a>Day02 接口调用开发（前端）</h2><blockquote><p>首先发现一个问题，使用后端swagger进行user密码更改的时候，密码没有进行加密，会导致前端进行校验的时候返回用户名或者密码不正确的信息</p></blockquote><ul><li><h3 id="优化前端展示页面（改路由，先不删）"><a href="#优化前端展示页面（改路由，先不删）" class="headerlink" title="优化前端展示页面（改路由，先不删）"></a>优化前端展示页面（改路由，先不删）</h3><ul><li>保持前后端组件名一致</li><li>优化页面代码</li><li>首页没有页面，后续进行开发一个非管理员用户可以看到的页面</li><li>调整导航栏的位置，可以先使用antDesignPro框架提供的切换导航布局小设置</li></ul></li><li><h3 id="新建模态框的编写真的很搞心态，最后的原因竟然是因为一个小的错误（静下心来）（血泪教训，做完项目过一遍react）"><a href="#新建模态框的编写真的很搞心态，最后的原因竟然是因为一个小的错误（静下心来）（血泪教训，做完项目过一遍react）" class="headerlink" title="新建模态框的编写真的很搞心态，最后的原因竟然是因为一个小的错误（静下心来）（血泪教训，做完项目过一遍react）"></a>新建模态框的编写真的很搞心态，最后的原因竟然是因为一个小的错误（静下心来）（血泪教训，做完项目过一遍react）</h3></li><li><h3 id="完善修改框"><a href="#完善修改框" class="headerlink" title="完善修改框"></a>完善修改框</h3><ul><li><p>此处设计到React的核心知识点，也是重中之重（useEffect、useRef）</p></li><li><p>```tsx<br>const formRef = useRef<proforminstance>();</proforminstance></p><p>useEffect(() =&gt; {<br>if(formRef){</p><pre><code>formRef.current?.setFieldsValue(values);
</code></pre><p>}<br>}, [values])</p><p>return (</p><pre><code>&lt;Modal visible=&#123;visible&#125; footer=&#123;null&#125; onCancel=&#123;() =&gt; onCancel?.()&#125;&gt;
  &lt;ProTable
    type=&quot;form&quot;
    columns=&#123;columns&#125;
    // 因为这里使用的form组件，只会初始化一次，所以会造成点击修改按钮进行修改的话，数据是不会变的
    // form=&#123;&#123;
            //   initialValues: values
            // &#125;&#125;
    
    // 所以此处用到了监听
    formRef=&#123;formRef&#125;
    
    onSubmit=&#123;async (value) =&gt; &#123;
      onSubmit?.(value);
    &#125;&#125;
  /&gt;
&lt;/Modal&gt;
</code></pre><p>);</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  * &gt; 此处有Bug，后端报空指针</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* ### 完善删除框</span><br><span class="line"></span><br><span class="line">  * 仿照以上步骤完成</span><br><span class="line"></span><br><span class="line">  * &gt; 此时发现进行相关操作之后数据不会自动更新，所以我们引入actionRef，它可以拿到proTable的控制权，使用actionRef.current?.reload()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 模拟接口项目（smartapi-interface）（后端）</span><br><span class="line"></span><br><span class="line">提供三个模拟接口</span><br><span class="line"></span><br><span class="line">1. GET接口</span><br><span class="line">2. POST接口（url传参）</span><br><span class="line">3. POST接口（Restful）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 开始开发模拟接口项目部分</span><br><span class="line"></span><br><span class="line">采用创建几个controller控制层小接口，前端传参进行调用，但是这样不符合逻辑，所以我们要通过后端来进行传参！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 开发调用接口</span><br><span class="line"></span><br><span class="line">几种HTTP调用方式</span><br><span class="line"></span><br><span class="line">	1. HttpClient</span><br><span class="line">	1. RestTemplete</span><br><span class="line">	1. 工具（OKHttp、HuTool）</span><br><span class="line"></span><br><span class="line">这里我们使用HuTool来进行调用[HuTool](https://hutool.cn/docs/#/)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">参考文档是一个好东西，利用好</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">那么现在已经开发好调用接口了，但是用户调用你的接口，或者黑客黑你的接口，所以需要对调用者进行一个调用限制，那么如何加以限制？</span><br><span class="line"></span><br><span class="line">这时可以联想一下我们平时调用第三方接口时，都会有一些key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### API 签名认证（客户端与服务端有点迷惑，后续捋顺）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**本质：**</span><br><span class="line"></span><br><span class="line">1. 签发签名</span><br><span class="line"></span><br><span class="line">	2. 使用签名(校验签名)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**为什么需要？**</span><br><span class="line"></span><br><span class="line">1. 保证安全性，不能随便一个人就可以调用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**怎么实现？（复杂、无序、无规律）**</span><br><span class="line"></span><br><span class="line">通过http request header头传递参数。</span><br><span class="line"></span><br><span class="line">参数1：assesKey：调用的标识（一串无规则字符串） User A、B</span><br><span class="line"></span><br><span class="line">参数2：secretKey：相当于密码</span><br><span class="line"></span><br><span class="line">也就是用户名和密钥，区别就是ak、sk是无状态的</span><br><span class="line"></span><br><span class="line">在服务端数据库表中新增以上两个字段，用户客户端进行校验。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">但是这样的方法时容易被拦截的，不能把密钥直接在服务器之间进行传递，要进行加密。所以要对密码进一步进行加密。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">参数3：用户请求参数（更严格）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">参数4：sign</span><br><span class="line"></span><br><span class="line">加密方式：对称机密、非对称加密、不可解密加密（MD5）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">用户参数 + 密钥 ==》 **签名生成算法** ==》不可解密的值</span><br><span class="line"></span><br><span class="line">wl + abcdefgh ==》afdasfafszv（通过签名算法加密）</span><br><span class="line"></span><br><span class="line">那么如何知道这个签名是否正确？</span><br><span class="line"></span><br><span class="line">**服务端会通过用一摸一样的参数和算法去生成签名，只要和用户才能属的签名一致，则正确!**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**怎么防重放？**</span><br><span class="line"></span><br><span class="line">参数5：加nonce随机数，保证只能用一次，但是服务端也要保存随机数</span><br><span class="line"></span><br><span class="line">参数6：timestamp时间戳（加上时间戳可以保证随机数可以清除）</span><br><span class="line"></span><br><span class="line">**API签名认证是一个很灵活的设计，具体要有哪些参数、参数名一定要根据实际场景来（比如userId、appId、version、固定值等）**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">思考：难道开发者每次调用接口都需要自己来写签名算法吗？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 开发一个简单易用的SDK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">理想情况：开发者只需要关心调用哪些接口、传递哪些参数，就跟调用自己的代码一样简单。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">开发stater的好处：</span><br><span class="line"></span><br><span class="line">1. 开发者引入之后，可以直接在application.yml中写配置，自动创建客户端。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 创建SDK项目（开发starter）（简历亮点）</span><br><span class="line"></span><br><span class="line">引入依赖：</span><br><span class="line"></span><br><span class="line">1. lombook</span><br><span class="line">2. Spring Configuration Processor（自动生成配置文件写代码的提示）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">改造pom依赖，一定要删掉build标签内的代码，因为我们在进行构建依赖包，不是要直接运行的jar的项目</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">尝试把打好的包发布到maven中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Day03 接口保护与优化</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; 此时，我们发现鱼总的后端项目模块中已经包含前面单独创建好的SDK和interface模拟接口项目了，那么我们如何把这两个添加到后端的项目中呢？</span><br><span class="line">&gt;</span><br><span class="line">&gt; 方案一：</span><br><span class="line">&gt;</span><br><span class="line">&gt; ​	受尚医通项目的影响，我想应该可以通过增加子模块的方法拉进行添加，但是添加之后好像是不太行，跟鱼总的不一样，这种方法应该是可以使多个项目在同一个窗口中打开（解决了之前我的疑虑）</span><br><span class="line">&gt;</span><br><span class="line">&gt; 方案二：</span><br><span class="line">&gt;</span><br><span class="line">&gt; ​	我们看到鱼总的后端项目中，另外两个项目（SDK和interface）是两个目录的标识，于是我就直接复制粘贴到后端项目的文件夹中了，然后Java源文件会变成红J，可以通过右键rsc下main下的Java文件夹，然后mark Directory as--》Sources Root，将Java文件夹标记为源码根目录，如图所示：</span><br><span class="line">&gt;</span><br><span class="line">&gt; ![image-20230708205543307](https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307092023528.png)</span><br><span class="line">&gt;</span><br><span class="line">&gt; 然后我们发现maven的pom依赖文件的图标也不对，也通过桐言的方法，右键--》add maven project标记为maven项目，大功告成！</span><br><span class="line"></span><br><span class="line">1.开发接口发布/下线的功能（管理员）</span><br><span class="line"></span><br><span class="line">2.前端浏览接口，查看 接口文档，申请签名（注册）</span><br><span class="line"></span><br><span class="line">3.在线测试（用户）</span><br><span class="line"></span><br><span class="line">4.统一用户调用接口次数</span><br><span class="line"></span><br><span class="line">5.优化系统-API网关</span><br><span class="line"></span><br><span class="line">### 开发接口发布/下线的功能（仅管理员） </span><br><span class="line"></span><br><span class="line">&gt; 此处又涉及到了一个待学知识点：</span><br><span class="line">&gt;</span><br><span class="line">&gt; Spring的AOP切面应用</span><br><span class="line">&gt;</span><br><span class="line">&gt; 可以用来通过注解的方式进行权限管理。</span><br><span class="line"></span><br><span class="line">### 后端接口： </span><br><span class="line"></span><br><span class="line">**发布接口**（仅管理员） </span><br><span class="line"></span><br><span class="line">1.校验该接口是否存在</span><br><span class="line"></span><br><span class="line">2.判断接口是否可以被调用</span><br><span class="line"></span><br><span class="line">​	利用开发好的SDK，通过调用接口看是否能够进行调用的通</span><br><span class="line"></span><br><span class="line">​	第一步：启动smartapi-interface项目</span><br><span class="line"></span><br><span class="line">​	第二步：在smartapi-backend中引入SDK的依赖</span><br><span class="line"></span><br><span class="line">​	第三步：在application.yml中写入ak、sk</span><br><span class="line"></span><br><span class="line">​	第四步：在接口中引入客户端的实例</span><br><span class="line"></span><br><span class="line">​			@Resource</span><br><span class="line"></span><br><span class="line">​			private SmartApiClient smartapiclient</span><br><span class="line"></span><br><span class="line">&gt; TODO:</span><br><span class="line">&gt;</span><br><span class="line">&gt; &gt; &gt;  1. 判断接口是否可以调用时，由固定方法名改为可以根据测试地址进行调用</span><br><span class="line">&gt; &gt; &gt;  2. 用户测试接口判断接口是否可以调用时，由固定方法名改为可以根据测试地址进行调用</span><br><span class="line"></span><br><span class="line">3.修改数据库接口字段为1</span><br><span class="line"></span><br><span class="line">**下线接口**（仅管理员） </span><br><span class="line"></span><br><span class="line">1.校验该接口是否存在</span><br><span class="line"></span><br><span class="line">2.修改数据库接口字段为 0</span><br><span class="line"></span><br><span class="line">按钮已添加并完善。测试中出现一个经典问题，如图所示：</span><br><span class="line"></span><br><span class="line">![image-20230710000821503](https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307100008989.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; 待办事件：</span><br><span class="line">&gt;</span><br><span class="line">&gt; 流程：</span><br><span class="line">&gt;</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br><span class="line">&gt; **前端**添加上线、下线按钮、√、增加用户浏览页面、查看接口文档、申请签名</span><br><span class="line">&gt;</span><br><span class="line">&gt; **后端**申请签名（更改完善数据库写生成签名的算法）</span><br><span class="line">&gt;</span><br><span class="line">&gt; **前端**</span><br><span class="line">&gt;</span><br><span class="line">&gt; 新增在线调用的按钮</span><br><span class="line">&gt;</span><br><span class="line">&gt; **后端**</span><br><span class="line">&gt;</span><br><span class="line">&gt; 开发在线调用的接口</span><br><span class="line">&gt;</span><br><span class="line">&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 前端浏览接口</span><br><span class="line"></span><br><span class="line">```react</span><br><span class="line">import &#123; PageContainer &#125; from &#x27;@ant-design/pro-components&#x27;;</span><br><span class="line">import React, &#123;useEffect, useState&#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123;List, message&#125; from &quot;antd&quot;;</span><br><span class="line">import &#123;</span><br><span class="line">  listInterfaceInfoByPageUsingGET</span><br><span class="line">&#125; from &quot;@/services/smartapi-backend/interfaceInfoController&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 主页</span><br><span class="line"> * @constructor</span><br><span class="line"> */</span><br><span class="line">const Index: React.FC = () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  const [loading, setLoading] = useState(false);</span><br><span class="line">  const [list, setList] = useState&lt;API.InterfaceInfo[]&gt;([]);</span><br><span class="line">  const [total ,setTotal] = useState&lt;number&gt;(0);</span><br><span class="line"></span><br><span class="line">  const loadData = async (current=1 , pageSize = 8 ) =&gt;&#123;</span><br><span class="line">    setLoading(true);</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await listInterfaceInfoByPageUsingGET(&#123;</span><br><span class="line">        current,pageSize</span><br><span class="line">      &#125;);</span><br><span class="line">      setList(res?.data?.records ?? []);</span><br><span class="line">      setTotal(res?.data?.total ?? 0);</span><br><span class="line"></span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line"></span><br><span class="line">      message.error(&#x27;请求失败,&#x27;+error.message);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    setLoading(false);</span><br><span class="line">  &#125;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    loadData();</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;PageContainer title=&quot;在线接口开放平台&quot;&gt;</span><br><span class="line">      &lt;List</span><br><span class="line">        className=&quot;my-list&quot;</span><br><span class="line">        loading=&#123;loading&#125;</span><br><span class="line">        itemLayout=&quot;horizontal&quot;</span><br><span class="line">        dataSource=&#123;list&#125;</span><br><span class="line">        renderItem=&#123;item =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          const apiLink =`/interface_info/$&#123;item.id&#125;`;</span><br><span class="line">          return(</span><br><span class="line">            &lt;List.Item</span><br><span class="line">              actions=&#123;[&lt;a key=&#123;item.id&#125; href=&#123;apiLink&#125;&gt;查看&lt;/a&gt;]&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;List.Item.Meta</span><br><span class="line">                title=&#123;&lt;a href=&#123;apiLink&#125;&gt;&#123;item.name&#125;&lt;/a&gt;&#125;</span><br><span class="line">                description=&#123;item.description&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/List.Item&gt;</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        pagination =&#123;</span><br><span class="line">          &#123;</span><br><span class="line">            // eslint-disable-next-line @typescript-eslint/no-shadow</span><br><span class="line">            showTotal(total: number)&#123;</span><br><span class="line">              return &#x27;总数：&#x27; +total;</span><br><span class="line">            &#125;,</span><br><span class="line">            pageSize: 8,</span><br><span class="line">            total,</span><br><span class="line">            onChange(page,pageSize)&#123;</span><br><span class="line">              loadData(page,pageSize);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/PageContainer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Index;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="查看接口文档"><a href="#查看接口文档" class="headerlink" title="查看接口文档"></a>查看接口文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import &#123; PageContainer &#125; from &#x27;@ant-design/pro-components&#x27;;</span><br><span class="line">import React, &#123;useEffect, useState&#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123;Card, Descriptions, message&#125; from &quot;antd&quot;;</span><br><span class="line">import &#123;</span><br><span class="line">  getInterfaceInfoByIdUsingGET,</span><br><span class="line"></span><br><span class="line">&#125; from &quot;@/services/smartapi-backend/interfaceInfoController&quot;;</span><br><span class="line">import &#123; useParams&#125; from &quot;@@/exports&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 主页</span><br><span class="line"> * @constructor</span><br><span class="line"> */</span><br><span class="line">const Index: React.FC = () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  const [loading, setLoading] = useState(false);</span><br><span class="line">  const [data, setData] = useState&lt;API.InterfaceInfo&gt;();</span><br><span class="line">  const params  = useParams();</span><br><span class="line"></span><br><span class="line">  const loadData = async () =&gt;&#123;</span><br><span class="line">    if (!params.id)&#123;</span><br><span class="line">      message.error(&#x27;参数不存在&#x27;);</span><br><span class="line">      return ;</span><br><span class="line">    &#125;</span><br><span class="line">    setLoading(true);</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await getInterfaceInfoByIdUsingGET(&#123;</span><br><span class="line">        id: Number(params.id)</span><br><span class="line">      &#125;);</span><br><span class="line">      setData(res.data);</span><br><span class="line"></span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line"></span><br><span class="line">      message.error(&#x27;请求失败,&#x27;+error.message);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    setLoading(false);</span><br><span class="line">  &#125;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    loadData();</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;PageContainer title=&quot;查看接口文档&quot;&gt;</span><br><span class="line">      &lt;Card&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          data?(</span><br><span class="line">            &lt;Descriptions title=&#123;data.name&#125; column=&#123;1&#125;&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;描述&quot;&gt;&#123;data.description&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;接口状态&quot;&gt;&#123;data.status? &#x27;正常&#x27;: &#x27;关闭&#x27;&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;请求地址&quot;&gt;&#123;data.url&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;请求方法&quot;&gt;&#123;data.method&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;请求头&quot;&gt;&#123;data.requestHeader&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;响应头&quot;&gt;&#123;data.responseHeader&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;创建时间&quot;&gt;&#123;data.createTime&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;更新时间&quot;&gt;&#123;data.updateTime&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;/Descriptions&gt;</span><br><span class="line">          ):(</span><br><span class="line">            &lt;&gt;接口不存在&lt;/&gt;</span><br><span class="line">          )&#125;</span><br><span class="line">      &lt;/Card&gt;</span><br><span class="line">    &lt;/PageContainer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Index;</span><br></pre></td></tr></table></figure><h3 id="申请签名（注册）"><a href="#申请签名（注册）" class="headerlink" title="申请签名（注册）"></a>申请签名（注册）</h3><p>通过数据库新增字段、更改用户注册的逻辑（使用DigestUtil加密算法生成ak、sk，然后加入数据库）</p><blockquote><p>留一个小作业:</p><p>新增一个小拓展功能：用户可以手动更改自己的ak、sk</p></blockquote><h3 id="新建真实数据（前端）"><a href="#新建真实数据（前端）" class="headerlink" title="新建真实数据（前端）"></a>新建真实数据（前端）</h3><p><strong>新建这些真实的数据</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getUsernameByPost,</span><br><span class="line"></span><br><span class="line">获取用户名,</span><br><span class="line"></span><br><span class="line">http://localhost:8123/name/user,</span><br><span class="line"></span><br><span class="line">&#123;”Content-Type“: ”application/json“&#125;,</span><br><span class="line"></span><br><span class="line">&#123;”Content-Type“: ”application/json“&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>oh my god，此时发现遗忘了一个重要的请求参数字段，于是通过建表语句、IDEA客户端modify table，来增加这么一个字段。</p><p>修改相应的model实体包中的字段信息以及向mybatisplus.xml中添加这个字段。</p><p>重启项目—》前端重新使用openai插件生成接口</p><p>前端也需要完善修改组件的表单列名，新增一个requestParams</p><p>完成！</p><p><strong>完善接口信息的请求参数信息</strong></p><p><strong>在线调用</strong></p><p>前端界面的编写，通过ant design组件库利用现成的表单组件来完成在线按钮的添加与请求参数的基本表单。</p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307100238354.png" alt="image-20230710023831281"></p><p>请求参数的类型（JSON类型）</p><blockquote><p>又一个小作业：</p><p>在线调用的扩展点：</p><p>先跑通整个流程，然后根据请求头和请求类型的不同设计不同的表单和界面，增强用户体验</p></blockquote><h3 id="后端调用流程"><a href="#后端调用流程" class="headerlink" title="后端调用流程"></a>后端调用流程</h3><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307100242406.png" alt="image-20230710024253445"></p><p>按照标准的企业开发流程来说：</p><p>一定会选择第一种开发方式，不然后期的网关与计费就毫无作用，</p><p>第二种方式可以用来自己调用测试。</p><p>流程：</p><ol><li>前端将用户输入的请求参数与要进行测试的接口id发给平台后端</li><li>在调用前进行一些校验</li><li>平台后端去调用模拟接口</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> interfaceInfoInvokeRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/invoke&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BaseResponse&lt;Object&gt; <span class="title function_">invokeInterfaceInfo</span><span class="params">(<span class="meta">@RequestBody</span> InterfaceInfoInvokeRequest interfaceInfoInvokeRequest,</span></span><br><span class="line"><span class="params">                                                    HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (interfaceInfoInvokeRequest == <span class="literal">null</span> || interfaceInfoInvokeRequest.getId() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> interfaceInfoInvokeRequest.getId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userRequestParams</span> <span class="operator">=</span> interfaceInfoInvokeRequest.getUserRequestParams();</span><br><span class="line">        <span class="comment">// 判断是否存在</span></span><br><span class="line">        <span class="type">InterfaceInfo</span> <span class="variable">oldInterfaceInfo</span> <span class="operator">=</span> interfaceInfoService.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (oldInterfaceInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (oldInterfaceInfo.getStatus() == InterfaceInfoStatusEnum.OFFLINE.getValue()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;接口已关闭&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userService.getLoginUser(request);</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKey</span> <span class="operator">=</span> loginUser.getAccessKey();</span><br><span class="line">        <span class="type">String</span> <span class="variable">secretKey</span> <span class="operator">=</span> loginUser.getSecretKey();</span><br><span class="line">        <span class="type">MyClient</span> <span class="variable">tempClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClient</span>(accessKey, secretKey);</span><br><span class="line">        <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">        com.wl.smartapiclientsdk.model.<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> gson.fromJson(userRequestParams, com.wl.smartapiclientsdk.model.User.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">usernameByPost</span> <span class="operator">=</span> tempClient.getUserNameByPost(user);</span><br><span class="line">        <span class="keyword">return</span> ResultUtils.success(usernameByPost);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>后端调用逻辑已完成</p><p>现在继续完善前端的接口，将前端点击调用按钮后改为我们刚才通过后端实现的真实的功能。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const onFinish = (values: any) =&gt; &#123;</span><br><span class="line">    if (!params.id)&#123;</span><br><span class="line">      message.error(&#x27;接口不存在&#x27;);</span><br><span class="line">      return ;</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">      invokeInterfaceInfoUsingPOST(&#123;</span><br><span class="line">        id: params.id,</span><br><span class="line">        ...values</span><br><span class="line">      &#125;)</span><br><span class="line">      message.success(&#x27;请求成功&#x27;);</span><br><span class="line">      return true;</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      message.error(&#x27;请求失败，&#x27; + error.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>逻辑打通之后还要进行回显数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// async 是设置同步的意思</span><br><span class="line"></span><br><span class="line"> const onFinish = async (values: any) =&gt; &#123;</span><br><span class="line">    if (!params.id)&#123;</span><br><span class="line">      message.error(&#x27;接口不存在&#x27;);</span><br><span class="line">      return ;</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">// 等待</span><br><span class="line"></span><br><span class="line">      const res = await invokeInterfaceInfoUsingPOST(&#123;</span><br><span class="line">        id: params.id,</span><br><span class="line">        ...values</span><br><span class="line">      &#125;)</span><br><span class="line">// 将res.data赋给setInvokeRes</span><br><span class="line"></span><br><span class="line">      setInvokeRes(res.data);</span><br><span class="line">      message.success(&#x27;请求成功&#x27;);</span><br><span class="line">      return true;</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      message.error(&#x27;请求失败，&#x27; + error.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>然后在表单处新增一个卡片，用于接收invokeRes进行数据回显。</p><p>已完成，测试通过！</p><p>并且完善了一个缓冲显示的loading</p><p>TODO:</p><blockquote><blockquote><ol><li>判断接口是否可以调用时，由固定方法名改为可以根据测试地址进行调用</li><li>用户测试接口判断接口是否可以调用时，由固定方法名改为可以根据测试地址进行调用</li><li>此时任何人调用模拟接口都是可以的，因为我们的SDK是写死在配置文件中的，所以后续再进行完善，从数据库中进行校验！</li></ol></blockquote></blockquote><p>over！</p><p>下面我们的网关用Spring Cloud GateWay实现</p><h2 id="Day04"><a href="#Day04" class="headerlink" title="Day04"></a>Day04</h2><ol><li><p>开发接口调用次数统计 20min</p></li><li><p>优化系统的架构—学习架构设计、接触应用场景==&gt;面对一个需求就会自然而然地提高开发效率。 60min</p><p>（怎么把一个项目的架构设计做的更加合理，涉及到API网关的知识）</p><ul><li>网关是什么？</li><li>网关的作用？</li><li>网关的应用场景以及实现？</li><li>结合业务去应用网关</li></ul></li></ol><h3 id="接口调用次数统计"><a href="#接口调用次数统计" class="headerlink" title="接口调用次数统计"></a>接口调用次数统计</h3><p>需求：</p><pre><code>1. 用户每次调用接口成功，次数加1（或者设定一定的调用次数，每次减1）
1. 给用户分配或者用户自助申请接口调用次数
</code></pre><blockquote><p>业务流程：</p><ol><li>用户调用接口（之前已完成）</li><li>修改数据库，调用次数（加1或者减1）</li></ol></blockquote><p>设计库表：</p><blockquote><p>哪个用户？哪个接口？</p><p>用户 =&gt; 接口（多对多）</p></blockquote><p>用户接口关系表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 用户调用接口关系表</span><br><span class="line">create table if not exists smartapi.`user_interface_info`</span><br><span class="line">(</span><br><span class="line">    `id` bigint not null auto_increment comment &#x27;主键&#x27; primary key,</span><br><span class="line">    `userId` bigint not null comment &#x27;调用用户 id&#x27;,</span><br><span class="line">    `interfaceInfoId` bigint not null comment &#x27;接口 id&#x27;,</span><br><span class="line">    `totalNum` int default 0 not null comment &#x27;总调用次数&#x27;,</span><br><span class="line">    `leftNum` int default 0 not null comment &#x27;剩余调用次数&#x27;,</span><br><span class="line">    `status` int default 0 not null comment &#x27;0-正常，1-禁用&#x27;,</span><br><span class="line">    `createTime` datetime default CURRENT_TIMESTAMP not null comment &#x27;创建时间&#x27;,</span><br><span class="line">    `updateTime` datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment &#x27;更新时间&#x27;,</span><br><span class="line">    `isDelete` tinyint default 0 not null comment &#x27;是否删除(0-未删, 1-已删)&#x27;</span><br><span class="line">) comment &#x27;用户调用接口关系&#x27;;</span><br></pre></td></tr></table></figure><h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ol><li><p>开发基本的增删改查（给管理员使用）</p><blockquote><p>直接使用Mybatis-X生成相关的实体类（注意在删除字段上米娜加上逻辑删除@TableLogic）、mapper、service实现类没然后移动到项目对应的包中。</p><p>复制写好的Controller，改那些增删改查！ 完成√</p></blockquote></li><li><p>开发用户调用接口次数加1（或者减1）</p><p>问：如果每个接口的方法，都写调用次数 + 1，是不是比较麻烦，如果在本项目中，将这个调用次数+ 1，封装成一个方法，也是可以的，但是<code>代码侵入性很强！</code></p><p>致命问题是：接口开发者需要自己进行调用！</p><p>解决方法：</p><ol><li>Spring中的AOP（推荐，是Spring的一个核心特性）</li><li>Servelet中的拦截器、过滤器（Fillter）</li><li>通用的方法（缺点：代码侵入性强，需要自己调用）</li><li>网关</li></ol></li></ol><p>简单说一下AOP切面的基本过程：</p><blockquote><p>先说一下AOP切面的作用：</p><p>就相当于在接口或者方法调用前或者调用之后帮你做一些事情，其底层的原理就是动态代理。</p><p>使用AOP切面的</p><p>优点：</p><p>独立于接口，在每个接口调用前后加 1</p><p>缺点：</p><p>只存在于单个项目中，如果每个团队都要写一个自己的切面</p><p>// TODO：下去看一下AOP的流程，熟悉一下</p></blockquote><p>我们在这个项目中使用网关来实现接口调用次数。</p><p>网关就当与在所有接口的入口前加了一层检票口，如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307160152994.png" alt="image-20230716015231451"></p><p>因为网关实现的有调用次数的统计，所以开发者可以通关网关来查看，而用户调用接口时直接输入请求参数、请求地址即可。</p><h3 id="网关："><a href="#网关：" class="headerlink" title="网关："></a>网关：</h3><p>这里为什么写这么多理论呢？写代码不一定是最重要的，重要的是思想！逻辑思想明白之后，无非就是看文档、百度实现。</p><blockquote><p>什么是网关呢？就相当于车票检票口，统一去检票。</p><p>优点？统一去进行一些操作、处理一些问题。</p><p>作用？</p><ol><li><p>路由</p></li><li><p>负载均衡</p></li><li><p>统一鉴权</p></li><li><p>统一处理跨域</p></li><li><p>统一业务处理（缓存）</p></li><li><p>访问控制</p></li><li><p>发布控制（灰度发布，也就是慢慢控制接口的流量，不断开放给更多用户，然后达到升级接口的目的）</p></li><li><p>流量染色（给流量添加一些标识，比如新的请求头信息）</p></li><li><p>统一接口保护</p><ol><li><p>限制请求</p></li><li><p>信息脱敏（网关可以操作你的请求口，进而抹去敏感信息）</p></li><li><p>降级（熔断，保险起见，接口下线后，可以返回一些提示信息）</p></li><li><p>限流</p><p>（// TODO：学习令牌桶算法，学习露桶算法，学习一下）</p></li><li><p>RedislimitHandler</p></li><li><p>超时时间</p></li><li><p>重试（业务保护）</p></li></ol></li><li><p>统一日志</p></li><li><p>统一文档（将下游项目的文档统一聚合，展示到一个页面）</p></li></ol></blockquote><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>起到转发的作用，比如有接口A和接口B,网关会记录这些信息，根据用户访问的地址和参数，转发请求到对应的接口（服务器/集群）</p><p>用户a调用接口A</p><p>/a=&gt;接口A /b=&gt;接口B</p><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories</a></p><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>在路由的基础上可以转发到某一个服务器</p><p>/c =&gt; 服务A/ 集群A（随机转发到其中的某一个机器）</p><p>uri从固定地址改成b:xx</p><h3 id="统一鉴权"><a href="#统一鉴权" class="headerlink" title="统一鉴权"></a>统一鉴权</h3><p>判断用户是否有权限进行操作，无论访问什么接口，我都统一去判断权限，不用重复写</p><h3 id="统一处理跨域"><a href="#统一处理跨域" class="headerlink" title="统一处理跨域"></a>统一处理跨域</h3><p>网关统一处理跨域，不用在每个项目单独处理</p><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration</a></p><h3 id="统一业务处理"><a href="#统一业务处理" class="headerlink" title="统一业务处理"></a>统一业务处理</h3><p>把每个项目中都要做的通用逻辑放到上层（网关），统一处理，比如本项目的次数统计</p><h3 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h3><p>黑白名单，比如限制ddos ip</p><h3 id="发布控制"><a href="#发布控制" class="headerlink" title="发布控制"></a>发布控制</h3><p>灰度发布，比如上线新接口，先给新接口分配 20%流量，老接口80% ,再慢慢调整比例</p><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-weight-route-predicate-">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-weight-route-predicate-</a> factory</p><h3 id="流量染色"><a href="#流量染色" class="headerlink" title="流量染色"></a>流量染色</h3><p>区分用户来源</p><p>给请求（流量）添加一些标识，一般是设置请求头中，添加新的请求头 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory</a></p><p>全局染色：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#default-filters">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#default-filters</a></p><h3 id="接口保护"><a href="#接口保护" class="headerlink" title="接口保护"></a>接口保护</h3><p>1 限制请求 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#requestheadersiz-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#requestheadersiz-gatewayfilter-factory</a></p><p>2 信息脱敏 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-removerequestheader-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-removerequestheader-gatewayfilter-factory</a></p><p>3 降级（熔断） 进行兜底 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#fallback-headers">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#fallback-headers</a></p><p>4 限流 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-requestratelimiter-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-requestratelimiter-gatewayfilter-factory</a></p><p>5 超时时间 超时就中断 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#http-timeouts-configuration">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#http-timeouts-configuration</a></p><p>6 重试（业务保护）： <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-retry-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-retry-gatewayfilter-factory</a></p><h3 id="统一日志"><a href="#统一日志" class="headerlink" title="统一日志"></a>统一日志</h3><p>统一的请求，响应信息记录</p><h3 id="统一文档"><a href="#统一文档" class="headerlink" title="统一文档"></a>统一文档</h3><p>将下游项目的文档进行聚合，在一个页面统一查看</p><p>建议用：<a target="_blank" rel="noopener" href="https://doc.xiaominfo.com/docs/middleware-sources/,aggregation-introduction">https://doc.xiaominfo.com/docs/middleware-sources/,aggregation-introduction</a></p><h3 id="网关的分类"><a href="#网关的分类" class="headerlink" title="网关的分类"></a>网关的分类</h3><ol><li><p>全局网关（接入层网关）：作用是负载均衡、请求日志，不和业务逻辑绑定</p></li><li><p>业务网关（微服务网关：会有一些业务逻辑）：作用是根据不同的请求转发到不同的项目接口</p><p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq21040559/article/,details/,122961395">https://blog.csdn.net/qq21040559/article/,details/,122961395</a></p></li></ol><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ol><li><p>Nginx（推荐的全局型网关）</p></li><li><p>Kong网关（适合API网关）–收费！！</p></li><li><p><code>Spring Cloud Gateway</code>（取代了Zuul，因为架构设计并不太好，并发量也有限）</p><blockquote><p>优点：用到了NIO、多路复用、底层Netty、React模型；</p><p>最大的亮点：可以用Java代码写逻辑，其他网关都需要学习一些其他语言（Nginx需要学到一些Lua脚本）</p></blockquote></li></ol><p>网关技术选型：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/500587132">https://zhuanlan.zhihu.com/p/500587132</a></p><h3 id="Spring-Cloud-Gateway用法"><a href="#Spring-Cloud-Gateway用法" class="headerlink" title="Spring Cloud Gateway用法"></a>Spring Cloud Gateway用法</h3><p>官网是最好的老是去看官网</p><p>去看官网：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a></p><p>官方文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference//html/">https://docs.spring.io/spring-cloud-gateway/docs/current/reference//html/</a></p><h3 id="创建一个Gateway项目"><a href="#创建一个Gateway项目" class="headerlink" title="创建一个Gateway项目"></a>创建一个Gateway项目</h3><p>小作业：完成官网的小demo（编程式demo）</p><h2 id="Day05-把API网关应用到项目中"><a href="#Day05-把API网关应用到项目中" class="headerlink" title="Day05 把API网关应用到项目中"></a>Day05 把API网关应用到项目中</h2><p>任务：</p><ol><li>完成统一的用户鉴权、统一的接口调用次数统计（API网关应用）</li><li>完善功能</li></ol><h3 id="将用到的特性"><a href="#将用到的特性" class="headerlink" title="将用到的特性"></a>将用到的特性</h3><ol><li><p>路由（转发请求到模拟接口项目）</p></li><li><p><del>负载均衡（需要用到注册中心）</del></p></li><li><p>统一鉴权(accessKey，secretKey)</p></li><li><p>统一处理跨域</p></li><li><p>统一业务处理（每次请求接口后，接口调用次数+1）</p></li><li><p>访问控制（黑白名单）</p></li><li><p><del>发布控制</del></p></li><li><p>流量染色(记录请求是否为网关来的)</p></li><li><p><del>统一接口保护</del></p><ol><li>限制请求</li><li>信息脱敏</li><li>降级（熔断）</li><li>限流 学习令牌桶算法，学习露桶算法，学习一下RedislimitHandler</li><li>超时时间</li><li>重试（业务保护）</li></ol></li><li><p>统一日志(记录每次的请求和响应)</p></li><li><p><del>统一文档</del></p></li></ol><h3 id="业务逻辑"><a href="#业务逻辑" class="headerlink" title="业务逻辑"></a>业务逻辑</h3><blockquote><p>为什么会用到API网关？</p><p>结合架构图来说，简单来说也就是加一个检票口，同时也可以添加流量染色、链路追踪的功能、灰度发布等等。。。</p></blockquote><ol><li>用户发送请求到API网关（请求转发）</li><li><em>请求日志</em></li><li><em>黑白名单</em></li><li>用户鉴权（如何？判断ak、sk）</li><li>请求的模拟接口是否存在？</li><li>请求转发，调用模拟接口</li><li>响应日志</li><li>调用成功，接口调用次数 + 1</li><li>调用失败，返回规范错误码</li></ol><h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><ol><li><p><strong>请求转发</strong></p><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-path-route-predicate-factory">使用前缀匹配断言</a></p><p>所有路径为：<code>/api/**</code> 的请求转发，转发到<a target="_blank" rel="noopener" href="http://localhost:8123/api/">http://localhost:8123/api/</a>**</p><p>比如：</p><p>请求于<a target="_blank" rel="noopener" href="http://localhost:8090/api/name/get?/name=wlei224">http://localhost:8090/api/name/get?/name=wlei224</a></p><p>转发到<a target="_blank" rel="noopener" href="http://localhost:8123/api/name/get?/name=wlei224">http://localhost:8123/api/name/get?/name=wlei224</a></p></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">path_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/red/&#123;segment&#125;,/blue/&#123;segment&#125;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>其他业务逻辑</li></ol><blockquote><p>​ todo：Spring注解 @component</p></blockquote><p>​ 使用Spring Cloud Gateway中的GlobalFilter实现请求拦截处理（类似于AOP）</p><p>​ <img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307251948339.png" alt="image-20230725194819206"></p><p>​ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-combined-global-filter-and-gatewayfilter-ordering">GlobalFilter</a>直接复制代码到网关项目的全局异常类中。</p><p>​ 验证通过√</p><ol start="2"><li>正式开始写业务逻辑</li></ol><blockquote><ol><li><p>用户发送请求到API网关（请求转发）√</p><p>代码能运行到这个controller业务逻辑层，就说明用户已经发送了请求</p></li><li><p><em>请求日志</em></p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307281159504.png" alt="image-20230728115938432"></p><p>我们发现请求参数中含有一个交换机，于是可以试着从这里找到request请求，拿到请求头中的信息；</p><p>添加<code>@Slf4j</code>注解，用log.info在控制台输出请求头日志；</p></li><li><p><em>黑白名单</em></p><p>在权限管理业务中一般设置的是白名单，这样只有允许的才可以进行访问，更加安全！</p><p>在IDEA中直接敲<code>prsf</code>写一个白名单常量。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 访问控制 -- 设置黑白名单（可以用设置响应状态码来实现）</span></span><br><span class="line"><span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line"><span class="keyword">if</span>(!IP_WHITE_LIST.contains(sourceAdress)) &#123;</span><br><span class="line">    <span class="comment">// handleNoAuth(response);</span></span><br><span class="line">    response.setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">	<span class="keyword">return</span> response.setComplete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>用户鉴权（如何？判断ak、sk）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  用户鉴权（如何？判断ak、sk）</span></span><br><span class="line"><span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> request.getHeaders();</span><br><span class="line"><span class="type">String</span> <span class="variable">accessKey</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;accessKey&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">nonce</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;nonce&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">timeStamp</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;timeStamp&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;sign&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;body&quot;</span>);</span><br><span class="line"><span class="comment">// TODO 要去数据库中查询</span></span><br><span class="line"><span class="comment">// 为了方便进行校验，直接进行判断数据，正规来说应该从数据库中进行校验数据</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="string">&quot;wl&quot;</span>.equals(accessKey))&#123;</span><br><span class="line">    <span class="comment">// throw new RuntimeException(&quot;无权限！&quot;);</span></span><br><span class="line">    <span class="comment">// 封装了一个方法，专门用于处理异常请求</span></span><br><span class="line">    <span class="keyword">return</span> handleNoAuth(response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (Long.parseLong(nonce) &gt; <span class="number">10000L</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> handleNoAuth(response);</span><br><span class="line">&#125;</span><br><span class="line">                                                                                                               </span><br><span class="line"><span class="comment">//  时间戳校验自己实现，时间和当前时间不能超过5min</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis() / <span class="number">1000</span>;</span><br><span class="line"><span class="type">Long</span> <span class="variable">FIVE_MINUTES</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">5L</span>;</span><br><span class="line"><span class="keyword">if</span> ((currentTime-Long.parseLong(timeStamp)) &gt;= FIVE_MINUTES) &#123;</span><br><span class="line">	<span class="keyword">return</span> handleNoAuth(response);</span><br><span class="line">&#125;</span><br><span class="line">                                                                                                               </span><br><span class="line"><span class="comment">// TODO 要去数据库中查询</span></span><br><span class="line"><span class="type">String</span> <span class="variable">serverSign</span> <span class="operator">=</span> SignUtils.getSign(body, <span class="string">&quot;abcdefgh&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!serverSign.equals(sign)) &#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无权限！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>请求的模拟接口是否存在？</p><p>// TODO 从数据库中进行查询接口是否存在，以及请求方法是否匹配（严格的话可以再校验一下请求参数，但是业务层面的请求参数不建议放到全局请求网关里面）<br>// 因为数据库的访问方法已经再backend中已经写过，操作较为复杂的话不建议重复写，所以我们可以采用远程调用的方式（也就是可以说是微服务，这个项目完全可以写成微服务：<code>OpenFeigh</code>，目前项目的定位还是<code>分布式项目</code>结合微服务的远程调用，避免重复写业务逻辑）</p></li><li><p>请求转发，调用模拟接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mono&lt;Void&gt; filter = chain.filter(exchange);</span><br></pre></td></tr></table></figure></li><li><p>响应日志</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log.info(<span class="string">&quot;响应：&quot;</span> + response.getStatusCode());</span><br></pre></td></tr></table></figure></li><li><p>调用成功，接口调用次数 + 1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO invokeCount</span></span><br></pre></td></tr></table></figure></li><li><p>调用失败，返回规范错误码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户鉴权异常</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handleNoAuth</span><span class="params">(ServerHttpResponse response)</span> &#123;</span><br><span class="line">        response.setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 自定义错误异常</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handleInvokeError</span><span class="params">(ServerHttpResponse response)</span> &#123;</span><br><span class="line">        response.setStatusCode(HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol></blockquote><ul><li>为了方便进行业务逻辑的编写，我们可以向上面一样，将提前编写好的业务流程粘贴到类文件中。</li></ul><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>通过测试我们发现，通过<a target="_blank" rel="noopener" href="http://127.0.0.1:8090/api/name/get?name=wl%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E6%97%B6%EF%BC%8C%E8%BF%98%E6%98%AF%E4%BC%9A%E9%81%AD%E5%88%B0%E6%8B%92%E7%BB%9D%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E5%91%A2%EF%BC%9F%E6%AD%A4%E6%97%B6%E4%B8%8D%E6%98%AF%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%B8%A2%E5%A4%B1%EF%BC%8C%E8%80%8C%E6%98%AF%E6%88%91%E4%BB%AC%E6%A0%B9%E6%9C%AC%E5%B0%B1%E6%B2%A1%E5%86%99%E8%AF%B7%E6%B1%82%E5%A4%B4%EF%BC%8C%E8%B7%91%E9%80%9A%E8%BF%99%E4%B8%AA%E9%80%BB%E8%BE%91%E7%9A%84%E8%AF%9D%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BB%8E%E5%89%8D%E7%AB%AF%E8%BF%9B%E8%A1%8C%E8%B0%83%E7%94%A8%E6%B5%8B%E8%AF%95%E3%80%82">http://127.0.0.1:8090/api/name/get?name=wl进行访问时，还是会遭到拒绝，为什么呢？此时不是请求头丢失，而是我们根本就没写请求头，跑通这个逻辑的话，可以从前端进行调用测试。</a></p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202308030251719.png" alt="image-20230803025109861"></p><h3 id="🧑‍💻业务逻辑预期结果："><a href="#🧑‍💻业务逻辑预期结果：" class="headerlink" title="🧑‍💻业务逻辑预期结果："></a>🧑‍💻业务逻辑预期结果：</h3><p>等模拟接口调用完成，才记录响应日志、统计调用次数。</p><h3 id="存在问题："><a href="#存在问题：" class="headerlink" title="存在问题："></a>存在问题：</h3><blockquote><p>虽然上述代码可以跑通，但是还存在一个问题，我们通过debug模式可以看到，代码在执行到请求转发的<code>Mono&lt;Void&gt; filter = chain.filter(exchange);</code>方法后，并没有进入到方法中，反而是继续执行下面的代码，直到<code>chain.filter</code>方法之后才进入模拟接口方法中。</p><p><code>原因：</code></p><p>chain.filter是个异步操作，可以理解为前端的promise</p><p><code>解决方案：</code></p><p>利用Spring Cloud Gateway提供的自定义响应装饰器中的response装饰者，以次增强原有response的处理能力</p><p>引申：什么叫装饰者设计模式？</p><p>​ 作用就是：在原本类的基础上对原有类的能力的增强，也就可以理解为给response买了一件装备，拥有了更多的能力。解释成代码语言意思就是，增写response部分代码，实现需要的功能。</p><p><code>参考博客：</code></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19636353/article/details/126759522">https://blog.csdn.net/qq_19636353/article/details/126759522</a> (以这个为主)</p><p><code>其他参考：</code></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_67595943/article/details/124667975">https://blog.csdn.net/m0_67595943/article/details/124667975</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43933728/article/details/121359727?spm=1001.2014.3001.5501">https://blog.csdn.net/weixin_43933728/article/details/121359727?spm=1001.2014.3001.5501</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zx156955/article/details/121670681">https://blog.csdn.net/zx156955/article/details/121670681</a> <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39529562/article/details/108911983">https://blog.csdn.net/qq_39529562/article/details/108911983</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handleResponse</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span>&#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        <span class="comment">//从交换寄拿响应对象  </span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">originalResponse</span> <span class="operator">=</span> exchange.getResponse();  </span><br><span class="line">        <span class="comment">//缓冲区工厂，拿到缓存数据  </span></span><br><span class="line">        <span class="type">DataBufferFactory</span> <span class="variable">bufferFactory</span> <span class="operator">=</span> originalResponse.bufferFactory();  </span><br><span class="line">        <span class="comment">//拿到响应码  </span></span><br><span class="line">        <span class="type">HttpStatus</span> <span class="variable">statusCode</span> <span class="operator">=</span> originalResponse.getStatusCode();  </span><br><span class="line">        <span class="keyword">if</span>(statusCode == HttpStatus.OK)&#123;  </span><br><span class="line">            <span class="comment">//装饰，增强能力  </span></span><br><span class="line">            <span class="type">ServerHttpResponseDecorator</span> <span class="variable">decoratedResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerHttpResponseDecorator</span>(originalResponse) &#123;  </span><br><span class="line">            <span class="comment">//等调用完转发的接口后才会执行</span></span><br><span class="line">                <span class="meta">@Override</span>  </span><br><span class="line">                <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">writeWith</span><span class="params">(Publisher&lt;? extends DataBuffer&gt; body)</span> &#123;  </span><br><span class="line">                    log.info(<span class="string">&quot;body instanceof Flux: &#123;&#125;&quot;</span>, (body <span class="keyword">instanceof</span> Flux));  </span><br><span class="line">                    <span class="comment">//对象是响应式的  </span></span><br><span class="line">                    <span class="keyword">if</span> (body <span class="keyword">instanceof</span> Flux) &#123;  </span><br><span class="line">                        <span class="comment">//我们拿到真正的body  </span></span><br><span class="line">                        Flux&lt;? <span class="keyword">extends</span> <span class="title class_">DataBuffer</span>&gt; fluxBody = Flux.from(body); </span><br><span class="line">                        <span class="comment">//往返回值里面写数据  </span></span><br><span class="line">                        <span class="comment">//拼接字符串  </span></span><br><span class="line">                        <span class="keyword">return</span> <span class="built_in">super</span>.writeWith(fluxBody.map(dataBuffer -&gt; &#123; </span><br><span class="line">                            <span class="comment">// 7. TODO 调用成功，接口调用次数 + 1 invokeCount</span></span><br><span class="line">                            <span class="type">byte</span>[] content = <span class="keyword">new</span> <span class="title class_">byte</span>[dataBuffer.readableByteCount()];  </span><br><span class="line">                            dataBuffer.read(content);  </span><br><span class="line">                            DataBufferUtils.release(dataBuffer);<span class="comment">//释放掉内存  </span></span><br><span class="line">                            <span class="comment">// 构建日志  </span></span><br><span class="line">                            <span class="type">StringBuilder</span> <span class="variable">sb2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">200</span>);  </span><br><span class="line">                            sb2.append(<span class="string">&quot;&lt;--- &#123;&#125; &#123;&#125; \n&quot;</span>);  </span><br><span class="line">                            List&lt;Object&gt; rspArgs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">                            rspArgs.add(originalResponse.getStatusCode());  </span><br><span class="line">                            <span class="comment">//rspArgs.add(requestUrl);  </span></span><br><span class="line">                            <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(content, StandardCharsets.UTF_8);<span class="comment">//data </span></span><br><span class="line">                            sb2.append(data);  </span><br><span class="line">                            log.info(sb2.toString(), rspArgs.toArray());<span class="comment">//log.info(&quot;&lt;-- &#123;&#125; &#123;&#125;\n&quot;, originalResponse.getStatusCode(), data);  </span></span><br><span class="line">                           <span class="keyword">return</span> bufferFactory.wrap(content);  </span><br><span class="line">                        &#125;));  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                        <span class="comment">// 8. 调用失败，fan&#x27;hui一个规范的</span></span><br><span class="line">                        log.error(<span class="string">&quot;&lt;--- &#123;&#125; 响应code异常&quot;</span>, getStatusCode());  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">super</span>.writeWith(body);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;;  </span><br><span class="line">            <span class="comment">//设置 response 对象为装饰过的  </span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange.mutate().response(decoratedResponse).build());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);<span class="comment">//降级处理返回数据  </span></span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        log.error(<span class="string">&quot;gateway log exception.\n&quot;</span> + e);  </span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Day06-完善网关的业务逻辑"><a href="#Day06-完善网关的业务逻辑" class="headerlink" title="Day06 完善网关的业务逻辑"></a>Day06 完善网关的业务逻辑</h2><h3 id="今日计划-1"><a href="#今日计划-1" class="headerlink" title="今日计划"></a>今日计划</h3><ol><li>补充完整网关的业务逻辑（如何操作数据库?如何服用之前写过的方法？RPC）</li><li>完善系统的TODO和其他功能，并开发一个管理员的监控统计功能</li></ol><h3 id="网关业务逻辑"><a href="#网关业务逻辑" class="headerlink" title="网关业务逻辑"></a>网关业务逻辑</h3><p>问题：之前的项目已经写过了调用数据库的那些mybatis的业务逻辑，复制粘贴太麻烦</p><p>解决：用一个可以直接调用的解决方法：RPC</p><h3 id="如何调用其他项目的方法"><a href="#如何调用其他项目的方法" class="headerlink" title="如何调用其他项目的方法"></a>如何调用其他项目的方法</h3><ol><li>复制粘贴代码和相关依赖</li><li>HTTP请求（提供接口，供其他项目进行调用）</li><li>jar包调用</li><li>把公共代码达成jar包，其他项目直接引用</li></ol><h3 id="HTTP请求怎么调用"><a href="#HTTP请求怎么调用" class="headerlink" title="HTTP请求怎么调用"></a>HTTP请求怎么调用</h3><ol><li>提供方开发一个接口（地址、请求方法、参数、返回值）</li><li>调用方使用<code>HTTP Client</code>之类的代码取发送HTTP请求</li></ol><h3 id="RPC（remote-produce-call）"><a href="#RPC（remote-produce-call）" class="headerlink" title="RPC（remote produce call）"></a>RPC（remote produce call）</h3><p><strong>作用：像调用本地方法一样去调用远程方法</strong></p><p>优点：</p><pre><code>1. 对开发者更加透明，减少了调用见的沟通成本
1. RPC向远程服务器发送请求时，未必要使用HTTP协议，比如：TCP/IP、或者自己封装的协议。（内部服务更加适用）
</code></pre><h3 id="Feign-amp-amp-RPC"><a href="#Feign-amp-amp-RPC" class="headerlink" title="Feign &amp;&amp; RPC"></a><code>Feign &amp;&amp; RPC</code></h3><blockquote><p>Feign底层用的HTTP协议，虽然也可以很方便的进行调用，但是区别在于Feign只是让请求过程更加精简,HTTP请求其实可以做到和RPC一样的事情，但是还有区别：RPC向远程服务器发送请求时，未必要使用HTTP协议，比如：TCP/IP、或者自己封装的协议。</p></blockquote><p>HTTP协议是一个7层协议，如果想要接口的性能更高，可以使用TCP/IP协议，更加原生的协议。</p><p>一般来说微服务项目内部的接口，用<code>RPC</code>的性能可能会更加高一点，协议可选项更加多一点。</p><p><code>工作流程图：</code></p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307292328515.png" alt="image-20230729232829504"></p><p>🆗，现在模型已经搭建好了，那么如何进行实现呢？使用Dubbo框架（如何学习？看官方文档）</p><h3 id="Dubbo框架（RPC实现）（阿里公司的）"><a href="#Dubbo框架（RPC实现）（阿里公司的）" class="headerlink" title="Dubbo框架（RPC实现）（阿里公司的）"></a>Dubbo框架（RPC实现）（阿里公司的）</h3><p>其它类似的框架还有<code>GRPC</code>（Google公司的）、<code>TRPC</code>（腾讯公司的）</p><p>最好的学习方式：<a target="_blank" rel="noopener" href="https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/quick-start/spring-boot/">阅读官方文档！</a></p><h3 id="两种使用方式"><a href="#两种使用方式" class="headerlink" title="两种使用方式"></a>两种使用方式</h3><ol><li><p>Spring Boot代码（注解+编程式）：写Java接口，服务提供者和消费者都去引用这个接口 偏程导</p></li><li><p>IDL(接口调用语言)：创建一个公共的接口定义文件，服务提供者和消费者读取这个文件。</p><p>优点：</p><ul><li><p>跨语言，所有的框架都认识</p></li><li><p>底层是Triple（自定义封装协议，优点见<a target="_blank" rel="noopener" href="https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/protocol/triple/">官文</a>）</p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307300038465.png" alt="image-20230730003800623"></p></li></ul></li></ol><h3 id="示例项目学习"><a href="#示例项目学习" class="headerlink" title="示例项目学习"></a>示例项目学习</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b master https://github.com/apache/dubbo-samples.git</span><br></pre></td></tr></table></figure><p>zookeeper注册中心：通过内嵌的方式运行，更方便</p><p>最先启动注册中心，先启动服务提供者，再启动服务消费者</p><h3 id="整合应用"><a href="#整合应用" class="headerlink" title="整合应用"></a>整合应用</h3><ol><li><p>服务提供者：backend</p><p>a. 实际情况应该是去数据库中查是否已分配给用户</p><p>b. 从数据库中查询模拟接口是否存在，以及请求方法是否匹配（还可以校验请求参数）</p><p>c. 调用成功，接口调用次数+1 invokeCount</p></li><li><p>gateway项日作为服务调用者，调用这3个方法</p></li></ol><blockquote><p>整合步骤：</p><ol><li><p>依赖引入 视频事件：<code>00:52</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">                                                                                                               </span><br></pre></td></tr></table></figure></li><li><p>将官方示例代码中的privider包粘到backend中</p></li></ol></blockquote><h2 id="Day07-完善网关业务与上线"><a href="#Day07-完善网关业务与上线" class="headerlink" title="Day07 完善网关业务与上线"></a>Day07 完善网关业务与上线</h2><h3 id="今日计划-2"><a href="#今日计划-2" class="headerlink" title="今日计划"></a>今日计划</h3><ol><li>完善网关的业务</li><li>开发管理员的分析功能</li><li>项目上线</li></ol><h3 id="整合nacos"><a href="#整合nacos" class="headerlink" title="整合nacos"></a>整合nacos</h3><blockquote><p>遇到一个<code>nocos</code>小BUG：</p><p>Dubbo整合nocos的时候，提供者与消费者的包名不一样，这时，提供者将接口的信息注册到nacos文档时，用到的是provider的包名路径，如果出现消费者的包名路径与提供者的包名不同的时候，这时消费者就会报错找不到提供者的Service服务，如图：</p><p><img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202307311932647.png" alt="image-20230731193204173"></p></blockquote><h3 id="重新梳理网关的业务逻辑"><a href="#重新梳理网关的业务逻辑" class="headerlink" title="重新梳理网关的业务逻辑"></a>重新梳理网关的业务逻辑</h3><ol><li><p>实际情况应该是去数据库中查是否已分配给用户</p><p>a 先根据 accessKey 判断用户是否存在，查到 secretKey<br>b 对比 secretKey 和用户传的加密后的 secretKey 是否一致</p></li><li><p>从数据库中查询模拟接口是否存在，以及请求方法是否匹配（还可以校验请求参数）</p></li><li><p>调用成功，接口调用次数+1 invokeCount</p></li></ol><h3 id="公共服务"><a href="#公共服务" class="headerlink" title="公共服务"></a>公共服务</h3><blockquote><p>目的是让方法、实体在多个项目中进行复用，避免重复编写</p></blockquote><ul><li><p>业务分析</p><ul><li><ol><li>数据库中是否已分配给用户密钥（accesskey、secretkey，返回用户信息，为空表示不存在）√</li><li>从数据库中查询模拟接口是否存在（请求路径、请求方法、请求参数，返回接口信息，为空表示不存在）</li><li>接口调用次数 + 1 <code>invokeCount</code>（ak、sk、请求接口路径）√</li></ol></li></ul></li></ul><ul><li><p>使用步骤：</p><ul><li><ol><li>新建干净的 maven 项目，只保留必要的公共依赖</li></ol></li><li><ol start="2"><li>抽取 service 和实体类</li></ol></li><li><ol start="3"><li>install 本地 maven 包</li></ol></li><li><ol start="4"><li><p>让服务提供者引入 common 包，测试是否正常运行（出现Bug，backend包中的实现类一直报错：</p><blockquote><p><code>&#39;getBaseMapper()&#39; in &#39;com.baomidou.mybatisplus.extension.service.impl.ServiceImpl&#39; clashes with &#39;getBaseMapper()&#39; in &#39;com.baomidou.mybatisplus.extension.service.IService&#39;; attempting to use incompatible return type</code></p><p>原因是<code>UserInterfaceInfoMapper</code>类中，忘记更改引入的实体类路径。</p><p>小技巧：<img src="https://cdn.jsdelivr.net/gh/wl2o2o/blogCdn/img/202308030513641.png" alt="image-20230803051309362"></p><p>可以通过这种方式快速实现外部提供的的接口。</p></blockquote></li></ol></li><li><ol start="5"><li>让服务消费者引入 common 包</li></ol></li></ul></li><li><p>业务流程</p><ul><li><ol><li>新建干净的 maven 项目，只保留必要的公共依赖</li></ol></li><li><ol start="2"><li>抽取 service 和实体类</li></ol></li><li><ol start="3"><li>install 本地 maven 包</li></ol></li><li><ol start="4"><li>让服务提供者引入 common 包，测试是否正常运行，加上@DubboService，以便供其它类使用</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mybatisplus真好用！业务crud手到擒来！</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> WLei224</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023/8/3 5:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InnerInterfaceInfoServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">InnerInterfaceInfoService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> InterfaceInfoMapper interfaceInfoMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> InterfaceInfo <span class="title function_">getInterfaceInfo</span><span class="params">(String url, String method)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(url,method))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        QueryWrapper&lt;InterfaceInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;url&quot;</span>,url);</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;method&quot;</span>,method);</span><br><span class="line">        <span class="keyword">return</span> interfaceInfoMapper.selectOne(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><ol start="5"><li>让服务消费者引入 common 包</li></ol><blockquote><ol><li><p>API网关项目中引入 common 依赖</p></li><li><p>使用服务提供者提供的服务（@DubboService和@DubboReference）</p><p>通过@DubboReference注入公共模块中编写好的三个服务</p></li><li><p>完善网关中的todo标签，完善业务逻辑</p></li></ol></blockquote></li></ul><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>​ 项目调试中存在一个问题：需要手动对接口的调用次数进行分配，这里考虑可以增加一个管理调用次数的接口。</p></li></ul><h3 id="统计分析功能"><a href="#统计分析功能" class="headerlink" title="统计分析功能"></a>统计分析功能</h3><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><p>各个接口的总调用次数的占比图（饼图），取调用次数最多的三个接口，从而进行分析出哪个接口还没有人进行调用，进而对其降低资源或者下线，高频接口（增加资源、提高收费）</p><h4 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a>实现</h4><ul><li><p><strong>前端</strong></p><ul><li><p>强烈推荐使用现成的库</p><ul><li><p>Echarts：<a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/index.html%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89">https://echarts.apache.org/zh/index.html（推荐）</a></p></li><li><p>AntV：<a target="_blank" rel="noopener" href="https://antv.vision/zh%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89">https://antv.vision/zh（推荐）</a></p></li><li><p>BizCharts</p></li><li><p>如果是 React 项目，用这个库：<a target="_blank" rel="noopener" href="https://github.com/hustcc/echarts-for-react">https://github.com/hustcc/echarts-for-react</a></p></li><li><blockquote><p>怎么用？</p><ol><li>看官网</li><li>找到快速入门、按文档去引入库</li><li>进入示例页面</li><li>找到你要的图</li><li>在线调试</li><li>复制代码</li><li>改为真实数据</li></ol></blockquote></li></ul></li></ul></li><li><p><strong>后端</strong></p><ul><li><p>写一个接口，得到下列示例数据：<br>接口 A：2次<br>接口 B：3次</p></li><li><p>步骤：</p><ol><li><p>SQL 查询调用数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> interfaceInfoId, <span class="built_in">sum</span>(totalNum) <span class="keyword">as</span> totalNum <span class="keyword">from</span> user_interface_info <span class="keyword">group</span> <span class="keyword">by</span> interfaceInfoId <span class="keyword">order</span> <span class="keyword">by</span> totalNum <span class="keyword">desc</span> limit <span class="number">3</span>;</span><br></pre></td></tr></table></figure></li><li><p>业务层去关联查询接口信息。</p><p><code>controller</code>:（就不写Service了，直接写业务逻辑）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分析控制器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yupi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/analysis&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnalysisController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserInterfaceInfoMapper userInterfaceInfoMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> InterfaceInfoService interfaceInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/top/interface/invoke&quot;)</span></span><br><span class="line">    <span class="meta">@AuthCheck(mustRole = &quot;admin&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BaseResponse&lt;List&lt;InterfaceInfoVO&gt;&gt; <span class="title function_">listTopInvokeInterfaceInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;UserInterfaceInfo&gt; userInterfaceInfoList = userInterfaceInfoMapper.listTopInvokeInterfaceInfo(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;Long, List&lt;UserInterfaceInfo&gt;&gt; interfaceInfoIdObjMap = userInterfaceInfoList.stream()</span><br><span class="line">                .collect(Collectors.groupingBy(UserInterfaceInfo::getInterfaceInfoId));</span><br><span class="line"></span><br><span class="line">        QueryWrapper&lt;InterfaceInfo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.in(<span class="string">&quot;id&quot;</span>, interfaceInfoIdObjMap.keySet());</span><br><span class="line">        List&lt;InterfaceInfo&gt; list = interfaceInfoService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(list)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.SYSTEM_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;InterfaceInfoVO&gt; interfaceInfoVOList = list.stream().map(interfaceInfo -&gt; &#123;</span><br><span class="line">            <span class="type">InterfaceInfoVO</span> <span class="variable">interfaceInfoVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InterfaceInfoVO</span>();</span><br><span class="line">            BeanUtils.copyProperties(interfaceInfo, interfaceInfoVO);</span><br><span class="line">            <span class="type">int</span> <span class="variable">totalNum</span> <span class="operator">=</span> interfaceInfoIdObjMap.get(interfaceInfo.getId()).get(<span class="number">0</span>).getTotalNum();</span><br><span class="line">            interfaceInfoVO.setTotalNum(totalNum);</span><br><span class="line">            <span class="keyword">return</span> interfaceInfoVO;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> ResultUtils.success(interfaceInfoVOList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>封装类</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口信息封装视图</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@TableName</span> product</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterfaceInfoVO</span> <span class="keyword">extends</span> <span class="title class_">InterfaceInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 调用次数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalNum;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>UserInterfaceInfoMapper</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Entity</span> com.wl.smartapicommon.model.entity.UserInterfaceInfo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserInterfaceInfoMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;UserInterfaceInfo&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取前几个调用次数最多的接口</span></span><br><span class="line">    List&lt;UserInterfaceInfo&gt; <span class="title function_">listTopInvokeInterfaceInfo</span><span class="params">(<span class="type">int</span> limit)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>xml中添加sql语句</code>：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listTopInvokeInterfaceInfo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wl.smartapicommon.model.entity.UserInterfaceInfo&quot;</span>&gt;</span></span><br><span class="line">    select interfaceInfoId, sum(totalNum) as totalNum</span><br><span class="line">    from user_interface_info</span><br><span class="line">    group by interfaceInfoId</span><br><span class="line">    order by totalNum</span><br><span class="line">    desc limit #&#123;limit&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol></li></ul></li></ul><h2 id="上线计划"><a href="#上线计划" class="headerlink" title="上线计划"></a>上线计划</h2><ul><li>前端：参考之前用户中心或伙伴匹配系统的上线方式</li><li>后端：<ul><li>backend 项目：web 项目，部署 spring boot 的 jar 包（对外的）</li><li>gateway 网关项目：web 项目，部署 spring boot 的 jar 包（对外的）</li><li>interface 模拟接口项目：web 项目，部署 spring boot 的 jar 包（不建议对外暴露的）</li></ul></li></ul><p><em><strong>关键：网络必须要连通</strong></em></p><blockquote><p>如果自己学习用：单个服务器部署这三个项目就足够。<br>如果你是搞大事，多个服务器建议在 同一内网 ，内网交互会更快、且更安全。</p></blockquote><h4 id="上线环境准备"><a href="#上线环境准备" class="headerlink" title="上线环境准备"></a>上线环境准备</h4><ol><li><p>docker安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class="line">systemctl start docker </span><br><span class="line">systemctl enable docker</span><br><span class="line">systenctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>宝塔面板</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装命令</span></span><br><span class="line">yum install -y wget &amp;&amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh &amp;&amp; sh install.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载命令</span></span><br><span class="line">systemct stop bt</span><br><span class="line">rm -rf /www/server/panel</span><br><span class="line">rm -f /etc/init.d/bt</span><br><span class="line"></span><br><span class="line">rm -rf /root/.pyenv/versions/3.7.0/envs/btpanel/lib/python3.7/site-packages/pycache</span><br><span class="line">rm -rf /root/.pyenv/versions/3.7.0/envs/btpanel/lib/python3.7/site-packages/btpanel/__pycache__</span><br><span class="line">rm -rf /root/.pyenv/versions/3.7.0/envs/btpanel/lib/python3.7/site-packages/panelApp/__pycache__</span><br><span class="line"></span><br><span class="line">rm -rf /www/server/panel/logs/*</span><br></pre></td></tr></table></figure></li><li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010148813/article/details/126172372">Docker 安装 Nginx</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取官方的最新版本的镜像</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker pull nginx</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用以下命令来运行 nginx 容器</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run --name nginx -p 80:80 -d nginx</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在宿主机家目录创建用于放配置文件的文件夹</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> -p /root/docker-nginx/&#123;conf,html,logs&#125;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从容器nginx中复制nginx.conf文件到宿主机</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">cp</span> nginx:/etc/nginx/nginx.conf /root/docker-nginx</span>       </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">cp</span> nginx:/etc/nginx/conf.d/default.conf /root/docker-nginx/conf/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">cp</span> nginx:/usr/share/nginx/html/ /root/docker-nginx/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------------------</span><br><span class="line">说明：</span><br><span class="line">宿主机：就是你的云服务器或者虚拟机。</span><br><span class="line">~ 目录，也就是我们常说的家目录/home/your_username.(如果是云服务器，且没有创建普通用户，那么家目录就是 /root 了，也就是我们说的管理员用户，拥有最高权限，所以命令就不用加上 sudo 了)</span><br><span class="line"></span><br><span class="line">刚才的操作是把你在docker中拉取的 Nginx 的镜像配置文件复制了一份到家目录，这样可以便于后续对 nginx 的配置，say Why?，因为我们接下来会通过映射，将我们复制到宿主机的配置文件直接映射到 docker 容器中的 Nginx 中，是不是很方便，下次若需要配置，就可以直接在宿主机中进行配置了，否则还需要通过 `$ docker exec -it nginx bash` 命令进入到 Nginx 的镜像之中。</span><br></pre></td></tr></table></figure><ul><li>打包一下复制好的配置文件（备份，以免操作失误可补救）</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删掉 nginx 容器</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stop nginx</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">rm</span> nginx</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新运行容器，并加上配置文件的映射</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -p 80:80 \</span></span><br><span class="line"><span class="language-bash">-v /root/docker-nginx/nginx.conf:/etc/nginx/nginx.conf \</span></span><br><span class="line"><span class="language-bash">-v /root/docker-nginx/logs:/var/log/nginx \</span></span><br><span class="line"><span class="language-bash">-v /root/docker-nginx/html:/usr/share/nginx/html \</span></span><br><span class="line"><span class="language-bash">-v /root/docker-nginx/conf:/etc/nginx/conf.d \</span></span><br><span class="line"><span class="language-bash">--name nginx \</span></span><br><span class="line"><span class="language-bash">--privileged=<span class="literal">true</span> \</span></span><br><span class="line"><span class="language-bash">--restart=always \</span></span><br><span class="line"><span class="language-bash">-d nginx</span></span><br><span class="line"></span><br><span class="line">----------------------------------------------</span><br><span class="line">终于完成！如遇到403或者无法访问此网站等其他问题，首先去你购买的云服务器的安全组新增 80 端口，如果你开了代理，试着重启或者注销电脑。</span><br><span class="line">参考链接：https://blog.csdn.net/l123lgx/article/details/122619851</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log logs/host.access.log main;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">    #error_page 404 /404.html;</span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">    	root html;</span><br><span class="line">    &#125;</span><br><span class="line">    # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    # proxy_pass http://127.0.0.1;</span><br><span class="line">    #&#125;</span><br><span class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    # root html;</span><br><span class="line">    # fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">    # fastcgi_index index.php;</span><br><span class="line">    # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;</span><br><span class="line">    # include fastcgi_params;</span><br><span class="line">    #&#125;</span><br><span class="line">    # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">    # concurs with nginx&#x27;s one</span><br><span class="line">    #</span><br><span class="line">    #location ~ /\.ht &#123;</span><br><span class="line">    # deny all;</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    # listen 8000;</span><br><span class="line">    # listen somename:8080;</span><br><span class="line">    # server_name somename alias another.alias;</span><br><span class="line">    # location / &#123;</span><br><span class="line">    # root html;</span><br><span class="line">    # index index.html index.htm;</span><br><span class="line">    # &#125;</span><br><span class="line">    #&#125;</span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    # listen 443 ssl;</span><br><span class="line">    # server_name localhost;</span><br><span class="line">    # ssl_certificate cert.pem;</span><br><span class="line">    # ssl_certificate_key cert.key;</span><br><span class="line">    # ssl_session_cache shared:SSL:1m;</span><br><span class="line">    # ssl_session_timeout 5m;</span><br><span class="line">    # ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">    # ssl_prefer_server_ciphers on;</span><br><span class="line">    # location / &#123;</span><br><span class="line">    # root html;</span><br><span class="line">    # index index.html index.htm;</span><br><span class="line">    # &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>复习一下<code>tar</code>命令的用法：</p><img src="https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202308260050797.png" alt="image-20230826005051120" style="zoom:50%"><p>解压的话亦是同理：</p><blockquote><p>解压 tar 存档文件的常用命令是 <code>tar -xzvf</code>。下面是对这些参数的解释：</p><ul><li><code>-x</code>：表示从存档文件中提取（解压）文件。</li><li><code>-z</code>：表示使用 gzip 压缩算法进行解压缩。使用此参数可以解压被 gzip 压缩的 tar 存档文件。</li><li><code>-v</code>：表示在命令执行过程中显示详细信息，即显示提取的文件列表。</li><li><code>-f</code>：指定要提取的存档文件的名称。紧跟在 <code>-f</code> 参数后面的是存档文件的名称。</li></ul></blockquote><ol start="4"><li><p><code>docker</code>安装<code>MySQL</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在宿主机家目录创建用于放配置文件的文件夹</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> -p /root/docker-mysql/&#123;conf,data,<span class="built_in">log</span>&#125;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在配置文件目录:/root/docker-mysql/conf新建一个my.cnf配置文件，写入下面内容，设置客户端和mysql服务器端编码都为utf8</span></span><br><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server=utf8_general_ci</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line">docker run -p 3306:3306 \</span><br><span class="line">--privileged=true \</span><br><span class="line">-v /root/docker-mysql/log:/var/log/mysql \</span><br><span class="line">-v /root/docker-mysql/data:/var/lib/mysql \</span><br><span class="line">-v /root/docker-mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=你的MySQL密码 \</span><br><span class="line">--name mysql \</span><br><span class="line">-d mysql</span><br><span class="line"></span><br><span class="line">docker exec -it mysql bash</span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">如果遇到`Navicat`连接不上的问题，请看下面的链接。</span><br></pre></td></tr></table></figure><p>记录一个大坑，宝塔面板添加3306端口号，被腾讯云服务器拦截了，无语了，还是通过云服务器控制台（推荐✨）或者防火墙命令来添加端口吧。</p><p>参考链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/--eric/p/17145834.html">https://www.cnblogs.com/--eric/p/17145834.html</a></p></li></ol><ol start="5"><li><p><code>JDK</code>安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum 安装免环境变量的配置</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">yum install -y java-1.8.0-openjdk*</span></span><br></pre></td></tr></table></figure></li><li><p><code>maven</code>安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">通过以下命令获取安装包或者通过本地浏览器下载到主机，然后通过 ftp 传输到 Linux 服务器</span><br><span class="line">curl -O https://dlcdn.apache.org/maven/maven-3/3.8.8/binaries/apache-maven-3.8.8-bin.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf apache-maven-3.8.8-bin.tar.gz</span><br><span class="line"></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">文件空白处增加两行内容：</span><br><span class="line">export MAVEN_HOME=/root/services/apache-maven-3.8.8</span><br><span class="line">export PATH=$MAVEN_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">mvn --version</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>redis</code>安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br><span class="line"></span><br><span class="line">mkdir -p /root/docker-redis/conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">入redis配置文件夹</span></span><br><span class="line">cd /root/docker-redis/conf  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载redis配置文件</span></span><br><span class="line">wget http://download.redis.io/redis-stable/redis.conf   </span><br><span class="line"></span><br><span class="line">vim redis.conf  // 修改配置文件</span><br><span class="line">1. appendonly yes    启动Redis持久化功能 (默认 no , 所有信息都存储在内存 [重启丢失] 。设置为 yes , 将存储在硬盘 [重启还在])</span><br><span class="line">2. protected-mode no    关闭protected-mode模式，此时外部网络可以直接访问</span><br><span class="line">3. bind 0.0.0.0    设置所有IP都可以访问</span><br><span class="line">4. requirepass 密码    设置密码</span><br><span class="line">如果你设置了密码,需要通过如下命令进入Redis控制台</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 进入Redis容器</span></span></span><br><span class="line">        docker exec -it redis bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 通过密码进入Redis控制台</span></span></span><br><span class="line">        redis-cli -h 127.0.0.1 -p 6379 -a [你的密码]</span><br><span class="line">        </span><br><span class="line">mkdir -p /root/docker-redis/data</span><br><span class="line"></span><br><span class="line">docker run -p 6379:6379 \</span><br><span class="line">-v /root/docker-redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-v /root/docker-redis/data:/data \</span><br><span class="line">-e REDIS_ROOT_PASSWORD=你的Redis密码 \</span><br><span class="line">--restart=always \</span><br><span class="line">--name redis \</span><br><span class="line">-d redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">不要忘记打开防火墙6379端口，通过宝塔面板或者命令，或者云服务器控制台</span><br></pre></td></tr></table></figure></li><li><p><code>nacos</code>安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">docker pull nacos/nacos-server</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在宿主机家目录创建用于放配置文件的文件夹</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> -p /root/docker-nacos/nacos/&#123;init.d,logs&#125;</span></span><br><span class="line"></span><br><span class="line">vim /root/docker-nacos/nacos/init.d/application.properties </span><br><span class="line"></span><br><span class="line">server.contextPath=/nacos</span><br><span class="line">server.servlet.contextPath=/nacos</span><br><span class="line">server.port=8848</span><br><span class="line"> </span><br><span class="line">spring.datasource.platform=mysql</span><br><span class="line">db.num=1</span><br><span class="line">db.url.0=jdbc:mysql://xx.xx.xx.x:3306/nacos_devtest_prod?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span><br><span class="line">db.user=user</span><br><span class="line">db.password=pass</span><br><span class="line"> </span><br><span class="line">nacos.cmdb.dumpTaskInterval=3600</span><br><span class="line">nacos.cmdb.eventTaskInterval=10</span><br><span class="line">nacos.cmdb.labelTaskInterval=300</span><br><span class="line">nacos.cmdb.loadDataAtStart=false</span><br><span class="line">management.metrics.export.elastic.enabled=false</span><br><span class="line">management.metrics.export.influx.enabled=false</span><br><span class="line">server.tomcat.accesslog.enabled=true</span><br><span class="line">server.tomcat.accesslog.pattern=%h %l %u %t &quot;%r&quot; %s %b %D %&#123;User-Agent&#125;i</span><br><span class="line">nacos.security.ignore.urls=/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/v1/auth/login,/v1/console/health/**,/v1/cs/**,/v1/ns/**,/v1/cmdb/**,/actuator/**,/v1/console/server/**</span><br><span class="line">nacos.naming.distro.taskDispatchThreadCount=1</span><br><span class="line">nacos.naming.distro.taskDispatchPeriod=200</span><br><span class="line">nacos.naming.distro.batchSyncKeyCount=1000</span><br><span class="line">nacos.naming.distro.initDataRatio=0.9</span><br><span class="line">nacos.naming.distro.syncRetryDelay=5000</span><br><span class="line">nacos.naming.data.warmup=true</span><br><span class="line">nacos.naming.expireInstance=true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -p 8848:8848 \</span><br><span class="line">-e JVM_XMS=256m \</span><br><span class="line">-e JVM_XMX=256m \</span><br><span class="line">-e MODE=standalone \</span><br><span class="line">-e PREFER_HOST_MODE=hostname \</span><br><span class="line">-v /root/docker-nacos/nacos/logs:/home/nacos/logs \</span><br><span class="line">-v /root/docker-nacos/nacos/init.d/application.properties:/home/nacos/init.d/application.properties \</span><br><span class="line">--name nacos \</span><br><span class="line">--privileged=true \</span><br><span class="line">--restart=always \</span><br><span class="line">-d nacos/nacos-server</span><br></pre></td></tr></table></figure><p>参考链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/yexiaomodemo/article/details/123355202">https://blog.csdn.net/yexiaomodemo/article/details/123355202</a></p></li><li><p><code>rabbitmq</code>安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq</span><br><span class="line"></span><br><span class="line">docker run -p 5672:5672 -p 15672:15672 \</span><br><span class="line">-v /root/docker-rabbitmq/config/:/etc/rabbitmq/ \</span><br><span class="line">-e RABBITMQ_DEFAULT_USER=admin \</span><br><span class="line">-e RABBITMQ_DEFAULT_PASS=admin \</span><br><span class="line">--hostname myRabbit \</span><br><span class="line">--name rabbitmq \</span><br><span class="line">--restart=always \</span><br><span class="line">-d rabbitmq</span><br><span class="line"></span><br><span class="line">docker exec -it rabbitmq bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动可视化插件</span></span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br><span class="line"></span><br><span class="line">使用浏览器打开web管理端：http://Server-IP:15672 </span><br></pre></td></tr></table></figure></li></ol><p>参考链接：</p></li></ol><p>​ <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42977003/article/details/128107521">https://blog.csdn.net/qq_42977003/article/details/128107521</a><br>​ <a target="_blank" rel="noopener" href="https://blog.csdn.net/feritylamb/article/details/128434465">https://blog.csdn.net/feritylamb/article/details/128434465</a></p><h4 id="一、原始部署"><a href="#一、原始部署" class="headerlink" title="一、原始部署"></a>一、原始部署</h4><p>​ 缺点：需要一个个配置环境，安装必须软件</p><h4 id="二、宝塔面板部署"><a href="#二、宝塔面板部署" class="headerlink" title="二、宝塔面板部署"></a>二、宝塔面板部署</h4><p>​ 优点：可视化安装与配置</p><h4 id="三、docker部署"><a href="#三、docker部署" class="headerlink" title="三、docker部署"></a>三、docker部署</h4><blockquote><p>Docker是一种开源的容器化平台，用于构建、发布和运行应用程序。通过使用Docker，您可以将应用程序及其依赖项打包到一个称为容器的独立单元中，以便在任何环境中运行，而无需担心环境差异或依赖问题。</p><p>以下是一些与Docker相关的常用概念和命令：</p><ol><li>镜像（Image）：镜像是Docker容器的基础，它包含了运行应用程序所需的一切，包括代码、运行时环境、库和依赖项。您可以通过构建自定义镜像或从Docker Hub等镜像仓库中获取现有的镜像。</li><li>容器（Container）：容器是基于镜像创建的运行实例，它是一个独立、隔离的执行环境。容器可以启动、停止、重启和删除，每个容器都具有自己的文件系统、进程空间和网络接口。</li><li>Dockerfile：Dockerfile是用于定义镜像构建过程的文本文件。它包含一系列指令，用于指定基础镜像、安装软件、复制文件、设置环境变量等。</li><li>Docker Compose：Docker Compose是一个用于定义和运行多个容器应用的工具。它使用一个YAML文件来定义各个服务及其依赖关系，并可以一键启动、停止和管理整个应用程序的容器群。</li></ol><p>一些常用的Docker命令包括：</p><ul><li><code>docker build</code>：根据Dockerfile构建镜像。</li><li><code>docker run</code>：创建并运行一个新的容器。</li><li><code>docker stop</code>：停止一个正在运行的容器。</li><li><code>docker start</code>：启动已经停止的容器。</li><li><code>docker rm</code>：删除一个或多个容器。</li><li><code>docker images</code>：列出本地已下载的镜像。</li><li><code>docker pull</code>：从镜像仓库下载镜像。</li><li><code>docker push</code>：将本地镜像推送到镜像仓库。</li></ul><p>这只是Docker的一小部分功能和命令，Docker还提供了许多其他功能，如网络配置、数据卷、容器编排等。如果您想更深入了解Docker的使用，请参考官方文档或相关教程。</p><p>docker如何打包一个镜像，命令是什么?</p><p>要打包一个Docker镜像，您需要编写一个Dockerfile，其中包含构建镜像所需的指令和配置。然后，使用<code>docker build</code>命令来构建镜像。以下是基本的步骤和相应的命令：</p><ol><li><p>创建一个Dockerfile：在您的项目目录中创建一个名为<code>Dockerfile</code>的文本文件，可以使用任何文本编辑器打开并编辑它。</p></li><li><p>在Dockerfile中定义镜像构建过程：Dockerfile包含一系列指令，用于指定基础镜像、安装软件、复制文件、设置环境变量等。根据您的应用程序需求，编写适当的指令。</p><p>以下是一个简单的Dockerfile示例：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用官方的 Node.js 作为基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制应用程序代码到容器中</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装应用程序依赖</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露应用程序的端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义启动容器时运行的命令</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;start&quot;</span>]</span></span><br><span class="line"></span><br><span class="line">这个示例中，我们使用了官方的Node.js <span class="number">14</span>镜像作为基础镜像，将应用程序代码复制到容器中，安装依赖项，暴露端口<span class="number">3000</span>，并在容器启动时运行`npm start`命令。</span><br></pre></td></tr></table></figure></li><li><p>构建镜像：在终端中，切换到包含Dockerfile的目录，并运行以下命令来构建镜像：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t image_name:tag .</span><br></pre></td></tr></table></figure><ul><li><code>-t</code>参数用于指定镜像的名称和标签。您可以根据需要自定义名称和标签。</li><li><code>.</code>表示Dockerfile所在的当前目录。确保在运行命令之前，您已经切换到正确的目录。</li></ul><p>例如，要构建一个名为<code>myapp</code>的镜像，标签为<code>v1.0</code>，可以运行以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t myapp:v1.0 .</span><br></pre></td></tr></table></figure></li><li><p>等待构建完成：Docker将执行Dockerfile中的每个指令，并构建镜像。这可能需要一些时间，取决于您的镜像大小和复杂性。</p></li><li><p>查看构建的镜像：构建完成后，可以使用以下命令查看本地的镜像列表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>您将看到刚刚构建的镜像以及其名称、标签和大小等信息。</p></li></ol><p>通过以上步骤，您就可以使用Dockerfile和<code>docker build</code>命令来打包构建自己的Docker镜像。请根据您的应用程序需求和环境配置适当地编辑Dockerfile。</p></blockquote><h5 id="前端部署例子："><a href="#前端部署例子：" class="headerlink" title="前端部署例子："></a>前端部署例子：</h5><p><code>dockerfile</code>文件：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /usr/share/nginx/html/</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./docker/nginx.conf /etc/nginx/conf.d/default.conf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./dist  /usr/share/nginx/html/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><code>nginx.conf</code>文件：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># gzip config</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">9</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span> text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_disable</span> <span class="string">&quot;MSIE [1-6]\.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">    <span class="attribute">include</span> /etc/nginx/mime.types;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="项目扩展思路"><a href="#项目扩展思路" class="headerlink" title="项目扩展思路"></a>项目扩展思路</h3><ol><li><p>用户自己可以申请更换签名</p></li><li><p>怎么让其他用户也能上传接口？</p><blockquote><ul><li>需要提供一个机制（一个页面），让用户来输入自己的接口host（都武器的地址）、接口信息、将接口写入数据库；</li><li>可以在interfaceInfo表中加个host字段，以次区分服务器地址，让接口提供者更灵活的接入系统；</li><li>将接口信息入库前，要对接口进行校验，比如检查地址是否遵循规则、是否可以正常调用,并遵循甲方要求（使用SDK）</li></ul></blockquote></li><li><p>网关校验是否还有调用次数</p><p>需要考虑并发的问题，防止瞬间调用超频。</p></li><li><p>网关优化</p><p>比如增加限流、降级保护、提高性能等。还可以考虑搭配Nginx网关使用。</p></li><li><p>功能增强</p><p>可以针对不同的请求头或者接口类型来设计前端界面和表单，百年与用户进行调用，增强体验。</p><p>（可以参考swagger、postman、kniffj的界面）</p></li></ol><h2 id="项目优化"><a href="#项目优化" class="headerlink" title="项目优化"></a>项目优化</h2><h3 id="扩展思路"><a href="#扩展思路" class="headerlink" title="扩展思路"></a>扩展思路</h3><ol><li>用户可以申请更换签名</li><li>怎么让其他用户也上传接口？<br>需要提供一个机制（界面），让用户输入自己的接口 host（服务器地址）、接口信息，将接口信息写入数据库。<br>可以在 interfaceInfo 表里加个 host 字段，区分服务器地址，让接口提供者更灵活地接入系统。<br>将接口信息写入数据库之前，要对接口进行校验（比如检查他的地址是否遵循规则，测试调用），保证他是正常的。<br>将接口信息写入数据库之前遵循咱们的要求（并且使用咱们的 sdk），<br>在接入时，平台需要测试调用这个接口，保证他是正常的。</li><li>网关校验是否还有调用次数<br>需要考虑并发问题，防止瞬间调用超额。</li><li>网关优化<br>比如增加限流 / 降级保护，提高性能等。还可以考虑搭配 Nginx 网关使用。</li><li>功能增强<br>可以针对不同的请求头或者接口类型来设计前端界面和表单，便于用户调用，获得更好的体验。<br>可以参考 swagger、postman、knife4j 的页面。</li></ol></article><div class="mt-12 pt-6 border-t border-gray-200"><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/Spring-Boot/">Spring Boot</a> </span><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/Ant-Design-Pro/">Ant Design Pro</a> </span><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/React/">React</a> </span><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/Ant-Design-Pro-Components/">Ant Design Pro Components</a> </span><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/Umi/">Umi</a> </span><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/Umi-Request/">Umi Request</a> </span><span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 m-1 text-sm rounded-md transition-colors hover:bg-gray-200"><a href="/tags/SDK%E5%BC%80%E5%8F%91/">SDK开发</a></span></div><div class="flex justify-between mt-12 pt-6 border-t border-gray-200"><div><a href="/posts/ac44d0e1.html" class="text-sm text-gray-400 hover:text-gray-500 flex justify-center"><iconify-icon width="20" icon="ri:arrow-left-s-line" data-inline="false"></iconify-icon>项目如何从〇到一</a></div><div><a href="/posts/d2bdaa5b.html" class="text-sm text-gray-400 hover:text-gray-500 flex justify-center">001-JZoffer<iconify-icon width="20" icon="ri:arrow-right-s-line" data-inline="false"></iconify-icon></a></div></div><div class="article-comments mt-12"><div class="giscus-container mt-8 pt-8 border-t border-gray-200 dark:border-gray-700"><script src="https://giscus.app/client.js" data-repo="WL2O2O/CS_GUIDER_Giscus" data-repo-id="R_kgDOJYdTQw" data-category="Announcements" data-category-id="DIC_kwDOJYdTQ84CWKC6" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async></script></div><script>function updateGiscusTheme(){const e=document.querySelector("iframe.giscus-frame");if(e){const s=document.documentElement.classList.contains("dark");e.contentWindow.postMessage({giscus:{setConfig:{theme:s?"dark":"light"}}},"https://giscus.app")}}window.addEventListener("message",e=>{"https://giscus.app"===e.origin&&e.data.giscus&&e.data.giscus.resizeHeight&&updateGiscusTheme()});const observer=new MutationObserver(()=>{updateGiscusTheme()});observer.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})</script></div></section><script src="/lib/clipboard.min.js"></script><script async src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
  });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });</script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>$(document).ready(()=>{mermaid.initialize({theme:"default",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})})</script><script src="/lib/fancybox/fancybox.umd.min.js"></script><script>$(document).ready(()=>{$(".post-content").each((function(a){$(this).find("img").each((function(){if(!$(this).parent().hasClass("fancybox")&&!$(this).parent().is("a")){var a=this.alt;a&&$(this).after('<span class="fancybox-alt">'+a+"</span>"),$(this).wrap('<a class="fancybox-img" href="'+this.src+'" data-fancybox="gallery" data-caption="'+a+'"></a>')}})),$(this).find(".fancybox").each((function(){$(this).attr("rel","article"+a)}))})),Fancybox.bind('[data-fancybox="gallery"]',{})})</script><script src="/lib/tocbot/tocbot.min.js"></script><script>$(document).ready(()=>{tocbot.init({tocSelector:".post-toc",contentSelector:".post-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0})})</script></main><footer class="flex flex-col h-40 items-center justify-center text-gray-400 text-sm"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="flex items-center gap-2"><span>Visitors</span> <span id="busuanzi_value_site_uv"></span> <span>Page Views</span> <span id="busuanzi_value_site_pv"></span></div><div class="flex items-center gap-2"><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color:inherit">CC BY-NC-SA 4.0</a> <span>© 2025</span><iconify-icon width="18" icon="emojione-monotone:desktop-computer"></iconify-icon><a href="https://github.com/wl2o2o" target="_blank" rel="noopener noreferrer">CS_GUIDER</a></div><div class="flex items-center gap-2"><span>Powered by</span> <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a> <span>&</span> <a href="https://github.com/wl2o2o" target="_blank" rel="noopener noreferrer">CS_GUIDER</a></div></footer><div class="back-to-top box-border fixed right-6 z-1024 -bottom-20 rounded py-1 px-1 bg-slate-900 opacity-60 text-white cursor-pointer text-center dark:bg-slate-600"><span class="flex justify-center items-center text-sm"><iconify-icon width="18" icon="ion:arrow-up-c" id="go-top"></iconify-icon><span id="scrollpercent"><span>0</span> %</span></span></div><script src="/js/main.js"></script><script src="/js/search.js"></script><script>$(document).ready((function(){const t=document.getElementById("maple");Array.from({length:"10"}).map(()=>{const e=document.createElement("div"),a=.5*Math.random()+.5,l=2*Math.random()-1,n=Math.random()*t.clientWidth,i=-Math.random()*t.clientHeight;return e.className="maple",e.style.width=24*a+"px",e.style.height=24*a+"px",e.style.left=n+"px",e.style.top=i+"px",e.style.setProperty("--maple-fall-offset",l),e.style.setProperty("--maple-fall-height",Math.abs(i)+t.clientHeight+"px"),e.style.animation=`fall ${10/"0.3"}s linear infinite`,e.style.animationDelay=-10/"0.3"+"s",t.appendChild(e),e})}))</script><div class="fixed top-0 bottom-0 left-0 right-0 pointer-events-none print:hidden" id="maple"></div></body></html>
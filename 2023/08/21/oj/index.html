<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-1CX1BM2TTD"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1CX1BM2TTD")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-MP1THLPZFC"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MP1THLPZFC")</script><meta name="google-site-verification" content="COwq4mOphzRDivHncvzFed0dZge2jK1Rz_yDgTJsoQY"><meta name="baidu-site-verification" content="codeva-CjBrQqVd18"><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.ico"><link rel="icon" href="/img/fluid.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#21252b"><meta name="author" content="WLei224"><meta name="keywords" content=""><meta name="description" content="Smart OJ判题系统 复习一下项目开发流程  项目简介、项目调研、项目需求分析   核心业务流程   项目功能模块   技术选型   项目初始化   项目开发   测试  优化 （代码提交、代码审核、产品验收）   上线   在此过程中，也是要不断写文档、持续调研、沉淀知识的  项目简介OJ ： Online Judge（在线判题评测系统）用户可以选择题目练习，在线编写代码，测试代码，提交代码"><meta property="og:type" content="article"><meta property="og:title" content="基于Spring Boot的在线编程判题系统"><meta property="og:url" content="https://wlei224.gitee.io/2023/08/21/oj/index.html"><meta property="og:site_name" content="主页 | CSGUIDER&#39;S Blog"><meta property="og:description" content="Smart OJ判题系统 复习一下项目开发流程  项目简介、项目调研、项目需求分析   核心业务流程   项目功能模块   技术选型   项目初始化   项目开发   测试  优化 （代码提交、代码审核、产品验收）   上线   在此过程中，也是要不断写文档、持续调研、沉淀知识的  项目简介OJ ： Online Judge（在线判题评测系统）用户可以选择题目练习，在线编写代码，测试代码，提交代码"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311151627634.png"><meta property="article:published_time" content="2023-08-21T00:12:32.000Z"><meta property="article:modified_time" content="2024-05-19T05:12:25.508Z"><meta property="article:author" content="WLei224"><meta property="article:tag" content="Spring Boot"><meta property="article:tag" content="MySQL"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311151627634.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>基于Spring Boot的在线编程判题系统 - 主页 | CSGUIDER&#39;S Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"wlei224.gitee.io",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"left",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:"956b14594152e1b71ce14695a71235d5",google:"G-MP1THLPZFC",gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>if(!Fluid.ctx.dnt){var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?956b14594152e1b71ce14695a71235d5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}</script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.google-analytics.com/analytics.js",(function(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-MP1THLPZFC","auto"),ga("send","pageview")}))</script><meta name="generator" content="Hexo 5.4.2"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>CS_GUIDER</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span>Links</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search" style="font-size:1.1em">Search</i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li><li class="nav-item" id="github-btn"><a class="nav-link" target="_blank" aria-label="Github" href="https://github.com/WL2O2O/WL2O2O.github.io" title="If you get gains, star achieves you and me✨"><i class="iconfont icon-github-fill" id="icon-github-fill" style="font-size:1.1em"></i></a></li><li class="nav-item" id="high-btn"><a class="nav-link" target="_self" aria-label="High" onclick="runHighEffect()"><i>High一下!</i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311151640352.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="基于Spring Boot的在线编程判题系统"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> WLei224 </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-08-21 08:12" pubdate>August 21, 2023 am</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 43k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 363 mins </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> views</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="padding-left:2rem;margin-right:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">基于Spring Boot的在线编程判题系统</h1><p class="note note-info">Last updated on May 19, 2024 pm<br><button onclick='window.location.href="https://github.com/WL2O2O/WL2O2O.github.io/edit/hexoBlog/source/_posts/oj.md"' target="_blank" class="rounded-link">编辑文章✒️</button></p><style>.note{display:flex;flex-direction:column}.rounded-link{border-radius:10px;padding:4px;text-align:center;text-decoration:none;position:relative;width:100%;margin-left:auto;margin-right:10px}</style><p></p><div class="markdown-body"><h1 id="Smart-OJ判题系统"><a href="#Smart-OJ判题系统" class="headerlink" title="Smart OJ判题系统"></a><code>Smart OJ</code>判题系统</h1><blockquote><h2 id="复习一下项目开发流程"><a href="#复习一下项目开发流程" class="headerlink" title="复习一下项目开发流程"></a>复习一下项目开发流程</h2><ol><li>项目简介、项目调研、项目需求分析</li><li>核心业务流程</li><li>项目功能模块</li><li>技术选型</li><li>项目初始化</li><li>项目开发</li><li>测试</li><li>优化<br>（代码提交、代码审核、产品验收）</li><li>上线</li></ol><p>在此过程中，也是要不断写文档、持续调研、沉淀知识的</p></blockquote><h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>OJ ： Online Judge（在线判题评测系统）<br>用户可以选择题目练习，在线编写代码，测试代码，提交代码，系统会根据设置好的答案对用户提交的代码进行评测，给出评测结果！</p><h4 id="项目亮点"><a href="#项目亮点" class="headerlink" title="项目亮点"></a>项目亮点</h4><ol><li>项目新颖，重复度低，写简历有区分度</li><li>区别于常见的<code>CRUD</code>项目，偏向于架构设计、编程思想之类的知识</li><li>项目复杂度高，可扩展性强</li></ol><h4 id="OJ系统的常用概念"><a href="#OJ系统的常用概念" class="headerlink" title="OJ系统的常用概念"></a>OJ系统的常用概念</h4><p>ac 表示你的题目通过，结果正确<br>题目限制：时间限制、内存限制<br>题目介绍<br>题目输入<br>题目输出<br>题目输入用例<br>题目输出用例</p><h4 id="难点-判题系统"><a href="#难点-判题系统" class="headerlink" title="难点:判题系统"></a><strong>难点</strong>:判题系统</h4><p>普通测评：</p><p>管理员设置题目的输入和输出用例，比如我输入 A，你要输出 B 才是正确的；交给判题机去执行用户的代码，给用户的代码喂输入用例，比如 A，看用户程序的执行结果是否和标准答案的输出一致。<br>（比对用例文件）</p><p>特殊测评（SPJ）：</p><p>管理员设置题目的输入和输出，比如我输入 1，用户的答案只要是 &gt; 0 或 &lt; 2 都是正确的；特判程序，不是通过对比用例文件是否一致这种死板的程序来检验，而是要专门根据这道题目写一个特殊的判断程序，程序接收题目的输入（1）、标准输出用例（2）、用户的结果（1.5） ，特判程序根据这些值来比较是否正确。</p><p>交互测评：</p><p>让用户输入一个例子，就给一个输出结果，交互比较灵活，没办法通过简单的、死板的输入输出文件来搞定<br><strong><em>不能让用户随便引入包、随便遍历、暴力破解，需要使用正确的算法。 =&gt; 安全性</em></strong><br><strong><em>判题过程是异步的 =&gt; 异步化</em></strong><br><strong><em>提交之后，会生成一个提交记录，有运行的结果以及运行信息（时间限制、内存限制）</em></strong></p><h2 id="项目调研"><a href="#项目调研" class="headerlink" title="项目调研"></a>项目调研</h2><p><a target="_blank" rel="noopener" href="https://github.com/HimitZH/HOJ(%E9%80%82%E5%90%88%E5%AD%A6%E4%B9%A0)">https://github.com/HimitZH/HOJ(适合学习)</a><br><a target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudge(python,%E4%B8%8D%E5%A5%BD%E5%AD%A6%EF%BC%8C%E5%BE%88%E6%88%90%E7%86%9F)">https://github.com/QingdaoU/OnlineJudge(python,不好学，很成熟)</a><br><a target="_blank" rel="noopener" href="https://github.com/hzxie/Noj(%E6%98%9F%E6%98%9F%E6%B2%A1%E9%82%A3%E4%B9%88%E5%A4%9A%EF%BC%8C%E6%B2%A1%E9%82%A3%E4%B9%88%E6%88%90%E7%86%9F%EF%BC%8C%E4%BD%86%E7%9B%B8%E5%AF%B9%E5%A5%BD%E5%AD%A6)">https://github.com/hzxie/Noj(星星没那么多，没那么成熟，但相对好学)</a><br><a target="_blank" rel="noopener" href="https://github.com/vfleaking/uoj(php%E5%AE%9E%E7%8E%B0%E7%9A%84)">https://github.com/vfleaking/uoj(php实现的)</a></p><h2 id="项目需求分析"><a href="#项目需求分析" class="headerlink" title="项目需求分析"></a>项目需求分析</h2><h4 id="实现核心"><a href="#实现核心" class="headerlink" title="实现核心"></a>实现核心</h4><ol><li>权限校验</li><li>代码沙箱（安全沙箱 – 防止代码藏毒）<br>代码安全：设置安全的、隔离的沙箱，以确保用户的代码不会影响到系统的安全</li><li>判题规则<br>题目用例的比对，结果的验证</li><li>任务调度<br>资源分配：防止用户疯狂占用资源，措施：异步化处理，服务资源有限，按照用户提交顺序进行判题</li></ol><h4 id="核心业务流程"><a href="#核心业务流程" class="headerlink" title="核心业务流程"></a>核心业务流程</h4><p><img src="https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311221849444.png#id=bhLKl&originHeight=441&originWidth=909&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p><h4 id="时序图："><a href="#时序图：" class="headerlink" title="时序图："></a>时序图：</h4><p><img src="https://cs-wlei224.obs.cn-south-1.myhuaweicloud.com/blog-imgs/202311151640352.png#id=OaeO0&originHeight=863&originWidth=1173&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=" srcset="/img/loading.gif" lazyload></p><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><ol><li>题目模块<br>a. 管理员：创建、删除、修改<br>b. 用户：搜索题目<br>c. 在线做题、提交题目代码</li><li>用户模块<br>a. 注册与登录</li><li>判题模块<br>a. 提交判题（结果是否正确与错误）<br>b. 错误处理（内存溢出、安全性、超时）<br>c. 自主实现代码沙箱（安全、隔离的一个环境）<br>d. 开放接口</li></ol><h4 id="扩展思路"><a href="#扩展思路" class="headerlink" title="扩展思路"></a>扩展思路</h4><ol><li>支持多种语言</li><li>远程评测</li><li>完善的评测功能：普通评测、特殊评测、交互评测、在线自测、文件IO</li><li>统计分析判题记录</li><li>权限校验</li></ol><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><h4 id="前端："><a href="#前端：" class="headerlink" title="前端："></a>前端：</h4><p><code>Vue3、手撸Umi项目模板、AcroDesign组件库、在线代码编辑器、在线文档浏览</code></p><h4 id="后端："><a href="#后端：" class="headerlink" title="后端："></a>后端：</h4><p><code>Java进程控制、Java安全管理、部分JVM知识点、虚拟机、Docker、Spring Cloud微服务、消息队列</code></p><h2 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h2><p>采用分层架构：用户层、接入层、业务层、服务层、存储层、资源层</p><p><img src="E:/Master/TyporaImages/oj/image-20231122192355366.png" srcset="/img/loading.gif" lazyload alt="OJ架构设计"></p><h2 id="项目排期"><a href="#项目排期" class="headerlink" title="项目排期"></a>项目排期</h2><ol><li>项目简介、项目调研、需求分析、技术选型、架构设计、现有<code>OJ</code>主流实现方案</li><li>前后端项目初始化、前端通用项目模板的搭建</li><li>主业务流程的前后端开发（争取把代码沙箱之外的全部搞定）</li><li>专攻代码沙箱（自主实现，不止一种实现方案，层层递进，通过实战用例来进行安全优化）</li><li>系统优化（微服务改造、系统扩展思路）</li></ol><h2 id="主流OJ实现方案"><a href="#主流OJ实现方案" class="headerlink" title="主流OJ实现方案"></a>主流OJ实现方案</h2><ol><li>用现成的<code>OJ</code>系统</li></ol><p>网上有很多开源的<code>OJ</code>项目，比如<code>青岛OJ</code>、<code>HustOJ</code>等，可以直接下载开源代码自己部署。<br>比较推荐的是<code>judge0</code>，这是一个非常成熟的<code>商业OJ</code>项目，支持 60 多种编程语言！</p><blockquote><p>代码：<a target="_blank" rel="noopener" href="https://github.com/judge0/judge0">https://github.com/judge0/judge0</a></p></blockquote><ol start="2"><li>用现成的服务</li></ol><p>如果你不希望完整部署一套大而全的代码，只是想复用他人已经实现的、最复杂的判题逻辑，那么可以直接使用现成的 判题<code>API</code>、或者现成的 代码沙箱 等服务。<br>比如<code>judge0</code>提供的<code>判题API</code>，非常方便易用。只需要通过 HTTP 调用<code>submissions</code>判题接口，把用户的代码、输入值、预期的执行结果作为请求参数发送给<code>judge0</code>的服务器，它就能自动帮你编译执行程序，并且返回程序的运行结果。<br><code>API</code>的作用：接受代码、返回执行结果</p><blockquote><p><code>Judge0 API</code>地址：<a target="_blank" rel="noopener" href="https://rapidapi.com/judge0-official/api/judge0-ce">https://rapidapi.com/judge0-official/api/judge0-ce</a><br>官方文档：<a target="_blank" rel="noopener" href="https://ce.judge0.com/#submissions-submission-post">https://ce.judge0.com/#submissions-submission-post</a></p></blockquote><blockquote><p>流程<br>1先注册<br>2再开通订阅<br>3然后测试 language 接口<br>4测试执行代码接口 submissions</p></blockquote><ol start="3"><li><strong>自主开发</strong>✨✨✨–我的方案</li></ol><p>自主实现判题服务和代码沙箱，适合学习，但不适用于商业项目。</p><ol start="4"><li>把 AI 来当做代码沙箱</li></ol><p>现在 AI 的能力已经十分强大了，我们可以把各种本来很复杂的功能直接交给 AI 来实现。<br>只要脑洞够大，AI + 编程 = 无限的可能~</p><ol start="5"><li>移花接木</li></ol><p>这种方式最有意思、也最 “缺德”。很多同学估计想不到。<br>那就是可以通过让程序来操作模拟浏览器的方式，用别人已经开发好的 OJ 系统来帮咱们判题。<br>比如使用 Puppeteer + 无头浏览器，把咱们系统用户提交的代码，像人一样输入到别人的 OJ 网页中，让程序点击提交按钮，并且等别人的 OJ 系统返回判题结果后，再把这个结果返回给我们自己的用户。<br>这种方式的缺点就是把核心流程交给了别人，如果别人服务挂了，你的服务也就挂了；而且别人 OJ 系统不支持的题目，可能你也支持不了。</p><h1 id="后端项目初始化"><a href="#后端项目初始化" class="headerlink" title="后端项目初始化"></a>后端项目初始化</h1><h3 id="五步走："><a href="#五步走：" class="headerlink" title="五步走："></a>五步走：</h3><ol><li>选中项目全局搜索替换springboot-init为新项目名</li><li>选中包，全局更改替换包名springbootinit</li><li>更改包名</li><li>本地新建数据库，直接执行sql/create table.sql脚本，修改库名为yuoj,执行即可</li><li>改application.yml配置，修改MySQL数据库的连接库名、账号密码，端口号</li></ol><h3 id="初始化模板待完善的地方："><a href="#初始化模板待完善的地方：" class="headerlink" title="初始化模板待完善的地方："></a>初始化模板待完善的地方：</h3><ol><li>日志：根据错误类型分类，分级归档</li><li>扩展：引入分布式锁、多线程、线程池</li></ol><h2 id="项目模板复习"><a href="#项目模板复习" class="headerlink" title="项目模板复习"></a>项目模板复习</h2><blockquote><p><strong>1)先阅读README.md</strong><br><strong>2)sql/create table.sql定义了数据库的初始化建库建表语句</strong><br><strong>3)sql/post_es mapping,json帖子表在ES中的建表语句</strong><br><strong>4)aop:用于全局权限校验、全局日志记录</strong><br><strong>5)common:万用的类，比如通用响应类</strong><br><strong>6)config:用于接收application.yml中的参数，初始化一些客户端的配置类（比如对象存储客户端）</strong><br><strong>7)constant:定义常量</strong><br><strong>8)controller:接受请求</strong><br><strong>9)esdao:类似mybatis的mapper,用于操作ES</strong><br><strong>10)exception:异常处理相关</strong><br><strong>11)job:任务相关（定时任务、单次任务）</strong><br><strong>12)manager:服务层（一般是定义一些公用的服务、对接第三方APl等）</strong><br><strong>13)mapper:mybatis的数据访问层，用于操作数据库</strong><br><strong>14)model:数据模型、实体类、包装类、枚举值</strong><br><strong>15)service:服务层，用于编写业务逻辑</strong><br><strong>16)utils:工具类，各种各样公用的方法</strong><br><strong>17)wxmp:公众号相关的包</strong><br><strong>18)test:单元测试</strong><br><strong>19)MainApplication:项目启动入口</strong><br><strong>20)Dockerfile:用于构建Docker镜像</strong></p></blockquote><h2 id="基本开发流程"><a href="#基本开发流程" class="headerlink" title="基本开发流程"></a>基本开发流程</h2><h3 id="库表设计"><a href="#库表设计" class="headerlink" title="库表设计"></a>库表设计</h3><ol><li>根据功能设计库表<ol><li>用户表</li></ol></li></ol><p>字段：id、账号、密码、昵称、头像、简介、用户角色、微信开放平台id、公众号openId、创建时间、修改时间、是否删除（项目全局配置文件中已经配置了 MybatisPlus isDelete 字段为逻辑删除）</p><pre><code class="hljs">  2. 题目表
</code></pre><p>字段：<br>题目相关：id、标题、内容、标签、答案、提交数量、通过数量、通关率（扩展）；<br>判题相关：判题用例（judgeCase / json）、判题限制（judgeConfig / json）、判题类型（扩展）；</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;input&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1 2&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;output&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3 4&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;input&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1 3&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;output&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2 4&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;timeLimit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;memoryLimit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;stackLimit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><pre><code class="hljs">  3. 用户-题目提交表
</code></pre><p>字段：用户id、题目id、语言、代码、判题状态、判题信息（judgeInfo / json）;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&#123;$ 判题信息枚举值 $&#125;&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 单位：ms</span><br>  <span class="hljs-attr">&quot;memory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span>  <span class="hljs-comment">// 单位：kb</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>枚举值信息：</p><pre><code class="hljs">     - ACCEPT                      通过
     - WRONG_ANSWER            答案错误
     - COMPILE_ERROR            编译错误
     - MEMORY_LIMIT_EXCEEDED    内存溢出
     - TIME_LIMIT_EXCEETED        超时
     - PRESENTATION_ERROR        展示错误
     - OUTPUT_LIMIT_EXCEEDED        输出溢出
     - WAITING                    等待中
     - DANGEROUS_OPERATION        危险操作
     - RUNTIME_ERROR            运行错误
     - SYSTEM_ERROR             系统错误
</code></pre><blockquote><p>数据库表字段存 json 的<strong>前提：</strong><br>首先，字段含义相关，属于同一类；<br>其次，不需要根据 json 中的某一字段进行查询；<br>最后，字段存储不用占用太多空间。<br>存 json 的<strong>好处：</strong><br>便于扩展，即：不用修改库表结构，就可以直接操作对象内部的字段<br>小知识（数据库索引）：<br>什么时候适合加索引？如何给某个字段加上索引？<br>首先，索引需要建立在有区分度的字段上；<br>其次，需要从我们的实际业务出发，无论是单个索引，还是联合索引，都需要从实际的查询语句、字段枚举值的区分度、字段的类型考虑，特别是 where 条件指定的字段。<br>例如：where userId = 1 and questionId = 2，这个时候就可以分别建立索引，或者是联合索引，<strong>如果是数据量不大的话，尽量不用索引，因为索引也需要占用空间。（待考证！！！）</strong></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 数据库初始化<br># <span class="hljs-variable">@author</span> <span class="hljs-operator">&lt;</span>a href<span class="hljs-operator">=</span>&quot;https://github.com/wl2o2o&quot;<span class="hljs-operator">&gt;</span>程序员CSGUIDER<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>a<span class="hljs-operator">&gt;</span><br># <span class="hljs-variable">@from</span> <span class="hljs-operator">&lt;</span>a href<span class="hljs-operator">=</span>&quot;https://wl2o2o.github.io&quot;<span class="hljs-operator">&gt;</span>CSGUIDER博客<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>a<span class="hljs-operator">&gt;</span><br><br><span class="hljs-comment">-- 创建库</span><br><span class="hljs-keyword">create</span> database if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> smartoj;<br><br><span class="hljs-comment">-- 切换库</span><br>use smartoj;<br><br><span class="hljs-comment">-- 用户表</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> <span class="hljs-keyword">user</span> (<br>  id        	     <span class="hljs-type">bigint</span>           auto_increment                        		comment <span class="hljs-string">&#x27;id&#x27;</span>   	             <span class="hljs-keyword">primary</span> key,<br>  userAccount      <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)  															  <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>  		comment <span class="hljs-string">&#x27;用户账号&#x27;</span>,<br>  userPassword     <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>)						          						<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	comment <span class="hljs-string">&#x27;用户密码&#x27;</span>,<br>  userName 		     <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)  								 							 			<span class="hljs-keyword">null</span> 	    comment <span class="hljs-string">&#x27;用户昵称&#x27;</span>,<br>  userAvatar 	     <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>) 								  									<span class="hljs-keyword">null</span> 	   	comment <span class="hljs-string">&#x27;用户头像&#x27;</span>,<br>  userProfile      <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>)							 	  										<span class="hljs-keyword">null</span>      comment <span class="hljs-string">&#x27;用户简介&#x27;</span>,<br>  userRole 	 	     <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)     <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;user&#x27;</span>			  			<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	comment <span class="hljs-string">&#x27;用户角色&#x27;</span>,<br>  unionId			 		 <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)								  										<span class="hljs-keyword">null</span>		  comment <span class="hljs-string">&#x27;微信开放平台id&#x27;</span>,<br>  mpOpenId 		     <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)					   										   		<span class="hljs-keyword">null</span> 	    comment <span class="hljs-string">&#x27;微信公众号id&#x27;</span>,<br>  createTime	     datetime         <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>   <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>	  	comment <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  updateTime       datetime         <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>   <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	<span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  isDelete         tinyint          <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>					  				<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>  	  comment <span class="hljs-string">&#x27;逻辑删除&#x27;</span>,<br>  index 			 		 idx_unionId      (unionId)<br>) comment <span class="hljs-string">&#x27;用户表&#x27;</span>  <span class="hljs-keyword">collate</span> <span class="hljs-operator">=</span> utf8mb4_unicode_ci;<br><br><br># 字段：<br># 题目相关：id、标题、内容、标签、答案、提交数量、通过数量、通关率（扩展）；<br># 判题相关：判题用例（judgeCase <span class="hljs-operator">/</span> json）、判题限制（judgeConfig <span class="hljs-operator">/</span> json）、判题类型（扩展）；<br><span class="hljs-comment">-- 题目表</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> question (<br>  id        	     <span class="hljs-type">bigint</span>      	  auto_increment                         			comment <span class="hljs-string">&#x27;题目id&#x27;</span>              <span class="hljs-keyword">primary</span> key,<br>  userId        	 <span class="hljs-type">bigint</span>        															 	<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	comment <span class="hljs-string">&#x27;创建用户id&#x27;</span>,<br>  title			    	 <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)  								 								<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	comment <span class="hljs-string">&#x27;题目标题&#x27;</span>,<br>  tags 			     	 <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)				    		 	 								<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	comment <span class="hljs-string">&#x27;题目标签&#x27;</span>,<br>  content          text							        									  <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	comment <span class="hljs-string">&#x27;题目内容&#x27;</span>,<br>  answer	 	  	   text				  						 												<span class="hljs-keyword">null</span> 	    comment <span class="hljs-string">&#x27;题目答案&#x27;</span>,<br>  judgeCase	 	     text 								     	 									<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	comment <span class="hljs-string">&#x27;判题用例&#x27;</span>,<br>  judgeConfig	     text									     												<span class="hljs-keyword">null</span>			comment <span class="hljs-string">&#x27;判题限制&#x27;</span>,<br>  submitNum 	     <span class="hljs-type">int</span> 					  <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>					 								<span class="hljs-keyword">null</span> 	    comment <span class="hljs-string">&#x27;提交数量&#x27;</span>,<br>  acceptNum        <span class="hljs-type">int</span>         	  <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>	 			  	 							<span class="hljs-keyword">null</span>      comment <span class="hljs-string">&#x27;通过数量&#x27;</span>,<br>  thumbNum 		     <span class="hljs-type">int</span>			  		<span class="hljs-keyword">default</span> <span class="hljs-number">0</span>												 	<span class="hljs-keyword">null</span> 	    comment <span class="hljs-string">&#x27;点赞数量&#x27;</span>,<br>  favourNum		     <span class="hljs-type">int</span> 	   		  	<span class="hljs-keyword">default</span> <span class="hljs-number">0</span>					 								<span class="hljs-keyword">null</span> 	    comment <span class="hljs-string">&#x27;收藏数量&#x27;</span>,<br>  createTime	     datetime       <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>  		<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>	 		comment <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  updateTime       datetime       <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> 		<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>   		<span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>  comment <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  isDelete         tinyint        <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 		<span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>    	comment <span class="hljs-string">&#x27;逻辑删除&#x27;</span>,<br>  index 			 		 idx_userId     (userId)<br>) comment <span class="hljs-string">&#x27;题目表&#x27;</span>  <span class="hljs-keyword">collate</span> <span class="hljs-operator">=</span> utf8mb4_unicode_ci;<br><br><br># 字段：用户id、题目id、语言、代码、判题状态、判题信息（judgeInfo <span class="hljs-operator">/</span> json）;<br><span class="hljs-comment">-- 题目提交表</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> question_submit (<br>  id                <span class="hljs-type">bigint</span>          auto_increment                           comment <span class="hljs-string">&#x27;id&#x27;</span>		<span class="hljs-keyword">primary</span> key,<br>  userId            <span class="hljs-type">bigint</span>                                      <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>     comment <span class="hljs-string">&#x27;创建用户 id&#x27;</span>,<br>  questionId        <span class="hljs-type">bigint</span>                                      <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>     comment <span class="hljs-string">&#x27;题目 id&#x27;</span>,<br>  <span class="hljs-keyword">language</span>          <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>)                                <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>     comment <span class="hljs-string">&#x27;编程语言&#x27;</span>,<br>  code              text                                        <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>     comment <span class="hljs-string">&#x27;用户代码&#x27;</span>,<br>  status            <span class="hljs-type">int</span>             <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                   <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>     comment <span class="hljs-string">&#x27;判题状态（0 - 待判题、1 - 判题中、2 - 成功、3 - 失败）&#x27;</span>,<br>  judgeInfo         text                                        		<span class="hljs-keyword">null</span>     comment <span class="hljs-string">&#x27;判题信息（json 对象）&#x27;</span>,<br>  createTime        datetime        <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>   <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>     comment <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  updateTime        datetime        <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>   <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>     <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  isDelete          tinyint         <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                   <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>     comment <span class="hljs-string">&#x27;是否删除&#x27;</span>,<br>  index             idx_questionId  (questionId),<br>  index             idx_userId      (userId)<br><br>) comment <span class="hljs-string">&#x27;题目提交表&#x27;</span>  <span class="hljs-keyword">collate</span> <span class="hljs-operator">=</span> utf8mb4_unicode_ci;<br></code></pre></td></tr></table></figure><h3 id="代码生成方法"><a href="#代码生成方法" class="headerlink" title="代码生成方法"></a>代码生成方法</h3><ol><li>使用 MyBatisX 插件，会自动根据库表字段，一键生成业务的基础 CRUD 代码</li><li>编写 Controller 层代码（根据模板进行复用，复制逻辑相同代码，替换字段）</li><li>编写 DTO、VO、枚举值字段，用于接受前端请求或者业务间传递信息。（复用项目模板）</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.yupi.yuoj.model.enums;<br><br><span class="hljs-keyword">import</span> org.apache.commons.lang3.ObjectUtils;<br><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.stream.Collectors;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 题目提交编程语言枚举</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> &lt;a href=&quot;https://github.com/liyupi&quot;&gt;程序员鱼皮&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@from</span> &lt;a href=&quot;https://yupi.icu&quot;&gt;编程导航知识星球&lt;/a&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">QuestionSubmitLanguageEnum</span> &#123;<br><br>    JAVA(<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;java&quot;</span>),<br>    CPLUSPLUS(<span class="hljs-string">&quot;c++&quot;</span>, <span class="hljs-string">&quot;c++&quot;</span>),<br>    GOLANG(<span class="hljs-string">&quot;golang&quot;</span>, <span class="hljs-string">&quot;golang&quot;</span>);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String text;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String value;<br><br>    QuestionSubmitLanguageEnum(String text, String value) &#123;<br>        <span class="hljs-built_in">this</span>.text = text;<br>        <span class="hljs-built_in">this</span>.value = value;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取值列表</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">getValues</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Arrays.stream(values()).map(item -&gt; item.value).collect(Collectors.toList());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据 value 获取枚举</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> QuestionSubmitLanguageEnum <span class="hljs-title function_">getEnumByValue</span><span class="hljs-params">(String value)</span> &#123;<br>        <span class="hljs-keyword">if</span> (ObjectUtils.isEmpty(value)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (QuestionSubmitLanguageEnum anEnum : QuestionSubmitLanguageEnum.values()) &#123;<br>            <span class="hljs-keyword">if</span> (anEnum.value.equals(value)) &#123;<br>                <span class="hljs-keyword">return</span> anEnum;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> value;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getText</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> text;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>编写一些独立的类，因为以上库表中设计的含有 JSON 字段，为了方便处理 JSON 中的某个字段。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 题目用例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JudgeCase</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 输入用例</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String input;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 输出用例</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String output;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li>校验 Controller 类，解决报错</li><li>编写 Service 代码，完成业务逻辑</li></ol><blockquote><p><strong>小知识：</strong><br><strong>为什么要加上业务前缀（上述代码中的JudgeCase），什么时候不加？</strong><br>首先，增加业务前缀有利于增加区分度，防止多表中重复类名产生冲突；<br>其次，通常情况下，我们希望抽出一个公用类来共享，这时不需加业务前缀。<br><strong>什么是 VO 类？有什么用？</strong><br>VO：View Object（显示层对象）—— 专门给前端返回、显示的对象，一般会过滤脱敏掉一些不需要返回给前端的字段，保证安全性，不仅更加方便展示给用户，而且方便展示给前端开发者，还可以节约网络传输大小。<br>DTO：Data Transfer Object（数据传输对象）<br>BO：Bussiness Object（业务对象）<br><strong>怎么防止爬虫爬取题目？有什么简单的方法？</strong><br>建议把题目的 id 生成规则 改为 ASSIGN_ID ，这样就可以通过其底层的雪花算法：ASSIGN_UUID 随机生成一个 32 位的 id，有效避免爬虫对题目的爬取。<br>示例：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@TableId(type = IdType.ASSIGN_ID)</span><br><span class="hljs-keyword">private</span> Long id;<br></code></pre></td></tr></table></figure><h3 id="查询提交信息接口（网站的提交信息实时监控面板）"><a href="#查询提交信息接口（网站的提交信息实时监控面板）" class="headerlink" title="查询提交信息接口（网站的提交信息实时监控面板）"></a>查询提交信息接口（网站的提交信息实时监控面板）</h3><ul><li>功能：<ul><li>根据用户 ID 查询</li><li>题目 ID 查询</li><li>编程语言查询</li><li>题目状态查询</li></ul></li><li>注意事项：<ul><li>非管理员和本人，不得观看其他用户的代码</li></ul></li><li>实现方案：<ul><li>查询 ==&gt; 根据权限脱敏</li><li></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> QuestionSubmitVO <span class="hljs-title function_">getQuestionSubmitVO</span><span class="hljs-params">(QuestionSubmit questionSubmit, User loginUser)</span> &#123;<br>    <span class="hljs-type">QuestionSubmitVO</span> <span class="hljs-variable">questionSubmitVO</span> <span class="hljs-operator">=</span> QuestionSubmitVO.objToVo(questionSubmit);<br>    <span class="hljs-comment">// 脱敏：仅本人和管理员能看见自己（提交 userId 和登录用户 id 不同）提交的代码</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> loginUser.getId();<br>    <span class="hljs-comment">// 处理脱敏</span><br>    <span class="hljs-keyword">if</span> (userId != questionSubmit.getUserId() &amp;&amp; !userService.isAdmin(loginUser)) &#123;<br>        questionSubmitVO.setCode(<span class="hljs-literal">null</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> questionSubmitVO;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong><em>todo: 熟悉快速 CRUD 的步骤，过项目模板，充分理解；完善更加通用的 Controller、Service 代码。</em></strong></p><h2 id="判题机模块架构设计"><a href="#判题机模块架构设计" class="headerlink" title="判题机模块架构设计"></a>判题机模块架构设计</h2><blockquote><p>这就是架构师的工作：先跑通完整的业务流程，在进行代码沙箱复杂的实现</p></blockquote><h2 id="判题模块与代码沙箱的关系"><a href="#判题模块与代码沙箱的关系" class="headerlink" title="判题模块与代码沙箱的关系"></a>判题模块与代码沙箱的关系</h2><p><strong>判题模块：</strong><br>调用代码沙箱，把代码和输入用例交给代码沙箱去执行<br><strong>代码沙箱：</strong><br>接收代码和输入用例，返回编译运行的结果，不负责判题（可以作为独立的项目或者服务，提供给其他需要执行代码的项目去使用）<br><strong>架构图：</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/35457700/1702951349750-208e4b83-f387-4644-817a-bc68dd84dafd.jpeg" srcset="/img/loading.gif" lazyload><br><strong>思考：</strong><br>为什么要直接执行一组输入用例和输出一组运行结果？<br>试想，如果是对于每一个用例都要执行调用一次 代码沙箱 API 接口的话，需要多次的网络传输、程序需要多次的编译、记录程序的执行状态。造成的资源浪费严重。<br>这样就是骆驼驮运货物是分多次还是一次性过河！</p><blockquote><p>这是一种很常见的性能优化的方法：批处理！</p></blockquote><h2 id="代码沙箱架构开发"><a href="#代码沙箱架构开发" class="headerlink" title="代码沙箱架构开发"></a>代码沙箱架构开发</h2><blockquote><p>为了提高代码沙箱的通用性（便于后期进行扩展 AI 判题或者远程判题），<br>我们定义代码沙箱为接口，这样就便于后期进行扩展了⭐⭐⭐⭐⭐</p></blockquote><ol><li>定义代码沙箱为接口，提高通用性</li></ol><p>这样，我们之后的项目判题模块代码只调用代码沙箱的接口进行判题，不用调用实现类，<br>这样就可以不用更改代码了（之更改调用的接口）</p><blockquote><p>TODO: 代码沙箱的请求接口中，判题的 timeLimit 可以不加，也或者自行扩展（扩展点）<br>扩展思路：增加一个代码沙箱状态的接口</p></blockquote><ol start="2"><li>定义所种不通风的代码沙箱的实现</li></ol><p>示例代码沙箱——打通流程<br>远程代码沙箱——调用实际的接口<br>第三方代码沙箱——调用网上现成的代码沙箱（例如：goJudge——<a target="_blank" rel="noopener" href="https://github.com/criyle/go-judge">https://github.com/criyle/go-judge</a>）</p><ol start="3"><li>编写单元测试，验证单个代码沙箱的执行</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeSandboxTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">CodeSandbox</span> <span class="hljs-variable">codeSandbox</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteCodeSandbox</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;int main() &#123; &#125;&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">language</span> <span class="hljs-operator">=</span> QuestionSubmitLanguageEnum.JAVA.getValue();<br>        List&lt;String&gt; inputList = Arrays.asList(<span class="hljs-string">&quot;1 2&quot;</span>, <span class="hljs-string">&quot;3 4&quot;</span>);<br>        <span class="hljs-type">ExecuteCodeRequest</span> <span class="hljs-variable">executeCodeRequest</span> <span class="hljs-operator">=</span> ExecuteCodeRequest.builder()<br>                .code(code)<br>                .language(language)<br>                .inputList(inputList)<br>                .build();<br>        <span class="hljs-type">ExecuteCodeResponse</span> <span class="hljs-variable">executeCodeResponse</span> <span class="hljs-operator">=</span> codeSandbox.executeCode(executeCodeRequest);<br>        Assertions.assertNotNull(executeCodeResponse);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>目前还存在一个问题，就是我们的测试中把代码沙箱的选择已经写死了，如果项目后面需要改为其他沙箱，那么就需要改动很多代码。所以。。。。。。</p><p>我们可以使用<strong>工厂模式来解决这个难题。</strong></p><ol start="4"><li>使用工厂模式，直接根据用户在配置文件中传入的字符串参数（指定的沙箱类别），来生成对应的代码沙箱实现类</li></ol><blockquote><p>此处，我们使用的是静态工厂模式，实现比较简单，符合需求</p></blockquote><p><strong>示例代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 代码沙箱工厂（根据字符串参数创建指定的代码沙箱实例）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeSandboxFactory</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 创建代码沙箱示例</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> type 沙箱类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CodeSandbox <span class="hljs-title function_">newInstance</span><span class="hljs-params">(String type)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (type) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;example&quot;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExampleCodeSandbox</span>();<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;remote&quot;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteCodeSandbox</span>();<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;thirdParty&quot;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThirdPartyCodeSandbox</span>();<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExampleCodeSandbox</span>();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>扩展思路：<br>如果确定代码沙箱中不会出现线程安全问题，你什么可以使用单例工厂模式。<br>详细见聚合搜索项目。</p></blockquote><p><strong>使用工厂模式：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>    <span class="hljs-keyword">while</span> (scanner.hasNext()) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> scanner.next();<br>        <span class="hljs-type">CodeSandbox</span> <span class="hljs-variable">codeSandbox</span> <span class="hljs-operator">=</span> CodeSandboxFactory.newInstance(type);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;int main() &#123; &#125;&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">language</span> <span class="hljs-operator">=</span> QuestionSubmitLanguageEnum.JAVA.getValue();<br>        List&lt;String&gt; inputList = Arrays.asList(<span class="hljs-string">&quot;1 2&quot;</span>, <span class="hljs-string">&quot;3 4&quot;</span>);<br>        <span class="hljs-type">ExecuteCodeRequest</span> <span class="hljs-variable">executeCodeRequest</span> <span class="hljs-operator">=</span> ExecuteCodeRequest.builder()<br>        .code(code)<br>        .language(language)<br>        .inputList(inputList)<br>        .build();<br>        <span class="hljs-type">ExecuteCodeResponse</span> <span class="hljs-variable">executeCodeResponse</span> <span class="hljs-operator">=</span> codeSandbox.executeCode(executeCodeRequest);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li><strong>参数配置化：</strong></li></ol><p>在<code>application.yml</code>中进行配置指定代码沙箱的变量：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 代码沙箱配置</span><br><span class="hljs-attr">codesandbox:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">example</span><br></code></pre></td></tr></table></figure><p><strong>在 Spring 的 Bean 中通过</strong><code>**@Value**</code><strong>注解来使用配置文件中的代码沙箱：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Value(&quot;$&#123;codesandbox.type:example&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String type;<br></code></pre></td></tr></table></figure><ol start="6"><li>代码能力增强</li></ol><blockquote><p>比如，我们需要调用代码沙箱前后输出参数日志，输出响应结果日志，便于管理员进行分析。<br>那么我们需要在每一个类中都写上<code>log.info</code>吗？</p></blockquote><p><strong>代理模式：</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/35457700/1702979899931-2ef8c2d9-4bdf-4f01-97fc-3c23a5dc3c7a.jpeg" srcset="/img/loading.gif" lazyload></p><p><strong>代理模式的实现原理：</strong></p><ol><li>实现被代理的接口</li><li>通过构造函数接受一个被代理的接口实现类</li><li>通过被代理的接口实现类，增加代理需要实现的操作</li></ol><p><strong>示例代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeSandboxProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CodeSandbox</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CodeSandbox codeSandbox;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CodeSandboxProxy</span><span class="hljs-params">(CodeSandbox codeSandbox)</span> &#123;<br>        <span class="hljs-built_in">this</span>.codeSandbox = codeSandbox;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ExecuteCodeResponse <span class="hljs-title function_">executeCode</span><span class="hljs-params">(ExecuteCodeRequest executeCodeRequest)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;代码沙箱请求信息：&quot;</span> + executeCodeRequest.toString());<br>        <span class="hljs-type">ExecuteCodeResponse</span> <span class="hljs-variable">executeCodeResponse</span> <span class="hljs-operator">=</span> codeSandbox.executeCode(executeCodeRequest);<br>        log.info(<span class="hljs-string">&quot;代码沙箱响应信息：&quot;</span> + executeCodeResponse.toString());<br>        <span class="hljs-keyword">return</span> executeCodeResponse;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>使用方式：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">CodeSandbox</span> <span class="hljs-variable">codeSandbox</span> <span class="hljs-operator">=</span> CodeSandboxFactory.newInstance(type);<br>codeSandbox = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CodeSandboxProxy</span>(codeSandbox);<br></code></pre></td></tr></table></figure><ol start="7"><li>实现示例代码沙箱</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 示例代码沙箱（仅为了跑通业务流程）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleCodeSandbox</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CodeSandbox</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ExecuteCodeResponse <span class="hljs-title function_">executeCode</span><span class="hljs-params">(ExecuteCodeRequest executeCodeRequest)</span> &#123;<br>        List&lt;String&gt; inputList = executeCodeRequest.getInputList();<br>        <span class="hljs-type">ExecuteCodeResponse</span> <span class="hljs-variable">executeCodeResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecuteCodeResponse</span>();<br>        executeCodeResponse.setOutputList(inputList);<br>        executeCodeResponse.setMessage(<span class="hljs-string">&quot;测试执行成功&quot;</span>);<br>        executeCodeResponse.setStatus(QuestionSubmitStatusEnum.SUCCEED.getValue());<br>        <span class="hljs-type">JudgeInfo</span> <span class="hljs-variable">judgeInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JudgeInfo</span>();<br>        judgeInfo.setMessage(JudgeInfoMessageEnum.ACCEPTED.getText());<br>        judgeInfo.setMemory(<span class="hljs-number">100L</span>);<br>        judgeInfo.setTime(<span class="hljs-number">100L</span>);<br>        executeCodeResponse.setJudgeInfo(judgeInfo);<br>        <span class="hljs-keyword">return</span> executeCodeResponse;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>知识点 - LomBok Buider 注解：</strong><br>我们通常创建一个对象之后都是通过 set、get 进行存取值的，其实还有一种更为便捷的 set 值的方式：builder</p><p><strong>使用方法：</strong></p><ol><li>实体类加上<code>@Builder</code>注解</li><li>链式地给对象进行赋值</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Builder</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animals</span> &#123;<br>	<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>&#125;<br><br><br><span class="hljs-type">Animals</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> Animals.builder()<br>	.id(<span class="hljs-number">1</span>)<br>	.name(<span class="hljs-string">&quot;翠花&quot;</span>)<br>	.age(<span class="hljs-number">18</span>)<br>	.builder();<br></code></pre></td></tr></table></figure><blockquote><p>TODO 完成示例代码沙箱 —&gt; 改为远程代码沙箱</p></blockquote><h2 id="判题服务完整业务流程开发"><a href="#判题服务完整业务流程开发" class="headerlink" title="判题服务完整业务流程开发"></a>判题服务完整业务流程开发</h2><p><strong>判题服务业务流程：</strong></p><ol><li>传入题目的 id ，获取到对应的题目、提交信息（包含代码、编程语言等）</li><li>调用沙箱，获取执行结果</li><li>根据执行结果，判断 –&gt; 设置题目判题状态与信息</li></ol><blockquote><p>以上是最基本的判题业务流程，但是还不够完整，存在点击多次、多次判题的 Bug，那么就要给判题设置一个状态了！</p></blockquote><p><strong>完善后的判题服务业务流程：</strong></p><ol><li>传入题目的 id ，获取到对应的题目、提交信息（包含代码、编程语言等）</li><li><strong>if （判题状态不为等待中） 抛出异常;</strong></li><li><strong>更改判题状态为判题中</strong></li><li>调用沙箱，获取执行结果</li><li>根据代码沙箱执行结果，判断运行结果是否则正确 –&gt; 设置题目最终的判题状态与信息</li></ol><p><strong>判断逻辑：</strong></p><ol><li>先判断，代码沙箱执行的结果输出数量是否和预期输出数量是否一致</li><li>依次判断每一项的预期输出是否相等</li><li>判题题目的限制是否符合要求</li><li>其他异常</li></ol><p><strong>注意：</strong><br>如果我们的代码沙箱执行程序需要十秒钟，这个时间可能根据编程语言的不同而该变动，那么怎么解决？</p><p>A：我们可以<strong>采取策略模式</strong>，针对不同的情况，定义不同的策略，以便于进行修改与维护。这样就可以<strong>改善业务代码中</strong><code>**if else**</code><strong>成堆，业务逻辑不清晰</strong>的情况。</p><p><strong>如何实现策略模式？</strong></p><ol><li>定义判题上下文对象，用于定义在策略中传递的参数（可以理解为DTO）</li><li>定义策略接口，让代码更加通用化</li><li>实现默认的业务策略（剪切<code>judgeService</code>中判题逻辑的相关代码）</li><li>针对不同语言实际情况，定义不同的策略</li></ol><blockquote><p>切换策略时，难免会使用<code>if else</code>，考虑到降低耦合度，我们可以将切换策略的逻辑抽离出来，单独编写一个判断切换策略的类</p></blockquote><ol start="5"><li>编写一个判断切换策略的类<code>StrategyManage</code></li></ol><p><strong>示例代码：</strong></p><ol><li>定义判题上下文对象</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JudgeContext</span> &#123;<br><br>    <span class="hljs-keyword">private</span> JudgeInfo judgeInfo;<br><br>    <span class="hljs-keyword">private</span> List&lt;String&gt; inputList;<br><br>    <span class="hljs-keyword">private</span> List&lt;String&gt; outputList;<br><br>    <span class="hljs-keyword">private</span> List&lt;JudgeCase&gt; judgeCaseList;<br><br>    <span class="hljs-keyword">private</span> Question question;<br><br>    <span class="hljs-keyword">private</span> QuestionSubmit questionSubmit;<br><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>定义判题策略接口</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">JudgeStrategy</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 执行判题</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> judgeContext</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    JudgeInfo <span class="hljs-title function_">doJudge</span><span class="hljs-params">(JudgeContext judgeContext)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>实现默认判题策略</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wl2o2o.smartoj.judge.strategy;<br><br><span class="hljs-keyword">import</span> cn.hutool.json.JSONUtil;<br><span class="hljs-keyword">import</span> com.wl2o2o.smartoj.model.dto.question.JudgeCase;<br><span class="hljs-keyword">import</span> com.wl2o2o.smartoj.model.dto.question.JudgeConfig;<br><span class="hljs-keyword">import</span> com.wl2o2o.smartoj.model.dto.questionsubmit.JudgeInfo;<br><span class="hljs-keyword">import</span> com.wl2o2o.smartoj.model.entity.Question;<br><span class="hljs-keyword">import</span> com.wl2o2o.smartoj.model.enums.JudgeInfoMessageEnum;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 默认判题策略</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> WL2O2O</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2023/12/19 1:07</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultJudgeStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">JudgeStrategy</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 执行判题</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> judgeContext</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> JudgeInfo <span class="hljs-title function_">doJudge</span><span class="hljs-params">(JudgeContext judgeContext)</span> &#123;<br>        <span class="hljs-type">JudgeInfo</span> <span class="hljs-variable">judgeInfo</span> <span class="hljs-operator">=</span> judgeContext.getJudgeInfo();<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">memory</span> <span class="hljs-operator">=</span> judgeInfo.getMemory();<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> judgeInfo.getTime();<br>        List&lt;String&gt; inputList = judgeContext.getInputList();<br>        List&lt;String&gt; outputList = judgeContext.getOutputList();<br>        <span class="hljs-type">Question</span> <span class="hljs-variable">question</span> <span class="hljs-operator">=</span> judgeContext.getQuestion();<br>        List&lt;JudgeCase&gt; judgeCaseList = judgeContext.getJudgeCaseList();<br>        <span class="hljs-type">JudgeInfoMessageEnum</span> <span class="hljs-variable">judgeInfoMessageEnum</span> <span class="hljs-operator">=</span> JudgeInfoMessageEnum.ACCEPTED;<br>        <span class="hljs-type">JudgeInfo</span> <span class="hljs-variable">judgeInfoResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JudgeInfo</span>();<br>        judgeInfoResponse.setMemory(memory);<br>        judgeInfoResponse.setTime(time);<br>        <span class="hljs-comment">// 先判断沙箱执行的结果输出数量是否和预期输出数量相等</span><br>        <span class="hljs-keyword">if</span> (outputList.size() != inputList.size()) &#123;<br>            judgeInfoMessageEnum = JudgeInfoMessageEnum.WRONG_ANSWER;<br>            judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());<br>            <span class="hljs-keyword">return</span> judgeInfoResponse;<br>        &#125;<br>        <span class="hljs-comment">// 依次判断每一项输出和预期输出是否相等</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; judgeCaseList.size(); i++) &#123;<br>            <span class="hljs-type">JudgeCase</span> <span class="hljs-variable">judgeCase</span> <span class="hljs-operator">=</span> judgeCaseList.get(i);<br>            <span class="hljs-keyword">if</span> (!judgeCase.getOutput().equals(outputList.get(i))) &#123;<br>                judgeInfoMessageEnum = JudgeInfoMessageEnum.WRONG_ANSWER;<br>                judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());<br>                <span class="hljs-keyword">return</span> judgeInfoResponse;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// 判断题目限制</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">judgeConfigStr</span> <span class="hljs-operator">=</span> question.getJudgeConfig();<br>        <span class="hljs-type">JudgeConfig</span> <span class="hljs-variable">judgeConfig</span> <span class="hljs-operator">=</span> JSONUtil.toBean(judgeConfigStr, JudgeConfig.class);<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">needMemoryLimit</span> <span class="hljs-operator">=</span> judgeConfig.getMemoryLimit();<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">needTimeLimit</span> <span class="hljs-operator">=</span> judgeConfig.getTimeLimit();<br>        <span class="hljs-keyword">if</span> (memory &gt; needMemoryLimit) &#123;<br>            judgeInfoMessageEnum = JudgeInfoMessageEnum.MEMORY_LIMIT_EXCEEDED;<br>            judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());<br>            <span class="hljs-keyword">return</span> judgeInfoResponse;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (time &gt; needTimeLimit) &#123;<br>            judgeInfoMessageEnum = JudgeInfoMessageEnum.TIME_LIMIT_EXCEEDED;<br>            judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());<br>            <span class="hljs-keyword">return</span> judgeInfoResponse;<br>        &#125;<br>        judgeInfoResponse.setMessage(judgeInfoMessageEnum.getValue());<br>        <span class="hljs-keyword">return</span> judgeInfoResponse;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>新增一种判题策略，在<code>JudgeServiceImpl</code>中通过<code>if else</code>的方式来选择使用哪种策略</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">JudgeStrategy</span> <span class="hljs-variable">judgeStrategy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultJudgeStrategy</span>();<br><span class="hljs-keyword">if</span> (language.equals(<span class="hljs-string">&quot;java&quot;</span>)) &#123;<br>    judgeStrategy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaLanguageJudgeStrategy</span>();<br>&#125;<br><span class="hljs-type">JudgeInfo</span> <span class="hljs-variable">judgeInfo</span> <span class="hljs-operator">=</span> judgeStrategy.doJudge(judgeContext);<br></code></pre></td></tr></table></figure><blockquote><p>注意：如果判题策略的过程比较复杂，service 实现类代码会比较臃肿。<br>那么为了让调用方写更少的代码、调用最简单化。<br>我们可以将判断使用哪个策略的部分代码抽离出来，编写<code>StrategyManage</code>类，用来单独判断策略。</p></blockquote><ol start="5"><li>编写<code>StrategyManage</code>类，用来单独判断策略</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 判题管理（简化调用）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JudgeManager</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 执行判题</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> judgeContext</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    JudgeInfo <span class="hljs-title function_">doJudge</span><span class="hljs-params">(JudgeContext judgeContext)</span> &#123;<br>        <span class="hljs-type">QuestionSubmit</span> <span class="hljs-variable">questionSubmit</span> <span class="hljs-operator">=</span> judgeContext.getQuestionSubmit();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">language</span> <span class="hljs-operator">=</span> questionSubmit.getLanguage();<br>        <span class="hljs-type">JudgeStrategy</span> <span class="hljs-variable">judgeStrategy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultJudgeStrategy</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;java&quot;</span>.equals(language)) &#123;<br>            judgeStrategy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaLanguageJudgeStrategy</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> judgeStrategy.doJudge(judgeContext);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>🆗，完成！</p><p><strong>知识点 - 设计模式：</strong></p><ol><li><strong>工厂模式</strong></li></ol><p>可配置化</p><ol start="2"><li><strong>代理模式</strong></li></ol><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1702991107151-ed3b292b-f7a2-49ba-a4c3-22451043246d.png#averageHue=%23fbf6f6&clientId=ued951e26-adc7-4&from=paste&height=497&id=u2708d228&originHeight=745&originWidth=862&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=39095&status=done&style=none&taskId=u323c0a72-2df7-4fa9-9b91-309de60444f&title=&width=575" srcset="/img/loading.gif" lazyload alt="image.png"></p><ol start="3"><li><strong>策略模式</strong></li></ol><blockquote><p>我的理解：抽离方法，解耦思想</p></blockquote><hr><h2 id="代码沙箱的实现"><a href="#代码沙箱的实现" class="headerlink" title="代码沙箱的实现"></a>代码沙箱的实现</h2><h3 id="什么是代码沙箱："><a href="#什么是代码沙箱：" class="headerlink" title="什么是代码沙箱："></a><strong>什么是代码沙箱：</strong></h3><p>为了解耦<strong>并将代码沙箱单独作为一个服务/接口</strong>来调用，将判题逻辑分为<strong>判题模块</strong>与<strong>代码沙箱</strong>两个模块。<br>代码沙箱只负责接收代码的输入与输入用例，只返回编译运行的结果，不负责判题，判题逻辑单独交给判题模块负责。</p><blockquote><p>下面以Java语言为例，实现代码沙箱<br>TODO: 扩展其他语言的实现</p></blockquote><p>根据我们的架构来看，我们的代码沙箱最终需要提供一个接口来进行调用</p><h3 id="新建Spring-Boot-Web项目-JDK8-Boot-2-7"><a href="#新建Spring-Boot-Web项目-JDK8-Boot-2-7" class="headerlink" title="新建Spring Boot Web项目(JDK8/Boot 2.7)"></a>新建Spring Boot Web项目(JDK8/Boot 2.7)</h3><p>编写测试接口，测试能否访问</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wl2o2o.smartojcodesandbox.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> &lt;a href=&quot;https://github.com/wl2o2o&quot;&gt;程序员CSGUIDER&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@From</span> &lt;a href=&quot;https://wl2o2o.github.io&quot;&gt;CSGUIDER博客&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@CreateTime</span> 2023/12/23</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController(&quot;/&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/health&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">healthCheck</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Java-原生实现代码沙箱"><a href="#Java-原生实现代码沙箱" class="headerlink" title="Java 原生实现代码沙箱"></a>Java 原生实现代码沙箱</h2><p>原生就是不借助于任何的第三方库，用最干净的方式实现代码沙箱<br>逻辑：<br>接收代码 =javac=&gt; 编译代码 =java=&gt; 执行代码<br>因为一般来说<code>OJ</code>系统中一般都对于用户的输入有相关要求，所以为了更方便处理，我们把类名统一写成<code>Main</code>，减少类名不一致的风险。（关键是还不用从用户输入的代码中去提取类名）<br>示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> &lt;a href=&quot;https://github.com/wl2o2o&quot;&gt;程序员CSGUIDER&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@From</span> &lt;a href=&quot;https://wl2o2o.github.io&quot;&gt;CSGUIDER博客&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@CreateTime</span> 2023/12/25</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> Integer.parseInt(args[<span class="hljs-number">0</span>]);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> Integer.parseInt(args[<span class="hljs-number">1</span>]);<br>        System.out.println(<span class="hljs-string">&quot;结果：&quot;</span> + (a + b));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>编译执行代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">javac -encoding utf8 .\Main.java<br>java -cp . Main <span class="hljs-number">1</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h3 id="核心流程实现"><a href="#核心流程实现" class="headerlink" title="核心流程实现"></a>核心流程实现</h3><p>核心实现思路：用程序来代替人工，用程序操作命令行，去编译代码<br>关键类：<code>Java</code>进程执行管理类</p><ol><li>把用户文件保存为文件</li><li>编译代码，得到 class 文件</li><li>执行代码，得到输出结果</li><li>从控制台，收集整理输出结果</li><li>文件清理</li><li>错误处理，提升程序健壮性</li></ol><h3 id="把用户文件保存为文件"><a href="#把用户文件保存为文件" class="headerlink" title="把用户文件保存为文件"></a>把用户文件保存为文件</h3><ol><li>引入<code>hutool</code>工具类：</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://hutool.cn/docs/index.html#/--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>新建UUID随机目录，每个用户的代码都存放于一个独立的文件夹中，便于维护</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">userDir</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">globalPathName</span> <span class="hljs-operator">=</span> userDir + File.separator + GLOBAL_CODE_DIR_NAME;<br><br><span class="hljs-comment">// 判断目录是否存在</span><br><span class="hljs-keyword">if</span> (!FileUtil.exist(globalPathName)) &#123;<br>    FileUtil.mkdir(globalPathName);<br>&#125;<br><br><span class="hljs-comment">// 把用户的代码隔离存放</span><br><span class="hljs-type">String</span> <span class="hljs-variable">userCodeParentPathName</span> <span class="hljs-operator">=</span> globalPathName + File.separator + UUID.randomUUID();<br><span class="hljs-type">String</span> <span class="hljs-variable">userCodePath</span> <span class="hljs-operator">=</span> userCodeParentPathName + File.separator + GLOBAL_JAVA_CLASS_NAME;<br><span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> FileUtil.writeString(code, userCodePath, StandardCharsets.UTF_8);<br></code></pre></td></tr></table></figure><blockquote><p><strong>口诀：一般情况下，程序会向输入流里写，会从输出流中读取 ————其实取决于进程</strong></p></blockquote><h3 id="执行程序"><a href="#执行程序" class="headerlink" title="执行程序"></a>执行程序</h3><ol><li>编译代码，得到 class 文件</li></ol><p>如何解决运行结果乱码：<br>java -Dfile.encoding=utf8 -cp %s Main %s</p><p>如果需要交互式（ACM），需要和用户交互的方式，让用户不断输入内容以获得输出<br>对于此类程序，我们需要使用OutPutStream向程序释放资源，流关闭终端发送参数，并及时获取结果，最后要</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 执行交互式进程并获取信息</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> runProcess</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> opName</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecuteMessage <span class="hljs-title function_">runInterProcessAndGetMessage</span><span class="hljs-params">(Process runProcess, String opName, String args)</span> &#123;<br>        <span class="hljs-type">ExecuteMessage</span> <span class="hljs-variable">executeMessage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecuteMessage</span>();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 向控制台输入程序</span><br>            <span class="hljs-type">OutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> runProcess.getOutputStream();<br>            <span class="hljs-type">OutputStreamWriter</span> <span class="hljs-variable">outputStreamWriter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(outputStream);<br><br>            String[] split = args.split(<span class="hljs-string">&quot; &quot;</span>);<br>            outputStreamWriter.write(StrUtil.join(<span class="hljs-string">&quot;\n&quot;</span>, (Object) split) + <span class="hljs-string">&quot;\n&quot;</span>);<br>            <span class="hljs-comment">// 相当于回车</span><br>            outputStreamWriter.flush();<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">exitValue</span> <span class="hljs-operator">=</span> runProcess.waitFor();<br>            executeMessage.setExitValue(exitValue);<br><br>            <span class="hljs-comment">// 成块获取控制台输出</span><br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> runProcess.getInputStream();<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">bufferedReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream));<br>            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">compileOutputStringBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>            String output;<br>            <span class="hljs-comment">// 逐行读取输出</span><br>            <span class="hljs-keyword">while</span> ((output = bufferedReader.readLine()) != <span class="hljs-literal">null</span> ) &#123;<br>                compileOutputStringBuilder.append(output);<br>            &#125;<br>            executeMessage.setMessgae(compileOutputStringBuilder.toString());<br><br><br>            <span class="hljs-comment">// 资源回收</span><br>            outputStream.close();<br>            outputStreamWriter.close();<br>            inputStream.close();<br>            runProcess.destroy();<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> executeMessage;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="异常情况演示"><a href="#异常情况演示" class="headerlink" title="异常情况演示"></a>异常情况演示</h3><ol><li><p>执行阻塞，占用资源</p></li><li><p>占用内存，不释放</p></li><li><p>读文件，文件信息泄露</p></li><li><p>写文件，越权植入木马</p></li><li><p>运行其他程序</p></li><li><p>执行高危命令</p></li></ol><h3 id="怎么解决？"><a href="#怎么解决？" class="headerlink" title="怎么解决？"></a>怎么解决？</h3><ol><li>超时控制</li><li>限制给用户分配的资源</li><li>限制代码，黑白名单</li><li>限制用户的操作权限，（文件、网络、执行）</li><li>运行环境隔离</li></ol><h4 id="a-超时控制"><a href="#a-超时控制" class="headerlink" title="a. 超时控制"></a>a. 超时控制</h4><p>怎么显示执行时间？创建一个新的线程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 超时控制</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(SLEEP_TIME);<br>        System.out.println(<span class="hljs-string">&quot;超时了，中断！&quot;</span>);<br>        runProcess.destroy();<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>    &#125;<br>&#125;).start();<br></code></pre></td></tr></table></figure><h4 id="b-限制给用户分配的资源"><a href="#b-限制给用户分配的资源" class="headerlink" title="b. 限制给用户分配的资源"></a>b. 限制给用户分配的资源</h4><p>怎么限制呢？一个最简单的办法：通过<code>JVM</code>自带的一个堆内存限制参数：<code>-Xmx256m</code></p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos">java -Xmx256m -Dfile.encoding=utf8 -cp <span class="hljs-built_in">%s</span> Main <span class="hljs-built_in">%s</span><br></code></pre></td></tr></table></figure><p><strong>但是我们要注意！！！-Xmx参数，Java的堆内存限制，并不完全等同于系统占用的资源，可能会超出</strong></p><p><strong>面试重点：</strong></p><p><strong>JVM层面的内存限制安全吗？</strong></p><p><strong>答：并不安全，若要进行严格的内存控制，我们需要在内存方面进行进一步的限制</strong></p><p><strong>如果是在Linux 系统的话，我们可以使用 cgrop 来实现对某一个进程的 CPU 或者内存资源的分配</strong></p><p><strong>使用方法：</strong></p><h4 id="c-限制代码，黑白名单"><a href="#c-限制代码，黑白名单" class="headerlink" title="c. 限制代码，黑白名单"></a>c. 限制代码，黑白名单</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> List&lt;String&gt; blacklist = Arrays.asList(<span class="hljs-string">&quot;File&quot;</span>, <span class="hljs-string">&quot;exec&quot;</span>);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> WordTree WORD_TREE;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        WORD_TREE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordTree</span>();<br>        WORD_TREE.addWords(blacklist);<br>    &#125;<br><br><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ExecuteCodeResponse <span class="hljs-title function_">executeCode</span><span class="hljs-params">(ExecuteCodeRequest executeCodeRequest)</span> &#123;<br>        List&lt;String&gt; inputList = executeCodeRequest.getInputList();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> executeCodeRequest.getCode();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">language</span> <span class="hljs-operator">=</span> executeCodeRequest.getLanguage();<br><br>        <span class="hljs-type">FoundWord</span> <span class="hljs-variable">foundWord</span> <span class="hljs-operator">=</span> WORD_TREE.matchWord(code);<br>        <span class="hljs-keyword">if</span> (foundWord != <span class="hljs-literal">null</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;包含禁止词汇：&quot;</span> + foundWord.getFoundWord());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        ···<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="d-限制用户的操作权限"><a href="#d-限制用户的操作权限" class="headerlink" title="d. 限制用户的操作权限"></a>d. 限制用户的操作权限</h4><p>限制用户对文件、内存、CPU、网络等资源的访问。</p><p><strong>Java安全管理器（Security Manager），是Java提供的可以保护JVM、Java安全的机制，</strong>可以实现更加严格的控制。</p><p>编写默认的安全管理器，只需继承Java自带的<code>SecurityManager</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wl2o2o.smartojcodesandbox.security;<br><br><span class="hljs-keyword">import</span> java.security.Permission;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 默认禁用所有权限安全管理器</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> &lt;a href=&quot;https://github.com/wl2o2o&quot;&gt;程序员CSGUIDER&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@From</span> &lt;a href=&quot;https://wl2o2o.github.io&quot;&gt;CSGUIDER博客&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@CreateTime</span> 2023/12/28</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultSecurityManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SecurityManager</span> &#123;<br><br>    <span class="hljs-comment">// 检查所有权限</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkPermission</span><span class="hljs-params">(Permission perm)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(perm.getActions() + <span class="hljs-string">&quot;权限被禁用！&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="e-实现其他权限控制"><a href="#e-实现其他权限控制" class="headerlink" title="e. 实现其他权限控制"></a>e. 实现其他权限控制</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wl2o2o.smartojcodesandbox.security;<br><br><span class="hljs-keyword">import</span> java.security.Permission;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 我的安全管理器</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span> &lt;a href=&quot;https://github.com/wl2o2o&quot;&gt;程序员CSGUIDER&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@From</span> &lt;a href=&quot;https://wl2o2o.github.io&quot;&gt;CSGUIDER博客&lt;/a&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@CreateTime</span> 2023/12/28</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySecurityManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SecurityManager</span> &#123;<br><br>    <span class="hljs-comment">// 检查所有的权限</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkPermission</span><span class="hljs-params">(Permission perm)</span> &#123;<br>        <span class="hljs-comment">// super.checkPermission(perm);</span><br>        System.out.println(perm);<br>    &#125;<br><br>    <span class="hljs-comment">// 检查执行权限</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkExec</span><span class="hljs-params">(String cmd)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<span class="hljs-string">&quot;exec 权限被禁用！&quot;</span> + cmd);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkRead</span><span class="hljs-params">(String file)</span> &#123;<br>        <span class="hljs-comment">// System.out.println(file);</span><br>        <span class="hljs-comment">// if (file.contains(&quot;E:\\Exercise\\project\\smartoj-code-sandbox&quot;)) &#123;</span><br>        <span class="hljs-comment">//     return;</span><br>        <span class="hljs-comment">// &#125;</span><br>        <span class="hljs-comment">// throw new SecurityException(&quot;read 权限被禁用！&quot; + file);</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkWrite</span><span class="hljs-params">(String file)</span> &#123;<br>        <span class="hljs-comment">// throw new SecurityException(&quot;write 权限被禁用！&quot; + file);</span><br>    &#125;<br><br>    <span class="hljs-comment">// 检查删除操作权限</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkDelete</span><span class="hljs-params">(String file)</span> &#123;<br>        <span class="hljs-comment">// throw new SecurityException(&quot;delete 权限被禁用！&quot; + file);</span><br>    &#125;<br><br>    <span class="hljs-comment">// 检查程序可链接网络权限</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkConnect</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port)</span> &#123;<br>        <span class="hljs-comment">// throw new SecurityException(&quot;connect 权限被禁用！&quot; + host + &quot;:&quot; + port);</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">// 这样会直接全部限制开发者写的所有程序的</span><br>System.setSecurityManager(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MySecurityManager</span>());<br></code></pre></td></tr></table></figure><p><strong>实际上，我们只需要对涉及到相关执行命令的子程序进行安全管理，所以采用如下步骤进行配置（也就是配置一个安全管理类加载路径——</strong> <code>**;%s -Djava.security.manager=%s&quot;, SECURITY_MANAGER_PATH, SECURITY_MANAGER_CLASS_NAME**</code><strong>）</strong></p><p><strong>步骤：</strong></p><ol><li><strong>编写安全管理器</strong></li><li><strong>编译成class文件</strong></li><li><strong>去掉包名</strong></li><li><strong>放置在</strong><code>**resources**</code><strong>目录之下</strong></li><li><strong>指定</strong><code>**final**</code><strong>变量，存放管理器class名以及路径</strong></li><li><strong>完成类加载路径配置：</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">runCmd</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;java -Xmx256m -Dfile.encoding=utf8 -cp %s;%s -Djava.security.manager=%s Main %s&quot;</span>, userCodeParentPath, SECURITY_MANAGER_PATH, SECURITY_MANAGER_CLASS_NAME, input);<br><span class="hljs-type">Process</span> <span class="hljs-variable">runProcess</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(runCmd);<br></code></pre></td></tr></table></figure><p><strong>这样就可以实现直接在子程序中直接运用安全管理器。</strong></p><p>但是，安全管理器还是存在不足的地方，比如:</p><p><strong>优点：</strong></p><p>权限控制很灵活，实现简单</p><p><strong>缺点：</strong></p><ol><li><strong>如果要做比较严格的安全校验，需要判断哪些文件允许读写，粒度太细，难以精细化控制</strong></li><li><strong>安全管理器本身都是Java代码，难免存在漏洞（等于说还是程序上的控制，不属于系统层面上的）</strong></li><li><strong>而且不推荐 Java8 以上版本使用</strong></li></ol><h4 id="f-运行环境隔离"><a href="#f-运行环境隔离" class="headerlink" title="f. 运行环境隔离"></a>f. 运行环境隔离</h4><p>系统层面上，把用户程序封装到沙箱里，和宿主机（我们的电脑/服务器）隔离开</p><p>怎么实现：（两种方案）</p><ul><li>Docker 容器技术可以实现（底层是 cgroup 和 namespace 等方式实现）</li><li>cgroup</li></ul><blockquote><p>注意：其实完全使用 Docker 的话，也很难实现绝对安全控制，可以结合 Java 安全管理器进行使用</p></blockquote><hr><h1 id="前端项目初始化"><a href="#前端项目初始化" class="headerlink" title="前端项目初始化"></a>前端项目初始化</h1><blockquote><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><p>nodejs版本：v18.16.0 或者v16<br>npm版本：v9.5.1</p></blockquote><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>安装vue-cli脚手架初始化工具<br><code>npm install -g @vue/cli</code><br>先确认是否安装成功：<br><code>vue -V</code>（V是大写）<br>如果找不到命令，建议重装npm，重新配置环境变量</p><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>vue create + 项目名<br><code>vue create smartoj-frontend</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1700706064256-e0c207c4-844c-4024-ad1a-5b67712a5523.png#averageHue=%23121212&clientId=u37f1eba1-0f09-4&from=paste&height=636&id=ua9b37135&originHeight=954&originWidth=1599&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=111333&status=done&style=none&taskId=ud5a0510f-724c-4575-b647-01fb0e1c66c&title=&width=1066" srcset="/img/loading.gif" lazyload alt="image.png"></p><h3 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h3><p>是否成功？引入组件进行测试 ：重装或者解决问题</p><h3 id="前端工程化配置"><a href="#前端工程化配置" class="headerlink" title="前端工程化配置"></a>前端工程化配置</h3><p>因为脚手架生成项目的时候，已经勾选代码格式校验，以及美化插件，所以需要在IDE手动开启，避免与IDE的格式化冲突。格式化命令：<code>Ctrl + Shift + L</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1700706080391-0b8b052f-6323-46f7-92d0-a8ca0b55baa7.png#averageHue=%23252a33&clientId=u37f1eba1-0f09-4&from=paste&height=278&id=u9a99b1b1&originHeight=417&originWidth=1472&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=51102&status=done&style=none&taskId=udef938c8-2b9c-4891-8eb3-fb8970b8d39&title=&width=981.3333333333334" srcset="/img/loading.gif" lazyload alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1700706150332-1983eafa-fadc-4ff7-bd45-fcfc4b7abc03.png#averageHue=%23242b36&clientId=u37f1eba1-0f09-4&from=paste&height=252&id=u06c62f0e&originHeight=378&originWidth=1472&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=53449&status=done&style=none&taskId=ud7151abb-5556-403e-a16b-4112bb23746&title=&width=981.3333333333334" srcset="/img/loading.gif" lazyload alt="image.png"></p><h2 id="更改项目的布局"><a href="#更改项目的布局" class="headerlink" title="更改项目的布局"></a>更改项目的布局</h2><h3 id="引入组件"><a href="#引入组件" class="headerlink" title="引入组件"></a>引入组件</h3><p>安装arco.design组件库：<a target="_blank" rel="noopener" href="https://arco.design/vue/docs/start">https://arco.design/vue/docs/start</a><br>快速上手：<br>a. 安装</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-comment"># npm</span><br><span class="hljs-built_in">npm</span> install --save-dev @arco-design/web-vue<br><span class="hljs-comment"># yarn</span><br>yarn add --dev @arco-design/web-vue<br></code></pre></td></tr></table></figure><p>b. 完整引入</p><h3 id="项目通用布局"><a href="#项目通用布局" class="headerlink" title="项目通用布局"></a>项目通用布局</h3><ol><li>新建一个BasicLayout布局，在app.vue中引入</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;div id=<span class="hljs-string">&quot;app&quot;</span>&gt;<br>  &lt;BasicLayout /&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure><p>并设置好布局样式</p><ol start="2"><li>通用菜单GloableHeader布局</li></ol><p>目标：可根据路由配置信息动态生成菜单内容。实现更通用更自动的菜单配置。<br>实现步骤：</p><ul><li>提取通用路由文件</li><li>菜单组件读取路由，动态渲染菜单项</li><li>绑定跳转事件（为什么？因为通过v-for可以实现router路由的同步，但是不能够实现路径的跳转）</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;a-menu<br>      mode=<span class="hljs-string">&quot;horizontal&quot;</span><br>      theme=<span class="hljs-string">&quot;dark&quot;</span><br>      :<span class="hljs-keyword">default</span>-selected-keys=<span class="hljs-string">&quot;[&#x27;1&#x27;]&quot;</span><br>      <span class="hljs-meta">@menu</span>-item-click=<span class="hljs-string">&quot;doMenuClick&quot;</span><br>    &gt;<br>        ...<br>&lt;a-menu-item v-<span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;item in routes&quot;</span> :key=<span class="hljs-string">&quot;item.path&quot;</span>&gt;<br>        &#123;&#123; item.<span class="hljs-property">name</span> &#125;&#125;<br>&lt;/a-menu-item&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; routes &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/router/routes&quot;</span>;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; useRouter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-router&quot;</span>;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// 使用 vueRouter 实现路由跳转</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">doMenuClick</span> = (<span class="hljs-params">key: string</span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  router.<span class="hljs-title function_">push</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">path</span>: key,</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">&#125;;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><ul><li>此时刷新的话，不会记录路由的状态，所以这一步我们实现：同步路由的更新到菜单项高亮（点击–&gt;触发点击事件，跳转更新–&gt;同步菜单栏高亮）</li></ul><p>实现方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();<br><br><span class="hljs-comment">//默认主页</span><br><span class="hljs-keyword">const</span> selectedKeys = <span class="hljs-title function_">ref</span>([<span class="hljs-string">&quot;/&quot;</span>]);<br><br><span class="hljs-comment">// 路由跳转后，更新选中的菜单项</span><br>router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, failure</span>) =&gt;</span> &#123;<br>  selectedKeys.<span class="hljs-property">value</span> = [to.<span class="hljs-property">path</span>];<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p>逻辑：首先点击菜单栏 =&gt; 跳转更新路由 =&gt; 更新路由之后，同步高亮状态</p></blockquote><h2 id="全局状态管理"><a href="#全局状态管理" class="headerlink" title="全局状态管理"></a>全局状态管理</h2><blockquote><p>todo 看官方文档！！！！！！！！！！</p></blockquote><blockquote><p>用到了一个 vuex 库，另外还有 pinia 库可用于全局状态管理</p></blockquote><ul><li><a target="_blank" rel="noopener" href="https://vuex.vue.js.org/zh/guide">vuex</a>（vue-cli脚手架已经自动引入）todo 再了解一下<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15961676/6148140">https://blog.51cto.com/u_15961676/6148140</a></li></ul><blockquote><p>todo 再了解一下<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15961676/6148140">https://blog.51cto.com/u_15961676/6148140</a></p></blockquote><ul><li>什么是全局状态管理？</li></ul><p>所有页面共享全局的变量，而不是局限于某一个页面。</p><ul><li>那么什么数据适合作为全局状态：</li></ul><p>已登陆的用户信息（每一个页面几乎都要用）</p><ul><li>vuex的本质：</li></ul><p>提供了一套增删改查的全局变量 API，只不过多了一些功能，比如说时间旅行<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1700731201901-de437df5-8f62-4caa-aeee-edfab9758489.png#averageHue=%23fefdfb&clientId=u2fa75d88-42af-4&from=drop&id=u3703894d&originHeight=551&originWidth=701&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=27786&status=done&style=none&taskId=u61e26934-f7f6-4198-910d-6d0f28d8529&title=" srcset="/img/loading.gif" lazyload alt="vuex.png"><br>可以直接参考购物车示例：<a target="_blank" rel="noopener" href="https://github.com/vuejs/vuex/blob/main/examples/classic/shopping-cart/store/modules/products.js">链接</a><br>state：存储的状态信息，比如用户信息<br>mutation（尽量同步）：定义了对变量进行增删改查的方法<br>actions（支持异步）：执行异步操作，并且触发 mutation 的更改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs vue">import shop from &#x27;../../api/shop&#x27;<br><br>// initial state<br>const state = () =&gt; (&#123;<br>  loginUser: &#123;<br>  <br>  &#125;<br>  <br>  <br>&#125;)<br><br>// getters<br>const getters = &#123;&#125;<br><br>// actions<br>const actions = &#123;<br>  async getAllProducts (&#123; commit &#125;) &#123;<br>    const products = await shop.getProducts()<br>    commit(&#x27;setProducts&#x27;, products)<br>  &#125;<br>&#125;<br><br>// mutations<br>const mutations = &#123;<br>  setProducts (state, products) &#123;<br>    state.all = products<br>  &#125;,<br><br>  decrementProductInventory (state, &#123; id &#125;) &#123;<br>    const product = state.all.find(product =&gt; product.id === id)<br>    product.inventory--<br>  &#125;<br>&#125;<br><br>export default &#123;<br>  namespaced: true,<br>  state,<br>  getters,<br>  actions,<br>  mutations<br>&#125;<br></code></pre></td></tr></table></figure><p>获取状态变量：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>();<br>store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>?.<span class="hljs-property">loginUser</span><br></code></pre></td></tr></table></figure><p>修改状态变量：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript">store.<span class="hljs-title function_">dispath</span>(<span class="hljs-string">&quot;user/getLoginUser&quot;</span>, &#123;<br>  <span class="hljs-attr">userNama</span>: <span class="hljs-string">&quot;CSGUIDER&quot;</span>,<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><p>就是用一套通用的机制，去定义哪个页面需要什么权限。<br>思路：</p><ul><li>在 router 路由文件中，对每个需要权限的路由进行配置；</li><li>在全局路由头文件中，绑定一个全局路由监听。每次访问页面时，获取用户需要访问的路由信息，进行判断访问权限。</li><li>有权限？ 跳转 ： 拦截或者跳转401鉴权或者登录页</li></ul><blockquote><p>小尾巴：</p><ol><li>单独定义一个文件，控制路由文件的显隐</li><li>完善模板。</li></ol></blockquote><h2 id="优化页面布局"><a href="#优化页面布局" class="headerlink" title="优化页面布局"></a>优化页面布局</h2><ol><li>底部footer布局优化</li><li>用户名换行问题</li><li>导航栏间距优化，content区域优化padding布局</li></ol><h3 id="根据权限隐藏菜单路由"><a href="#根据权限隐藏菜单路由" class="headerlink" title="根据权限隐藏菜单路由"></a>根据权限隐藏菜单路由</h3><p>思路：</p><ol><li>通过v-for循环来判断item中的meta中是否含有hideInMenu（效率低，而且不能与v-if连用）</li><li>定义一个visibleRouter函数来过滤路由</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 改为 visibleRoutes</span><br>&lt;a-menu-item v-<span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;item in visibleRoutes&quot;</span> :key=<span class="hljs-string">&quot;item.path&quot;</span>&gt;<br>  &#123;&#123; item.<span class="hljs-property">name</span> &#125;&#125;<br>&lt;/a-menu-item&gt;<br>  <br><span class="hljs-comment">// 路由过滤函数实现</span><br><span class="hljs-keyword">const</span> visibleRoutes = routes.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideInMenu</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br>  <span class="hljs-comment">// todo  加上用户权限的逻辑</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="加上判断用户权限的逻辑"><a href="#加上判断用户权限的逻辑" class="headerlink" title="加上判断用户权限的逻辑"></a>加上判断用户权限的逻辑</h3><p>记录一个小bug，没搞懂，可能与computed有关</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>();<br><span class="hljs-comment">// 这里定义了一个loginUser，以为是与store/user中的冲突了，换成了其他变量还是不行，猜测与computed和vuex有关</span><br><span class="hljs-comment">// const loginUser = store.state.user.loginUser;</span><br><span class="hljs-comment">// 路由过滤</span><br><span class="hljs-keyword">const</span> visibleRoutes = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> routes.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideInMenu</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-comment">// 加上用户权限的逻辑</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">checkAcess</span>(store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>.<span class="hljs-property">loginUser</span>, item?.<span class="hljs-property">meta</span>?.<span class="hljs-property">access</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="修改GlobleHeader-动态菜单组件，根据权限过滤菜单，"><a href="#修改GlobleHeader-动态菜单组件，根据权限过滤菜单，" class="headerlink" title="修改GlobleHeader 动态菜单组件，根据权限过滤菜单，"></a>修改GlobleHeader 动态菜单组件，根据权限过滤菜单，</h3><p>注意，这里使用计算属性，是为了当登录用户信息发生变更时，出发菜单栏的重新渲染，显示符合权限的菜单栏</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用 vueRouter 实现路由跳转</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();<br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>();<br><span class="hljs-comment">// 路由过滤</span><br><span class="hljs-keyword">const</span> visibleRoutes = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> routes.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideInMenu</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-comment">// 加上用户权限的逻辑</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">checkAcess</span>(store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>.<span class="hljs-property">loginUser</span>, item?.<span class="hljs-property">meta</span>?.<span class="hljs-property">access</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="全局项目入口"><a href="#全局项目入口" class="headerlink" title="全局项目入口"></a>全局项目入口</h3><p>预留一个可以编辑全局初始化逻辑的代码，可以藏一个佛祖哈哈哈</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 全局初始化函数，有全局单次调用的代码，都可以写到这里</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">doInit</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;hello 欢迎来到我的项目&quot;</span>);<br>&#125;;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">doInit</span>();<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="前后端联调"><a href="#前后端联调" class="headerlink" title="前后端联调"></a>前后端联调</h2><h3 id="1-安装请求工具类-Axios"><a href="#1-安装请求工具类-Axios" class="headerlink" title="1 安装请求工具类 Axios"></a>1 安装请求工具类 Axios</h3><p>官方文档：<br><a target="_blank" rel="noopener" href="https://axios-http.com/docs/intro">https://axios-http.com/docs/intro</a><br>代码：<br><code>npm install axios</code></p><h3 id="2-编写调用后端的代码"><a href="#2-编写调用后端的代码" class="headerlink" title="2 编写调用后端的代码"></a>2 编写调用后端的代码</h3><p>传统情况下，每个请求都要单独编写代码。至少得写一个请求路径<br>完全不用！！！我们可以完全借助 openai 的 oneApi 插件来一键生成我们的后端请求代码。<br>官方文档：<br><a target="_blank" rel="noopener" href="https://github.com/ferdikoomen/openapi-typescript-codegen">https://github.com/ferdikoomen/openapi-typescript-codegen</a><br>代码：<br><code>npm install openapi-typescript-codegen --save-dev</code><br>根据接口文档来生成前端请求代码：<br><code>openapi --input [http://localhost:8101/api/v2/api-docs](http://localhost:8121/api/v2/api-docs) --output ./generated --client axios</code></p><h3 id="用户登录功能"><a href="#用户登录功能" class="headerlink" title="用户登录功能"></a>用户登录功能</h3><h4 id="自动登录"><a href="#自动登录" class="headerlink" title="自动登录"></a>自动登录</h4><ol><li>编写获取远程用户登陆信息的代码</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-attr">actions</span>: &#123;<br>    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getLoginUser</span>(<span class="hljs-params">&#123; commit, state &#125;, payload</span>) &#123;<br>      <span class="hljs-comment">// 从远程获取登录用户</span><br>      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UserControllerService</span>.<span class="hljs-title function_">getLoginUserUsingGet</span>();<br>      <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;updateUser&quot;</span>, res.<span class="hljs-property">data</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;updateUser&quot;</span>, &#123;<br>          ...state.<span class="hljs-property">loginUser</span>,<br>          <span class="hljs-attr">userRole</span>: <span class="hljs-variable constant_">ACCESS_ENUM</span>.<span class="hljs-property">NOT_LOGIN</span>,<br>        &#125;);<br>      &#125;<br>      <span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;updateUser&quot;</span>, payload);<br>    &#125;,<br>  &#125;,<br></code></pre></td></tr></table></figure><ol start="2"><li>去哪里触发 getLoginUser 函数的执行？肯定是在一个全局位置</li></ol><p>例如：<br>1） 路由选择<br>2） 全局页面入口<br>3） 全局通用布局</p><blockquote><p>这里我们选择第一种方案，可以直接在全局权限管理的路由拦截中判断用户是否已经登陆</p></blockquote><h3 id="全局权限管理优化"><a href="#全局权限管理优化" class="headerlink" title="全局权限管理优化"></a>全局权限管理优化</h3><ol><li>新建 access/index.ts 文件，把愿原来的路由拦截、权限校验的逻辑放在独立的文件中。</li></ol><p>优势：只要不引入到 main.ts 中，就不会开启，不会对项目有影响</p><ol start="2"><li>调用后端接口，编写权限管理和自动登录的逻辑</li></ol><p>如果没有登录过，那就自动登录：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> loginUser = store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>.<span class="hljs-property">loginUser</span>;<br><span class="hljs-comment">// 如果之前没登陆过，自动登录</span><br><span class="hljs-keyword">if</span> (!loginUser || !loginUser.<span class="hljs-property">userRole</span>) &#123;<br>  <span class="hljs-comment">// 加 await 是为了等用户登录成功之后，再执行后续的代码</span><br>  <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&quot;user/getLoginUser&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>完整代码：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/router&quot;</span>;<br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/store&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-variable constant_">ACCESS_ENUM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/access/accessEnum&quot;</span>;<br><span class="hljs-keyword">import</span> checkAccess <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/access/checkAccess&quot;</span>;<br><br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;登陆用户信息&quot;</span>, store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>.<span class="hljs-property">loginUser</span>);<br>  <span class="hljs-keyword">const</span> loginUser = store.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>.<span class="hljs-property">loginUser</span>;<br>  <span class="hljs-comment">// // 如果之前没登陆过，自动登录</span><br>  <span class="hljs-keyword">if</span> (!loginUser || !loginUser.<span class="hljs-property">userRole</span>) &#123;<br>    <span class="hljs-comment">// 加 await 是为了等用户登录成功之后，再执行后续的代码</span><br>    <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&quot;user/getLoginUser&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">const</span> needAccess = (to.<span class="hljs-property">meta</span>?.<span class="hljs-property">access</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>) ?? <span class="hljs-variable constant_">ACCESS_ENUM</span>.<span class="hljs-property">NOT_LOGIN</span>;<br>  <span class="hljs-comment">// 要跳转的页面必须要登陆</span><br>  <span class="hljs-keyword">if</span> (needAccess !== <span class="hljs-variable constant_">ACCESS_ENUM</span>.<span class="hljs-property">NOT_LOGIN</span>) &#123;<br>    <span class="hljs-comment">// 如果没登陆，跳转到登录页面</span><br>    <span class="hljs-keyword">if</span> (!loginUser || !loginUser.<span class="hljs-property">userRole</span>) &#123;<br>      <span class="hljs-title function_">next</span>(<span class="hljs-string">`/user/login?redirect=<span class="hljs-subst">$&#123;to.fullPath&#125;</span>`</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">// 如果已经登陆了，但是权限不足，那么跳转到无权限页面</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">checkAccess</span>(loginUser, needAccess)) &#123;<br>      <span class="hljs-title function_">next</span>(<span class="hljs-string">&quot;/noAuth&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-title function_">next</span>();<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="支持多套布局与用户登录注册功能开发"><a href="#支持多套布局与用户登录注册功能开发" class="headerlink" title="支持多套布局与用户登录注册功能开发"></a>支持多套布局与用户登录注册功能开发</h3><ol><li>在 routes 路由文件中新建一套用户路由，使用 vue-router 自带的子路由机制，实现布局和嵌套路由，然后隐藏路由即可</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/user&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;用户&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserLayout</span>,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/user/login&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;用户登录&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserLoginView</span>,<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/user/register&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;用户注册&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserRegisterView</span>,<br>      &#125;,<br>    ],<br>  &#125;,<br>]<br></code></pre></td></tr></table></figure><ol start="2"><li>新建 UserLayout、UserLoginView、UserRegisterView 页面，并且在 routes 中引入</li></ol><blockquote><p>编写登录界面、以及登录逻辑，为了方便，直接复用我们写好的获取登陆用户的代码，后期也可以通过优化来，直接获取登录用户，然后塞给我们的前端界面。</p></blockquote><p><strong>TODO：编写用户注册页面</strong></p><ol start="3"><li>因为我们在 app.vue 中全局引入了 GloableHeader，因此需要借助 v-if 来实现用户布局中不显示全局头，使用户界面更加美观</li></ol><p>代码：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;template v-<span class="hljs-keyword">if</span>=<span class="hljs-string">&quot;route.path.startsWith(&#x27;/user&#x27;)&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span></span><br>&lt;/template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">BasicLayout</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p><strong>TODO：这种方式可定不是最优雅的，最理想的情况下是直接读取 routes.ts，在这个文件中自定义多套布局，然后自动使用页面布局。</strong><br>Tips：嵌套路由子菜单</p><ol start="4"><li>登录页面开发</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;a-form<br>  style=<span class="hljs-string">&quot;max-width: 480px; margin: 0 auto&quot;</span><br>  label-align=<span class="hljs-string">&quot;left&quot;</span><br>  auto-label-width<br>  :model=<span class="hljs-string">&quot;form&quot;</span><br>  <span class="hljs-meta">@submit</span>=<span class="hljs-string">&quot;handleSubmit&quot;</span><br>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a-form-item</span> <span class="hljs-attr">field</span>=<span class="hljs-string">&quot;userAccount&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;账号&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;form.userAccount&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入账号&quot;</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">a-form-item</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a-form-item</span> <span class="hljs-attr">field</span>=<span class="hljs-string">&quot;userPassword&quot;</span> <span class="hljs-attr">tooltip</span>=<span class="hljs-string">&quot;密码不少于 8 位&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;密码&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a-input-password</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;form.userPassword&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入密码&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">a-form-item</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a-form-item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-attr">html-type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 120px&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span>登录&lt;/a-button</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">a-form-item</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a-form</span>&gt;</span></span><br></code></pre></td></tr></table></figure><ol start="5"><li>尝试登录逻辑，发现还是获取不到用户登陆的信息</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1701102656580-99641311-3472-4c0d-8fda-0fed1cd09509.png#averageHue=%23292e36&clientId=u6fd5e765-3fbf-4&from=paste&height=307&id=ue2a4be81&originHeight=461&originWidth=880&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=95010&status=done&style=none&taskId=u4cb6dc86-96b7-4615-b55d-a6a8b2b299b&title=&width=586.6666666666666" srcset="/img/loading.gif" lazyload alt="image.png"><br>TODO：为什么要打开携带 Cookie？不携带 cookie 就相当于前后端无关联。</p><hr><h3 id="本次页面开发计划"><a href="#本次页面开发计划" class="headerlink" title="本次页面开发计划"></a>本次页面开发计划</h3><p>完善：</p><blockquote><ol><li>用户注册页面</li><li>用户个人信息页</li></ol></blockquote><p>计划：</p><blockquote><ol><li>创建题目界面</li><li>题目管理界面（Admin）</li><li>题目列表页（主页展示、判题状态展示）</li><li>在线做题页</li><li>题目提交列表页</li><li>题目提交统计页</li></ol></blockquote><hr><h3 id="组件技术选型"><a href="#组件技术选型" class="headerlink" title="组件技术选型"></a>组件技术选型</h3><p><strong>首先技术选型，先接入组件查看是否有冲突</strong><br>组件：</p><blockquote><ol><li>md 编辑器（字节的 bytemd —— <a target="_blank" rel="noopener" href="https://github.com/bytedance/bytemd">https://github.com/bytedance/bytemd</a>)</li><li>代码编辑器（微软的 monaco Editor —— <a target="_blank" rel="noopener" href="https://github.com/microsoft/monaco-editor">https://github.com/microsoft/monaco-editor</a>）</li></ol><p>官方整合教程：<a target="_blank" rel="noopener" href="https://github.com/microsoft/monaco-editor/blob/main/docs/integrate-esm.md">https://github.com/microsoft/monaco-editor/blob/main/docs/integrate-esm.md</a></p></blockquote><h4 id="MD-编辑器："><a href="#MD-编辑器：" class="headerlink" title="MD 编辑器："></a>MD 编辑器：</h4><ol><li>引入 MD 编辑器：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm i @bytemd/vue-next<br>npm i @bytemd/plugin-highlight @bytemd/plugin-gfm<br></code></pre></td></tr></table></figure><ol start="2"><li>新建 MdEditor 组件，编写代码：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;Editor :value=&quot;value&quot; :plugins=&quot;plugins&quot; @change=&quot;handleChange&quot; /&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import gfm from &quot;@bytemd/plugin-gfm&quot;;<br>import highlight from &quot;@bytemd/plugin-highlight&quot;;<br>import &#123; Editor, Viewer &#125; from &quot;@bytemd/vue-next&quot;;<br>import &#123; ref &#125; from &quot;vue&quot;;<br><br>const plugins = [<br>  gfm(),<br>  highlight(),<br>  // Add more plugins here<br>];<br><br>const value = ref(&quot;&quot;);<br><br>const handleChange = (v: string) =&gt; &#123;<br>  value.value = v;<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br><br></code></pre></td></tr></table></figure><ol start="3"><li>美化样式</li></ol><p>代码编辑器的右上角带有一个 byteMd GitHub图标广告，我们可以通过样式来去掉：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.bytemd-toolbar-icon</span><span class="hljs-selector-class">.bytemd-tippy</span><span class="hljs-selector-class">.bytemd-tippy-right</span><span class="hljs-selector-pseudo">:last-child</span> &#123;<br>   <span class="hljs-attribute">display</span>: none;<br>&#125;<br></code></pre></td></tr></table></figure><p>编辑器引入成功，但是我们输入的值，目前还不能被监听到，也就是还不能取出来，所以，我们需要通过定义一个组件来实现把输入的值暴漏给父组件，便于父组件去使用，同时也是提高 md 编辑器的通用性、复用性</p><ol start="4"><li>怎么得到组件内的值？（组件自定义事件？）</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">/**<br> * 定义组件属性类型<br> */<br>interface Props &#123;<br>  value: string;<br>  handleChange: (v: string) =&gt; void;<br>&#125;<br><br>/**<br> * 给组件指定初始值<br> */<br>const props = withDefaults(defineProps&lt;Props&gt;(), &#123;<br>  value: () =&gt; &quot;&quot;,<br>  handleChange: (v: string) =&gt; &#123;<br>    console.log(v);<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="代码编辑器："><a href="#代码编辑器：" class="headerlink" title="代码编辑器："></a>代码编辑器：</h4><ol><li>安装编辑器</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install monaco-editor<br></code></pre></td></tr></table></figure><ol start="2"><li>vue-cli项目(webpack项目)整合monaco-editor</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install monaco-editor-webpack-plugin<br></code></pre></td></tr></table></figure><ol start="3"><li>在 vue.config.js 中配置webpack插件：</li></ol><p>全量加载或者按需加载:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> &#123; defineConfig &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@vue/cli-service&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MonacoWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;monaco-editor-webpack-plugin&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">transpileDependencies</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-title function_">chainWebpack</span>(<span class="hljs-params">config</span>) &#123;<br>    config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">&quot;monaco&quot;</span>).<span class="hljs-title function_">use</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MonacoWebpackPlugin</span>());<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MonacoWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;monaco-editor-webpack-plugin&#x27;</span>)<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">chainWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> &#123;<br>    config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">&#x27;monaco-editor&#x27;</span>).<span class="hljs-title function_">use</span>(<span class="hljs-title class_">MonacoWebpackPlugin</span>, [<br>      &#123;<br>        <span class="hljs-comment">// Languages are loaded on demand at runtime</span><br>        <span class="hljs-attr">languages</span>: [<span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-string">&#x27;go&#x27;</span>, <span class="hljs-string">&#x27;css&#x27;</span>, <span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-string">&#x27;java&#x27;</span>, <span class="hljs-string">&#x27;javascript&#x27;</span>, <span class="hljs-string">&#x27;less&#x27;</span>, <span class="hljs-string">&#x27;markdown&#x27;</span>, <span class="hljs-string">&#x27;mysql&#x27;</span>, <span class="hljs-string">&#x27;php&#x27;</span>, <span class="hljs-string">&#x27;python&#x27;</span>, <span class="hljs-string">&#x27;scss&#x27;</span>, <span class="hljs-string">&#x27;shell&#x27;</span>, <span class="hljs-string">&#x27;redis&#x27;</span>, <span class="hljs-string">&#x27;sql&#x27;</span>, <span class="hljs-string">&#x27;typescript&#x27;</span>, <span class="hljs-string">&#x27;xml&#x27;</span>], <span class="hljs-comment">// [&#x27;abap&#x27;, &#x27;apex&#x27;, &#x27;azcli&#x27;, &#x27;bat&#x27;, &#x27;cameligo&#x27;, &#x27;clojure&#x27;, &#x27;coffee&#x27;, &#x27;cpp&#x27;, &#x27;csharp&#x27;, &#x27;csp&#x27;, &#x27;css&#x27;, &#x27;dart&#x27;, &#x27;dockerfile&#x27;, &#x27;ecl&#x27;, &#x27;fsharp&#x27;, &#x27;go&#x27;, &#x27;graphql&#x27;, &#x27;handlebars&#x27;, &#x27;hcl&#x27;, &#x27;html&#x27;, &#x27;ini&#x27;, &#x27;java&#x27;, &#x27;javascript&#x27;, &#x27;json&#x27;, &#x27;julia&#x27;, &#x27;kotlin&#x27;, &#x27;less&#x27;, &#x27;lexon&#x27;, &#x27;lua&#x27;, &#x27;m3&#x27;, &#x27;markdown&#x27;, &#x27;mips&#x27;, &#x27;msdax&#x27;, &#x27;mysql&#x27;, &#x27;objective-c&#x27;, &#x27;pascal&#x27;, &#x27;pascaligo&#x27;, &#x27;perl&#x27;, &#x27;pgsql&#x27;, &#x27;php&#x27;, &#x27;postiats&#x27;, &#x27;powerquery&#x27;, &#x27;powershell&#x27;, &#x27;pug&#x27;, &#x27;python&#x27;, &#x27;r&#x27;, &#x27;razor&#x27;, &#x27;redis&#x27;, &#x27;redshift&#x27;, &#x27;restructuredtext&#x27;, &#x27;ruby&#x27;, &#x27;rust&#x27;, &#x27;sb&#x27;, &#x27;scala&#x27;, &#x27;scheme&#x27;, &#x27;scss&#x27;, &#x27;shell&#x27;, &#x27;solidity&#x27;, &#x27;sophia&#x27;, &#x27;sql&#x27;, &#x27;st&#x27;, &#x27;swift&#x27;, &#x27;systemverilog&#x27;, &#x27;tcl&#x27;, &#x27;twig&#x27;, &#x27;typescript&#x27;, &#x27;vb&#x27;, &#x27;xml&#x27;, &#x27;yaml&#x27;],</span><br><br>        <span class="hljs-attr">features</span>: [<span class="hljs-string">&#x27;format&#x27;</span>, <span class="hljs-string">&#x27;find&#x27;</span>, <span class="hljs-string">&#x27;contextmenu&#x27;</span>, <span class="hljs-string">&#x27;gotoError&#x27;</span>, <span class="hljs-string">&#x27;gotoLine&#x27;</span>, <span class="hljs-string">&#x27;gotoSymbol&#x27;</span>, <span class="hljs-string">&#x27;hover&#x27;</span> , <span class="hljs-string">&#x27;documentSymbols&#x27;</span>] <span class="hljs-comment">//[&#x27;accessibilityHelp&#x27;, &#x27;anchorSelect&#x27;, &#x27;bracketMatching&#x27;, &#x27;caretOperations&#x27;, &#x27;clipboard&#x27;, &#x27;codeAction&#x27;, &#x27;codelens&#x27;, &#x27;colorPicker&#x27;, &#x27;comment&#x27;, &#x27;contextmenu&#x27;, &#x27;coreCommands&#x27;, &#x27;cursorUndo&#x27;, &#x27;dnd&#x27;, &#x27;documentSymbols&#x27;, &#x27;find&#x27;, &#x27;folding&#x27;, &#x27;fontZoom&#x27;, &#x27;format&#x27;, &#x27;gotoError&#x27;, &#x27;gotoLine&#x27;, &#x27;gotoSymbol&#x27;, &#x27;hover&#x27;, &#x27;iPadShowKeyboard&#x27;, &#x27;inPlaceReplace&#x27;, &#x27;indentation&#x27;, &#x27;inlineHints&#x27;, &#x27;inspectTokens&#x27;, &#x27;linesOperations&#x27;, &#x27;linkedEditing&#x27;, &#x27;links&#x27;, &#x27;multicursor&#x27;, &#x27;parameterHints&#x27;, &#x27;quickCommand&#x27;, &#x27;quickHelp&#x27;, &#x27;quickOutline&#x27;, &#x27;referenceSearch&#x27;, &#x27;rename&#x27;, &#x27;smartSelect&#x27;, &#x27;snippets&#x27;, &#x27;suggest&#x27;, &#x27;toggleHighContrast&#x27;, &#x27;toggleTabFocusMode&#x27;, &#x27;transpose&#x27;, &#x27;unusualLineTerminators&#x27;, &#x27;viewportSemanticTokens&#x27;, &#x27;wordHighlighter&#x27;, &#x27;wordOperations&#x27;, &#x27;wordPartOperations&#x27;]</span><br>      &#125;<br>    ])<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>整合教程</li></ol><p>如何使用 Monaco Editor ？查看示例教程：<br><a target="_blank" rel="noopener" href="https://microsoft.github.io/monaco-editor/playground.html?source=v0.40.0#example-creating-the-editor-hello-world">https://microsoft.github.io/monaco-editor/playground.html?source=v0.40.0#example-creating-the-editor-hello-world</a><br>整合教程参考：<br><a target="_blank" rel="noopener" href="http://chart.zhenglinglu.cn/pages/2244bd/#%E5%9C%A8-vue-%E4%B8%AD%E4%BD%BF%E7%94%A8">http://chart.zhenglinglu.cn/pages/2244bd/#%E5%9C%A8-vue-%E4%B8%AD%E4%BD%BF%E7%94%A8</a><br>注意，monaco editor在读写值的时候，要使用toRaw(编辑器实例)的语法来执行操<br>作，否则会卡死。</p><p>示例整合代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div id=&quot;code-editor&quot; ref=&quot;codeEditorRef&quot; style=&quot;min-height: 400px&quot; /&gt;<br>  &#123;&#123; value &#125;&#125;<br>  &lt;a-button @click=&quot;fillValue&quot;&gt;填充值&lt;/a-button&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import * as monaco from &quot;monaco-editor&quot;;<br>import &#123; onMounted, ref, toRaw &#125; from &quot;vue&quot;;<br><br>const codeEditorRef = ref();<br>const codeEditor = ref();<br>const value = ref(&quot;hello world&quot;);<br><br>const fillValue = () =&gt; &#123;<br>  if (!codeEditor.value) &#123;<br>    return;<br>  &#125;<br>  // 改变值<br>  toRaw(codeEditor.value).setValue(&quot;新的值&quot;);<br>&#125;;<br><br>onMounted(() =&gt; &#123;<br>  if (!codeEditorRef.value) &#123;<br>    return;<br>  &#125;<br>  // Hover on each property to see its docs!<br>  codeEditor.value = monaco.editor.create(codeEditorRef.value, &#123;<br>    value: value.value,<br>    language: &quot;java&quot;,<br>    automaticLayout: true,<br>    colorDecorators: true,<br>    minimap: &#123;<br>      enabled: true,<br>    &#125;,<br>    readOnly: false,<br>    theme: &quot;vs-dark&quot;,<br>    // lineNumbers: &quot;off&quot;,<br>    // roundedSelection: false,<br>    // scrollBeyondLastLine: false,<br>  &#125;);<br><br>  // 编辑 监听内容变化<br>  codeEditor.value.onDidChangeModelContent(() =&gt; &#123;<br>    console.log(&quot;目前内容为：&quot;, toRaw(codeEditor.value).getValue());<br>  &#125;);<br>&#125;);<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br><br></code></pre></td></tr></table></figure><ol start="5"><li>暴漏内容给父组件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">/**<br> * 定义组件属性类型<br> */<br>interface Props &#123;<br>  value: string;<br>  handleChange: (v: string) =&gt; void;<br>&#125;<br><br>/**<br> * 给组件指定初始值<br> */<br>const props = withDefaults(defineProps&lt;Props&gt;(), &#123;<br>  value: () =&gt; &quot;&quot;,<br>  handleChange: (v: string) =&gt; &#123;<br>    console.log(v);<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p>todo: 扩展：用diff editor对比用户代码和标准答案的区别</p></blockquote><h2 id="页面开发"><a href="#页面开发" class="headerlink" title="页面开发"></a>页面开发</h2><h3 id="创建题目界面"><a href="#创建题目界面" class="headerlink" title="创建题目界面"></a>创建题目界面</h3><blockquote><p><strong>小技巧：</strong><br><strong>自定义代码模板：</strong><br><strong>在JetBrains系列编辑器中打开设置，搜索live Templates,先创建一个自定义模板组，在组下创建代码模板。</strong><br><strong>效果：输入缩写，即可生成模板代码。</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div id=&quot;$ID$&quot;&gt;&lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>$END$<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>#$ID$ &#123;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35457700/1702611044474-d806caa1-7948-4d53-8ea4-e1743838dfab.png#averageHue=%233c424b&clientId=ub5e9204a-72e5-4&from=paste&height=705&id=uca0b7a28&originHeight=1058&originWidth=1636&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=264912&status=done&style=none&taskId=u26837985-ac3f-47c3-bc6a-d5d45c22b58&title=&width=1090.6666666666667" srcset="/img/loading.gif" lazyload alt="image.png"></p><ol><li>利用 oneapi 根据后端接口文档，生成前端请求代码</li></ol><p>需要注意的是，每次生成请求代码，需要配置一下携带 cookie</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">openapi --input http://localhost:8121/api/v2/api-docs --output ./generated --client axios<br></code></pre></td></tr></table></figure><ol start="2"><li>使用表单组件</li></ol><p>示例代码：<a target="_blank" rel="noopener" href="https://arco.design/vue/component/form">https://arco.design/vue/component/form</a><br>此处我们用到了</p><ul><li>嵌套套表单：<a target="_blank" rel="noopener" href="https://arco.design/vue/component/form#nest">https://arco.design/vue/component/form#nest</a></li><li>动态增减表单：<a target="_blank" rel="noopener" href="https://arco.design/vue/component/form#dynamic">https://arco.design/vue/component/form#dynamic</a></li></ul><p>注意，我们自定义的代码编辑器组件不会被组件库识别，需要手动指定vlue和handleChange函数。</p><h3 id="题目管理界面"><a href="#题目管理界面" class="headerlink" title="题目管理界面"></a>题目管理界面</h3><ol><li>使用表格组件，找到自定义操作的示例：<a target="_blank" rel="noopener" href="https://arco.design/vue/component/table#custom">https://arco.design/vue/component/table#custom</a></li><li>查询数据</li><li>定以表格列</li><li>加载数据</li><li>调整格式</li></ol><p>JSON 数据的处理方法：<br>1） 使用组件库的自带语法，自动格式化（方便）<br>2） 像定义 optional 操作按钮一样，自定义渲染（灵活）</p><ol start="6"><li>添加、删除、更新操作</li></ol><p>删除之后要执行 loadData 刷新数据</p><blockquote><p>如果想学 React Ant Design 框架的管理页面的开发，看用户中心的项目</p></blockquote><h3 id="更新页面的开发"><a href="#更新页面的开发" class="headerlink" title="更新页面的开发"></a>更新页面的开发</h3><blockquote><p>因为更新与创建题目都是相同的操作，所以直接复用即可。<br>复用的关键：怎么区分两个页面？<br>1） 定义不用的路由<br>2） 对于不用题目加上题目 id 的请求参数<br>3） 更新页需要多一步显示之前信息的操作，最后还需要更改后端的请求接口</p></blockquote><blockquote><p>计划完成</p></blockquote><hr><p>小计划：</p><blockquote><ol><li>解决分页题目信息不跳转 Bug ，以及管理页面刷新之后需要重新登录的 Bug</li><li>题目列表搜索页面开发</li><li>题目浏览页面（做题）开发（左侧题目信息，右侧代码编辑器，对标 Leetcode）</li></ol><p>后端：</p><ol><li>判题机和代码沙箱</li></ol></blockquote><h1 id="简历完善点"><a href="#简历完善点" class="headerlink" title="简历完善点"></a>简历完善点</h1><p>实际运行上述程序时，我们会发现，内存占用到达一定空间后，程序就自动报错：<code>java.lang.OutOfMemoryError:Java heap space</code>，而不是无限增加内存占用，直到系统死机。<strong>这是JVM的一个保护机制。</strong></p><ol><li>内存使用情况，可以使用<strong>JVisualVM或JConsole</strong>工具，连接到JVM虚拟机上来可视化查看运行状态。（使用过相关工具）</li><li>数据结构相关的知识点：HuTool的<code>WordTree</code>字典树工具，他可以使用更少的空间存储更多的词汇， 实现更加便捷的查找。</li><li>Java安全管理器和 Docker 相结合（需要再进行详细了解一下）</li></ol><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><p>详细了解一下糊涂工具类</p><p>Java安全管理器</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Project/" class="category-chain-item">Project</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Spring-Boot/">#Spring Boot</a> <a href="/tags/MySQL/">#MySQL</a></div></div><div class="license-box my-3"><div class="license-title"><div>基于Spring Boot的在线编程判题系统</div><div>https://wlei224.gitee.io/2023/08/21/oj/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>WLei224</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>August 21, 2023</div></div><div class="license-meta-item license-meta-date"><div>Updated on</div><div>May 19, 2024</div></div><div class="license-meta-item"><div>Licensed under</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/08/22/netblog/" title="netblog"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">netblog</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/2023/08/07/DMDatabase/" title="达梦数据库"><span class="hidden-mobile">达梦数据库</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="giscus" class="giscus"></div><script type="text/javascript">Fluid.utils.loadComments("#giscus",(function(){var t={repo:"WL2O2O/CS_GUIDER_Giscus","repo-id":"R_kgDOJYdTQw",category:"Announcements","category-id":"DIC_kwDOJYdTQ84CWKC6","theme-light":"light","theme-dark":"dark",mapping:"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top",lang:"en"},e={};for(let n in t){if(!n.startsWith("theme-"))e[n.startsWith("data-")?n:"data-"+n]=t[n]}window.GiscusThemeLight="light",window.GiscusThemeDark="dark",e["data-theme"]="dark"===document.documentElement.getAttribute("data-user-color-scheme")?"dark":"light";for(let t in e){var n=e[t];null!=n&&""!==n||delete e[t]}var i=document.createElement("script");i.setAttribute("src","https://giscus.app/client.js"),i.setAttribute("crossorigin","anonymous");for(let t in e)i.setAttribute(t,e[t]);var a=document.getElementsByTagName("script"),r=a.length>0?a[a.length-1]:document.head||document.documentElement;r.parentNode.insertBefore(i,r.nextSibling)}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/WL2O2O" target="_blank" rel="nofollow noopener"><span>WL2O2O</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">Views: <span id="busuanzi_value_site_pv"></span> </span><span id="busuanzi_container_site_uv" style="display:none">Visitors: <span id="busuanzi_value_site_uv"></span></span></div><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?956b14594152e1b71ce14695a71235d5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?532b21a5fc88ac9d57905860111efbbb";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/high.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>